"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[980],{829:(e,t,r)=>{r.d(t,{BH:()=>v,FM:()=>g,JY:()=>E,N:()=>f,OS:()=>i,RZ:()=>p,SK:()=>o,_K:()=>x,_o:()=>T,e$:()=>a,gI:()=>u,iC:()=>s,i_:()=>C,lB:()=>d,mO:()=>c,mU:()=>n,p1:()=>b,qn:()=>S,rF:()=>h,tl:()=>y,uF:()=>O,vX:()=>I,zX:()=>l,zs:()=>m});let n=.8,l=3,i={X:50,Y:50},o={SECTION_HEIGHT:24,WIDTH:{MAX:300,MIN:50}},a={X:100,Y:10},s={NORMAL:{COLOR:"#ffffff",STROKE_COLOR:"#696969"},SELECTED:{STROKE_COLOR:"#0000ff"},DRAGGING:{COLOR:"rgba(100, 100, 255, 0.3)",STROKE_COLOR:"rgba(0, 0, 255, 0.3)"},SHADDOW:{COLOR:"rgba(0, 0, 0, 0.5)"},RX:2,STROKE:"2px",STROKE_WIDTH:2},d={COLOR:"black",DRAGGING_COLOR:"rgba(0, 0, 255, 0.3)",STROKE:.5},c=80,u=16,m='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',h={HORIZONTAL:3,VERTICAL:2},f=3,p=1.4,E=40,g=40,O=80,y={HEIGHT:12,WIDTH:14,OFFSET:14},b={SIZE:10,OFFSET:10},I={NONE:"none",ARROW:"arrow",CIRCLE:"circle",SQUARE:"square",DIAMOND:"diamond",FILLED_ARROW:"filled_arrow",FILLED_CIRCLE:"filled_circle",FILLED_SQUARE:"filled_square",FILLED_DIAMOND:"filled_diamond"},S=I.NONE,v="black",T=.5,C="#ffffff",x="#000000"},1050:(e,t,r)=>{r.d(t,{N3:()=>n.N3,YV:()=>n.YV});var n=r(9499)},1231:(e,t,r)=>{let n;r.d(t,{u:()=>_,F:()=>j});let l=[],i=0,o=e=>i>0?(l[i]=e,l[--i]):e,a=e=>i<l.length-1?l[++i]:e,s=e=>{let t=l.slice(0,i+1);t.push(e),l=t,i++},d=e=>Object.values(e).find(e=>e.selected),c=(e,t)=>Object.values(e).filter(e=>e.depth===t).sort((e,t)=>e.y-t.y||e.x-t.x),u=(e,t,r)=>{let n=c(e,t.depth),l=n.findIndex(e=>e.id===t.id)+r;return l>=0&&l<n.length?n[l].id:t.id},m=(e,t)=>Object.values(e).filter(e=>e.parentId===t),h=(e,t)=>{let r=d(e);if(r)switch(t){case"up":case"down":return u(e,r,"up"===t?-1:1);case"left":return r.parentId??r.id;case"right":return m(e,r.id)[0]?.id??r.id;default:return r.id}};var f=r(829),p=r(8265),E=r(9499);let g=(e,t,r,n,l)=>{if((0,p.c)(`[layoutNode]「${e.texts}」 id=${e.id}, depth=${n}, startY=${r} ---`),null===e.parentId)e.x=f.OS.X;else{let r=t[e.parentId];e.x=r.x+r.width+f.e$.X}let i=(0,E.i0)(e.id,t).sort((e,t)=>e.order-t.order);(0,p.c)(`children=${i.length}`);let o=r,a=r;if(!(i.length>0))return e.y=r,o=r+e.height,(0,p.c)(`[layoutNode](子要素なし)「${e.texts}」 id=${e.id}, y=${e.y}, newY=${o}`),{newY:o};{let r=f.SK.SECTION_HEIGHT*l();for(let s of(o+=Math.max((e.height-r)*.5,f.e$.Y),i)){let e=g(s,t,o,n+1,l);o=e.newY+f.e$.Y,a=Math.max(a,e.newY)}let s=i[0],d=i[i.length-1];return e.y=(s.y+d.y+d.height)/2-e.height/2,o=Math.max(a,e.y+e.height),(0,p.c)(`[layoutNode](子要素あり)「${e.texts}」 id=${e.id}, y=${e.y}, maxChildBottom=${a}, finalY=${o}`),{newY:o}}},O=(e,t)=>{(0,p.c)(`adjustElementPositions開始: 要素数=${Object.keys(e).length}`);let r={...e},n=(0,E.i0)(null,r).sort((e,t)=>e.order-t.order),l=f.OS.Y;for(let e of n)l=g(e,r,l,0,t).newY+f.e$.Y;return(0,p.c)(`adjustElementPositions終了`),r};var y=r(5439),b=r(621),I=r(1050),S=r(3346);let v=(e,t,r,n)=>{let l=(0,I.N3)({parentId:t.id,order:n?.order??t.children,depth:t.depth+1,numSections:n?.numberOfSections});r&&(l.texts[0]=r),n?.newElementSelect!==void 0&&(l.selected=n.newElementSelect,l.editing=n.newElementSelect),n?.tentative!==void 0&&(l.tentative=n.tentative);let i={...t,children:t.children+1,selected:!n?.newElementSelect&&t.selected};return{...e,[t.id]:i,[l.id]:l}},T=(e,t,r)=>{let n=t.parentId,l=Object.values(e).filter(e=>e.parentId===n),i=t.order+1,o={...e};l.forEach(e=>{e.order>=i&&(o[e.id]={...e,order:e.order+1})});let a=(0,I.N3)({parentId:n,order:i,depth:t.depth,numSections:r});if(o[t.id]={...t,selected:!1},o[a.id]=a,null!==n){let e=o[n];o[n]={...e,children:e.children+1}}return o},C=(e,t,r)=>{if(!t)return e;let n=Object.values(t).find(e=>null===e.parentId);if(!n)return{...e,...t};let l=n.depth,i=r.depth+1-l,o=new Map,a={};Object.values(t).forEach(e=>{let t=(0,b.A)();o.set(e.id,t);let n=e.depth+i;a[t]={...e,id:t,depth:n,parentId:null===e.parentId?r.id:o.get(e.parentId),order:null===e.parentId?r.children:e.order}}),a[o.get(n.id)].selected=!0;let s={...r,children:r.children+1,selected:!1};return{...e,...a,[r.id]:s}},x=(e,t,r,n)=>{let l={...e},i={...t},o=i.children;return r.forEach((e,t)=>{l=v(l,i,e,{newElementSelect:!1,tentative:n.tentative??!1,order:o+t,numberOfSections:n.numberOfSections})}),l[i.id]={...i,children:o+r.length},Object.values(l).forEach(e=>{if(e.parentId===i.id){let t=(0,S.PC)(e.texts,f.rF.HORIZONTAL),r=e.texts.map(e=>{let r=(0,S.C1)(e||"",t,n.zoomRatio).length;return Math.max(f.SK.SECTION_HEIGHT*n.zoomRatio,r*f.gI*f.RZ+f.rF.VERTICAL*n.zoomRatio)});l[e.id]={...e,width:t,height:r.reduce((e,t)=>e+t,0),sectionHeights:r}}}),O(l,()=>n.numberOfSections)},w=(e,t,r)=>e[t]?{...e,[t]:{...e[t],...r}}:e,N=(e,t)=>{let r={...e};return Object.entries(t).forEach(e=>{let[t,n]=e;r[t]&&(r[t]={...r[t],...n})}),r},k=(e,t,r)=>{let n={...e};return Object.entries(n).forEach(e=>{let[l,i]=e;t(i)&&(n[l]={...i,...r})}),n},R=(e,t)=>{let r=t(e.elements);return{...e,elements:O(r,()=>e.numberOfSections)}},A=e=>(t,r)=>{let{id:n}=r.payload,l=r.payload[e];return{...t,elements:w(t.elements,n,{[e]:l})}},_={elements:{1:{...(0,E.N3)(),id:"1",x:f.OS.X,y:f.OS.Y,editing:!1}},width:window.innerWidth,height:window.innerHeight,zoomRatio:1,numberOfSections:f.zX};function L(e){return t=>{let r=Object.values(t.elements).filter(e=>e.selected);if(r.length>1){let e=r[0].id,n=Object.values(t.elements).reduce((t,r)=>(t[r.id]={...r,selected:r.id===e,editing:r.id===e&&r.editing},t),{});return{...t,elements:n}}let n=e(t.elements);return{...t,elements:Object.values(t.elements).reduce((e,t)=>(e[t.id]={...t,selected:t.id===n},e),{})}}}function M(e,t){let r=Object.values(e.elements).find(e=>e.selected);if(!r)return e;s(e.elements);let n=t(e.elements,r);return"elements"in n?{...e,elements:n.elements}:{...e,elements:n}}let P={ZOOM_IN:e=>({...e,zoomRatio:e.zoomRatio+.1}),ZOOM_OUT:e=>({...e,zoomRatio:Math.max(e.zoomRatio-.1,.1)}),ARROW_UP:L(e=>h(e,"up")),ARROW_DOWN:L(e=>h(e,"down")),ARROW_RIGHT:L(e=>h(e,"right")),ARROW_LEFT:L(e=>h(e,"left")),LOAD_ELEMENTS:(e,t)=>{if(0===Object.keys(t.payload).length)return _;let r=Object.values(t.payload).reduce((e,t)=>(e[t.id]=null===t.parentId?{...t,visible:!0}:t,e),{});return R(e,()=>r)},SELECT_ELEMENT:(e,t)=>{let{id:r,ctrlKey:n,shiftKey:l}=t.payload,i=e.elements[r];if(!i)return e;let o=Object.values(e.elements).filter(e=>e.selected),a=o[0];if((l||n)&&o.length>0&&o.some(e=>e.parentId!==i.parentId))return e;let s=[];if(l&&o.length>0){let t=a.parentId,n=Object.values(e.elements).filter(e=>e.parentId===t).sort((e,t)=>e.order-t.order),l=n.findIndex(e=>e.id===a.id),i=n.findIndex(e=>e.id===r),[o,d]=[Math.min(l,i),Math.max(l,i)];s=n.slice(o,d+1).map(e=>e.id)}else s=n?o.some(e=>e.id===r)?o.filter(e=>e.id!==r).map(e=>e.id):[...o.map(e=>e.id),r]:[r];let d=i.parentId,c=s.filter(t=>e.elements[t].parentId===d),u=k(e.elements,()=>!0,{selected:!1,editing:!1});return u=k(u,e=>c.includes(e.id),{selected:!0}),{...e,elements:u}},DESELECT_ALL:e=>({...e,elements:k(e.elements,()=>!0,{selected:!1,editing:!1})}),UPDATE_TEXT:(n=(e,t)=>{let{index:r,value:n}=t;return{texts:e.texts.map((e,t)=>t===r?n:e)}},(e,t)=>{let{id:r}=t.payload,l=e.elements[r];return l?{...e,elements:w(e.elements,r,n(l,t.payload))}:e}),UPDATE_START_MARKER:A("startMarker"),UPDATE_END_MARKER:A("endMarker"),UPDATE_CONNECTION_PATH_TYPE:(e,t)=>{let{id:r,connectionPathType:n}=t.payload;return{...e,elements:w(e.elements,r,{startMarker:n,connectionPathType:n})}},UPDATE_END_CONNECTION_PATH_TYPE:(e,t)=>{let{id:r,endConnectionPathType:n}=t.payload;return{...e,elements:w(e.elements,r,{endMarker:n,endConnectionPathType:n})}},EDIT_ELEMENT:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(r,n)=>{let l=Object.values(r.elements).filter(e=>e.selected);if(0===l.length)return r;let i=l.reduce((t,r)=>(t[r.id]=e(r,n?.payload),t),{}),o=N(r.elements,i);return t?{...r,elements:O(o,()=>r.numberOfSections)}:{...r,elements:o}}}(e=>({editing:!0}),!1),END_EDITING:e=>R(e,()=>k(e.elements,()=>!0,{editing:!1})),MOVE_ELEMENT:(e,t)=>{let{id:r,x:n,y:l}=t.payload,i=Object.values(e.elements).filter(e=>e.selected);if(i.length>1&&i.some(e=>e.id===r)){let t=n-e.elements[r].x,o=l-e.elements[r].y,a=i.reduce((e,r)=>(e[r.id]={x:r.x+t,y:r.y+o},e),{});return{...e,elements:N(e.elements,a)}}return{...e,elements:w(e.elements,r,{x:n,y:l})}},UPDATE_ELEMENT_SIZE:(e,t)=>{let{id:r,width:n,height:l,sectionHeights:i}=t.payload;if(!e.elements[r])return e;let o=w(e.elements,r,{width:n,height:l,sectionHeights:i});return R(e,()=>o)},ADD_ELEMENT:(e,t)=>M(e,(r,n)=>({elements:O(v(r,n,t.payload?.text,{newElementSelect:!0,numberOfSections:e.numberOfSections}),()=>e.numberOfSections)})),ADD_ELEMENTS_SILENT:(e,t)=>M(e,(r,n)=>{let l=t.payload?.texts||[];return{elements:x(r,n,l,{tentative:t.payload?.tentative||!1,numberOfSections:e.numberOfSections,zoomRatio:e.zoomRatio})}}),ADD_SIBLING_ELEMENT:e=>M(e,(t,r)=>({elements:O(T(t,r,e.numberOfSections),()=>e.numberOfSections)})),DELETE_ELEMENT:e=>{let t=Object.values(e.elements).filter(e=>e.selected);if(0===t.length)return e;(0,p.c)(`DELETE_ELEMENT開始: 削除対象要素数=${t.length}`);let r={...e.elements},n=(()=>{let e=t[0],n=Object.values(r).filter(t=>t.parentId===e.parentId&&!t.selected).sort((e,t)=>e.order-t.order),l=n.filter(t=>t.order<e.order).pop(),i=n.find(t=>t.order>e.order);return l?.id||i?.id||e.parentId})();t.forEach(e=>{r=(0,E.mP)(r,e)}),Object.values(r).forEach(e=>{null===e.parentId&&(e.y=f.OS.Y)});let l=k(r,e=>e.id===n,{selected:!0});return R(e,()=>l)},CONFIRM_TENTATIVE_ELEMENTS:(e,t)=>({...e,elements:k(e.elements,e=>e.parentId===t.payload&&e.tentative,{tentative:!1})}),CANCEL_TENTATIVE_ELEMENTS:(e,t)=>{let r=Array.from(new Set(Object.values(e.elements).filter(e=>e.tentative&&e.parentId===t.payload).map(e=>e.parentId).filter(e=>null!==e))),n=Object.values(e.elements).reduce((e,r)=>(r.tentative&&r.parentId===t.payload||(e[r.id]=r),e),{}),l=r.reduce((e,t)=>{if(e[t]){let r=Object.values(e).filter(e=>e.parentId===t&&!e.tentative).length;e[t]={...e[t],children:r}}return e},n);return R(e,()=>l)},UNDO:e=>R(e,()=>o(e.elements)),REDO:e=>R(e,()=>a(e.elements)),SNAPSHOT:e=>(s(e.elements),e),DROP_ELEMENT:(e,t)=>{let{payload:r}=t,{id:n,oldParentId:l,newParentId:i,newOrder:o,depth:a}=r;if(n===i||(0,E.K9)(e.elements,n,i))return e;let s={...e.elements},d=s[n],c=s[l],u=s[i],m=l===i;!m&&c&&(s[l]={...c,children:Math.max(0,c.children-1)},Object.values(s).filter(e=>e.parentId===l&&e.id!==n).sort((e,t)=>e.order-t.order).forEach((e,t)=>{e.order!==t&&(s[e.id]={...e,order:t})})),s[n]={...d,parentId:i,depth:a,order:o};let h=Object.values(s).filter(e=>e.parentId===i&&e.id!==n);return h.sort((e,t)=>e.order-t.order),h.forEach((e,t)=>{let r=t>=o?t+1:t;e.order!==r&&(s[e.id]={...e,order:r})}),!m&&u&&(s[i]={...u,children:u.children+1}),m||(s=(0,E.wJ)(s,s[n])),R(e,()=>s)},CUT_ELEMENT:e=>{let t=Object.values(e.elements).filter(e=>e.selected);if(0===t.length)return e;let r={},n={...e.elements};return t.forEach(e=>{let t=(0,y.mY)(n,e);Object.values(t).forEach(e=>{t[e.id]={...e,selected:!1}}),r={...r,...t},n=(0,E.mP)(n,e)}),(0,y.lW)(r),{...e,elements:n}},COPY_ELEMENT:e=>(function(e,t){let r=Object.values(e.elements).find(e=>e.selected);return r?{...e,...t(r)}:e})(e,t=>{let r=(0,y.mY)(e.elements,t);return(0,y.lW)(r),{}}),PASTE_ELEMENT:e=>{if(1!==Object.values(e.elements).filter(e=>e.selected).length)return e;let t=(0,y.Lt)();return t?M(e,(r,n)=>({elements:O(C(r,t,n),()=>e.numberOfSections)})):e},EXPAND_ELEMENT:e=>M(e,(t,r)=>({elements:O((0,E.nP)(t,r,!0),()=>e.numberOfSections)})),COLLAPSE_ELEMENT:e=>M(e,(t,r)=>({elements:O((0,E.nP)(t,r,!1),()=>e.numberOfSections)}))},j=(e,t)=>{let r=P[t.type];return r?r(e,t):e}},3346:(e,t,r)=>{r.d(t,{C1:()=>a,PC:()=>o});var n=r(829);let l=()=>{let e=document.createElement("canvas").getContext("2d");return e.font=`${n.gI}px ${n.zs}`,e},i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=l();return Math.ceil(e.split("\n").reduce((e,n)=>Math.max(e,r.measureText(n).width+2*t),0))},o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=e.reduce((e,r)=>Math.max(e,i(r||"",t)),0);return Math.min(n.SK.WIDTH.MAX,Math.max(n.SK.WIDTH.MIN,r))},a=function(e,t){arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.mU;let r=l(),i=e.split("\n"),o=[];return i.forEach(e=>{if(""===e.trim()){o.push("");return}let n="",l=0;for(let i of e.split(/(\s+)/).filter(e=>""!==e)){let e=r.measureText(i).width;if(l+e>t){if(""!==n&&(o.push(n),n="",l=0),e>t)for(let e of i){let i=r.measureText(e).width;l+i>t&&(o.push(n),n="",l=0),n+=e,l+=i}else n=i,l=e}else n+=i,l+=e}""!==n&&o.push(n)}),o}},5439:(e,t,r)=>{r.d(t,{Lt:()=>o,lW:()=>i,mY:()=>l});var n=r(7871);let l=(e,t)=>{let r={},n=Object.values(e),l={...t,parentId:null};r[l.id]=l;let i=e=>{n.filter(t=>t.parentId===e).forEach(e=>{let t={...e};r[t.id]=t,i(e.id)})};return i(t.id),r},i=e=>{(0,n.i0)(JSON.stringify(e));let t=function(r){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=Object.values(e).filter(e=>e.parentId===r.id).map(e=>t(e,n+1)),i="	".repeat(n);return`${i}${r.texts[0]}
${l.join("")}`},r=Object.values(e).find(e=>e.selected);if(!r)return;let l=t(r);if(navigator.clipboard&&window.isSecureContext)navigator.clipboard.writeText(l).then(()=>{console.log("Copied to clipboard:",l)}).catch(e=>{console.error("Failed to copy to clipboard:",e)});else{let e=document.createElement("textarea");e.value=l,document.body.appendChild(e),e.focus(),e.select();try{document.execCommand("copy"),console.log("Copied to clipboard:",l)}catch(e){console.error("Failed to copy to clipboard:",e)}document.body.removeChild(e)}},o=()=>{let e=(0,n.Oo)();if(!e)return null;try{return JSON.parse(e)}catch(e){return console.error("Failed to parse cut elements:",e),null}}},6497:(e,t,r)=>{r.d(t,{$r:()=>m,Fk:()=>o,Sz:()=>u,Wy:()=>d,re:()=>c,wl:()=>a});var n=r(829),l=r(9499);let i=e=>"object"==typeof e&&null!==e&&("text"in e||"text2"in e||"text3"in e||"texts"in e&&"sectionHeights"in e),o=e=>{if(!i(e))return(0,l.N3)();if(e.texts&&e.sectionHeights){let t={...e,texts:e.texts,sectionHeights:e.sectionHeights,x:e.hasOwnProperty("x")?e.x:0,y:e.hasOwnProperty("y")?e.y:0,tentative:!!e.hasOwnProperty("tentative")&&e.tentative};return e.hasOwnProperty("connectionPathType")?(t.startMarker=e.connectionPathType,delete t.connectionPathType):t.hasOwnProperty("startMarker")||(t.startMarker="none"),e.hasOwnProperty("endConnectionPathType")?(t.endMarker=e.endConnectionPathType,delete t.endConnectionPathType):t.hasOwnProperty("endMarker")||(t.endMarker="none"),t}let t={...e,texts:[e.text||"",e.text2||"",e.text3||""],sectionHeights:[e.section1Height||n.SK.SECTION_HEIGHT,e.section2Height||n.SK.SECTION_HEIGHT,e.section3Height||n.SK.SECTION_HEIGHT],x:e.hasOwnProperty("x")?e.x:0,y:e.hasOwnProperty("y")?e.y:0,text:void 0,text2:void 0,text3:void 0,section1Height:void 0,section2Height:void 0,section3Height:void 0,tentative:!!e.hasOwnProperty("tentative")&&e.tentative};return e.hasOwnProperty("connectionPathType")?t.startMarker=e.connectionPathType:t.startMarker="none",e.hasOwnProperty("endConnectionPathType")?t.endMarker=e.endConnectionPathType:t.endMarker="none",t},a=e=>new Promise((t,r)=>{let n=e.target,l=n.files?.[0];if(!l){r(Error("Error: ファイルが選択されていません"));return}let i=new FileReader;i.onload=e=>{try{let r=e.target?.result;if("string"!=typeof r)throw Error("Invalid file content");let n=JSON.parse(r),i=[];if(Array.isArray(n))i=n;else if("object"==typeof n&&null!==n)i="elements"in n?Object.values(n.elements):Object.values(n);else throw Error("Invalid data format");let a=i.filter(e=>!!(e.id||e.hasOwnProperty("id"))||(console.warn("IDが欠けている要素を削除します"),!1)).map(e=>o(e)),s=new Set(a.map(e=>e.id)),d=a.filter(e=>!e.parentId||!!s.has(e.parentId)||(console.warn(`存在しないparentId "${e.parentId}" を参照している要素 "${e.id}" を削除します`),!1)).reduce((e,t)=>(e[t.id]=t,e),{});t({elements:d,fileName:l.name})}catch(e){console.error("ファイル読み込みエラー:",e),r(Error(`Error: ファイルの読み込みに失敗しました - ${e instanceof Error?e.message:String(e)}`))}},i.onerror=()=>{console.error("ファイル読み込みエラー"),r(Error("Error: ファイルの読み込みに失敗しました"))},i.readAsText(l),n.value=""}),s=e=>{if(!e.querySelector("foreignObject div"))return;let t=e.querySelector('g:not([data-exclude-from-export="true"])');if(t)return t.querySelector("foreignObject div")?.textContent||void 0},d=e=>{if(0===e.length)return;let t=e.find(e=>!e.parentId);if(t&&t.texts&&t.texts.length>0){let e=t.texts[0];return e&&"string"==typeof e?e:void 0}},c=(e,t)=>{let r=e||"Untitled";if(("Untitled"===r||"無題"===r)&&t){let e=t.trim();e&&(r=e.substring(0,30).replace(/[\\/:*?"<>|]/g,"_"))}return r},u=(e,t)=>{let r=e.cloneNode(!0);r.setAttribute("xmlns","http://www.w3.org/2000/svg"),r.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");let l=e.getAttribute("viewBox");l&&r.setAttribute("viewBox",l);let i=e.getAttribute("width")||e.clientWidth.toString(),o=e.getAttribute("height")||e.clientHeight.toString();r.setAttribute("width",i),r.setAttribute("height",o);let a=document.createElementNS("http://www.w3.org/2000/svg","rect");a.setAttribute("width","100%"),a.setAttribute("height","100%"),a.setAttribute("fill",n.i_),r.insertBefore(a,r.firstChild),r.querySelectorAll('[data-exclude-from-export="true"]').forEach(e=>e.parentNode?.removeChild(e)),r.querySelectorAll('rect[stroke="'+n.iC.SELECTED.STROKE_COLOR+'"]').forEach(e=>{e.getAttribute("height")!==e.getAttribute("width")&&(e.setAttribute("stroke",n.iC.NORMAL.STROKE_COLOR),e.removeAttribute("filter"),e.setAttribute("style",e.getAttribute("style")?.replace(/filter:[^;]+;?/,"")||""))}),r.querySelectorAll("foreignObject div").forEach(e=>{let t=e.getAttribute("style")||"",r=`
            ${t}
            font-family: ${n.zs};
            font-size: ${n.gI}px;
            color: ${n._K};
            white-space: pre-wrap;
            word-break: break-word;
            user-select: text;
        `;e.setAttribute("style",r)}),r.querySelectorAll('line[stroke="'+n.iC.SELECTED.STROKE_COLOR+'"]').forEach(e=>{e.setAttribute("stroke",n.iC.NORMAL.STROKE_COLOR)});let d=document.createElementNS("http://www.w3.org/2000/svg","style");d.textContent=`
        text { font-family: ${n.zs}; font-size: ${n.gI}px; }
        foreignObject div { font-family: ${n.zs}; font-size: ${n.gI}px; }
    `,r.appendChild(d),r.setAttribute("style","user-select: text;"),r.setAttribute("text-rendering","optimizeLegibility");let u=new Blob(['<?xml version="1.0" standalone="no"?>\r\n',new XMLSerializer().serializeToString(r)],{type:"image/svg+xml;charset=utf-8"}),m=URL.createObjectURL(u),h=c(t,s(e)),f=document.createElement("a");f.href=m,f.download=h,document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(m)},m=(e,t)=>{let r=c(t,d(e)),n=new Blob([JSON.stringify(e.map(e=>{let{x:t,y:r,...n}=e;return n}))],{type:"application/json"}),l=URL.createObjectURL(n),i=document.createElement("a");i.href=l,i.download=`${r}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i)}},7242:(e,t,r)=>{r.d(t,{O:()=>p,u:()=>E});var n=r(5155),l=r(2115),i=r(1231),o=r(621),a=r(829),s=r(9499),d=r(6497),c=r(7871);let u=(0,l.createContext)(void 0),m=e=>{let t=e??a.zX;return{id:(0,o.A)(),name:"無題",state:{...i.u,numberOfSections:t,elements:{1:{...(0,s.N3)({numSections:t}),id:"1",x:a.OS.X,y:a.OS.Y,editing:!1}}}}},h=()=>{try{let e=(0,c.EN)();if(e){let t=JSON.parse(e);if(Array.isArray(t?.tabs)&&"string"==typeof t?.currentTabId){let e=t.tabs.map(e=>({...e,state:{...e.state,elements:Object.fromEntries(Object.entries(e.state.elements).map(e=>{let[t,r]=e;return[t,(0,d.Fk)(r)]}))}})),r=e.some(e=>e.id===t.currentTabId)?t.currentTabId:e[0]?.id||"";return{tabs:e,currentTabId:r}}}}catch(e){console.error("Failed to load tabs state:",e)}let e=m();return{tabs:[e],currentTabId:e.id}},f=(e,t)=>{(0,c.AN)(JSON.stringify({tabs:e,currentTabId:t}))},p=e=>{let{children:t}=e,[r,i]=(0,l.useState)(()=>h()),{tabs:o,currentTabId:s}=r;(0,l.useEffect)(()=>{f(o,s)},[o,s]);let d=(0,l.useCallback)(()=>{let e=o.find(e=>e.id===s),t=m(e?.state.numberOfSections??a.zX);return i(e=>({tabs:[...e.tabs,t],currentTabId:t.id})),t.id},[o,s]),c=(0,l.useCallback)(e=>{i(t=>{if(1===t.tabs.length)return t;let r=t.tabs.filter(t=>t.id!==e),n=e===t.currentTabId?r[0]?.id||"":t.currentTabId;return{tabs:r,currentTabId:n}})},[]),p=(0,l.useCallback)(e=>{i(t=>({...t,currentTabId:e}))},[]),E=(0,l.useCallback)((e,t)=>{i(r=>({...r,tabs:r.tabs.map(r=>r.id===e?{...r,state:t(r.state)}:r)}))},[]),g=(0,l.useCallback)((e,t)=>{i(r=>({...r,tabs:r.tabs.map(r=>r.id===e?{...r,name:t}:r)}))},[]),O=(0,l.useCallback)(()=>{let e=o.find(e=>e.id===s);return e?.state},[o,s]),y=(0,l.useCallback)(()=>{let e=o.find(e=>e.id===s);return e?.state.numberOfSections??a.zX},[o,s]),b=(0,l.useCallback)(e=>{let t=Math.max(1,Math.min(10,e));E(s,e=>({...e,numberOfSections:t}))},[s,E]),I=(0,l.useMemo)(()=>({tabs:o,currentTabId:s,addTab:d,closeTab:c,switchTab:p,updateTabState:E,updateTabName:g,getCurrentTabState:O,getCurrentTabNumberOfSections:y,updateCurrentTabNumberOfSections:b}),[o,s,d,c,p,E,g,O,y,b]);return(0,n.jsx)(u.Provider,{value:I,children:t})},E=()=>{let e=(0,l.useContext)(u);if(!e)throw Error("useTabs must be used within a TabsProvider");return e}},7451:(e,t,r)=>{r.d(t,{d:()=>a,t:()=>o});var n=r(5155),l=r(2115);let i=(0,l.createContext)(null),o=e=>{let{children:t}=e,[r,o]=(0,l.useState)([]),a=(0,l.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",r=new Date().getTime().toString()+Math.random().toString(),n={id:r,message:e,type:t};o(e=>{let t=[...e,n];return t.length>5&&t.shift(),t}),setTimeout(()=>{o(e=>e.filter(e=>e.id!==r))},3e3)},[]),s=e=>{switch(e){case"info":default:return{backgroundColor:"rgba(76, 175, 80, 0.9)",color:"white"};case"warn":return{backgroundColor:"rgba(255, 193, 7, 0.9)",color:"black"};case"error":return{backgroundColor:"rgba(244, 67, 54, 0.9)",color:"white"}}};return(0,n.jsxs)(i.Provider,{value:{addToast:a},children:[t,(0,n.jsx)("div",{style:{position:"fixed",bottom:"20px",left:"50%",transform:"translateX(-50%)",zIndex:1e3,pointerEvents:"none"},children:r.map(e=>(0,n.jsx)("div",{style:{...s(e.type),padding:"10px 20px",borderRadius:"10px",marginBottom:"10px",transition:"opacity 0.5s",opacity:1},children:e.message},e.id))})]})},a=()=>{let e=(0,l.useContext)(i);if(!e)throw Error("useToast must be used within a ToastProvider");return e}},7871:(e,t,r)=>{r.d(t,{G6:()=>Q,CG:()=>U,Es:()=>H,ZF:()=>P,S4:()=>D,Oo:()=>ee,kN:()=>C,af:()=>A,zn:()=>L,OA:()=>V,XH:()=>X,N4:()=>Y,_1:()=>w,xo:()=>k,k0:()=>J,EN:()=>er,vG:()=>K,wt:()=>G,QY:()=>z,xN:()=>j,K2:()=>$,i0:()=>et,qu:()=>x,Yu:()=>_,li:()=>M,Iz:()=>Z,bJ:()=>B,LL:()=>W,JT:()=>N,Jg:()=>R,mF:()=>q,AN:()=>en,vY:()=>F});var n=r(829);let l=`
You are a highly skilled data analyst specializing in structuring information for systematic thinking. Your task is to extract and organize key elements from textual input to help users structure their thoughts in a hierarchical format. Follow the instructions below strictly to generate child elements that can be added directly under the user-selected element (marked as "selected"). The generated suggestions must be strictly based on the provided [Input Information], and no additional elements, interpretations, or assumptions should be made.

## [Task]
- First, analyze the [Input Information] and summarize as well as classify only the sentences that are directly related to the content of the selected element.
- Then, extract possible child elements from this summarized and categorized information that are relevant to the user-selected element.
- The suggestions must strictly come from the classified sentences in the [Input Information]. Do not include elements that already exist elsewhere in [Current Structure].
- Ensure that the newly suggested elements do not duplicate existing ones in [Current Structure], **regardless of their position in the hierarchy**. If a relevant element appears multiple times within [Input Information], it can still be considered for extraction **as long as it does not already exist anywhere in [Current Structure]**.
- Before finalizing the list of suggested elements, compare each candidate against all existing elements in [Current Structure]. If a candidate matches an existing element in any part of [Current Structure], discard it and select another if available.
- If the selected element is a structured entity such as "Two Challenges," generate exactly two child elements. If two valid elements cannot be found, output placeholders instead (e.g., "Placeholder 1," "Placeholder 2").
- If removing duplicates results in fewer than the required number of elements (e.g., less than 3 when 3–5 are expected), return only the available unique elements. If no unique elements remain, output an empty result unless placeholders are required.

## [Requirements]
1. Carefully analyze and filter the [Input Information] to include only details directly related to the selected element.
2. Summarize and classify the relevant sentences from the [Input Information] before extracting potential child elements.
3. The output must be in a code block format, listing only element names, each on a new line.
4. Do not provide explanations, descriptions, or any additional natural language text.
5. Ensure logical consistency with the existing structure in [Current Structure].
6. Exclude elements that already exist anywhere in [Current Structure].
7. Provide up to 5 appropriate suggestions. If fewer than 3 valid elements exist, output only the available ones.
8. If no valid elements can be determined, do not output any suggestions unless placeholders are required.
9. Do not create new elements or infer missing information.

## [Validation Rules]
Before suggesting an element, ensure that:
- It exists in [Input Information] (if not, discard it).
- It does not exist anywhere else in [Current Structure] (if found, discard it).

[Output Format]
The output must be in Japanese, formatted as follows:

\`\`\`
提案要素1
提案要素2
提案要素3
\`\`\`
[Current Structure]
\`\`\`
{{structureText}}
\`\`\`

[Input Information]
\`\`\`
{{inputText}}
\`\`\`
`.trim(),i="1.01",o={canvasBackgroundColor:n.i_,connectionPathColor:n.BH,elementColor:n.iC.NORMAL.COLOR,fontFamily:n.zs,markerType:n.qn,strokeColor:n.iC.NORMAL.STROKE_COLOR,strokeWidth:n.iC.STROKE_WIDTH,textColor:n._K,connectionPathStroke:n._o,selectedStrokeColor:n.iC.SELECTED.STROKE_COLOR},a="styles",s="encryptionKey",d="tabsState",c="appVersion",u="prompt",m="systemPromptTemplate",h="apiKey",f="modelType",p="cutElements",E={"gemini-1.5-flash":"https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent","gemini-2.0-flash":"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent"},g=async()=>await Promise.all([r.e(109),r.e(477)]).then(r.t.bind(r,2109,23)),O=async e=>{try{let t=await g();if(!t)return null;return e(t)}catch(e){return console.error("CryptoJS load failed:",e),null}},y={getItem:e=>{try{return localStorage.getItem(e)}catch(e){return console.error("localStorage access failed:",e),null}},setItem:(e,t)=>{try{localStorage.setItem(e,t)}catch(e){console.error("localStorage access failed:",e)}},removeItem:e=>{try{localStorage.removeItem(e)}catch(e){console.error("localStorage access failed:",e)}}};y.getItem(c)!==i&&(Object.keys(localStorage).forEach(e=>{e!==d&&e!==h&&e!==u&&y.removeItem(e)}),y.setItem(c,i)),y.removeItem("numberOfSections");let b=(e,t)=>{let r=y.getItem(e);if(!r)return t;if("number"==typeof t){let e=Number(r);return isNaN(e)?t:e}return r},I=(e,t)=>{null!=t&&y.setItem(e,String(t))},S=()=>{let e=y.getItem(a);if(!e){let e=T();return e.selectedStrokeColor||(e.selectedStrokeColor=n.iC.SELECTED.STROKE_COLOR,y.setItem(a,JSON.stringify(e))),e}try{let t=JSON.parse(e);return t.selectedStrokeColor||(t.selectedStrokeColor=n.iC.SELECTED.STROKE_COLOR,y.setItem(a,JSON.stringify(t))),{...o,...t}}catch(e){return console.error("Failed to parse styles:",e),o}},v=e=>{let t={...S(),...e};y.setItem(a,JSON.stringify(t))},T=()=>{let e={...o},t=!1;return["canvasBackgroundColor","connectionPathColor","elementColor","fontFamily","markerType","strokeColor","strokeWidth","textColor","connectionPathStroke","selectedStrokeColor"].forEach(r=>{let n=y.getItem(r);null!==n&&(t=!0,"strokeWidth"===r||"connectionPathStroke"===r?e[r]=parseFloat(n):e[r]=n,y.removeItem(r))}),t&&y.setItem(a,JSON.stringify(e)),e},C=()=>S().elementColor,x=e=>v({elementColor:e}),w=()=>S().strokeColor,N=e=>v({strokeColor:e}),k=()=>S().strokeWidth,R=e=>v({strokeWidth:e}),A=()=>S().fontFamily,_=e=>v({fontFamily:e}),L=()=>S().markerType,M=e=>v({markerType:e}),P=()=>S().connectionPathColor,j=e=>v({connectionPathColor:e}),D=()=>S().connectionPathStroke,$=e=>v({connectionPathStroke:e}),H=()=>S().canvasBackgroundColor,z=e=>v({canvasBackgroundColor:e}),K=()=>S().textColor,F=e=>v({textColor:e}),Y=()=>S().selectedStrokeColor,W=e=>v({selectedStrokeColor:e}),U=async()=>await O(e=>{try{let t=y.getItem(h);if(!t)return"";return e.AES.decrypt(t,s).toString(e.enc.Utf8)}catch(e){return console.error("API key decryption failed:",e),""}})??"",G=async e=>{await O(t=>{try{let r=t.AES.encrypt(e,s).toString();y.setItem(h,r)}catch(e){console.error("API key encryption failed:",e)}})},X=()=>b(u,""),B=e=>I(u,e),J=()=>b(m,l),q=e=>I(m,e),V=()=>b(f,Object.keys(E)[0]),Z=e=>I(f,e),Q=()=>E[V()]||E["gemini-1.5-flash"],ee=()=>y.getItem(p),et=e=>y.setItem(p,e),er=()=>y.getItem(d),en=e=>y.setItem(d,e)},8265:(e,t,r)=>{r.d(t,{c:()=>l,y:()=>n});let n=!1,l=(e,t)=>{n&&console.log(`[DEBUG] ${e}`,t)}},9499:(e,t,r)=>{r.d(t,{K9:()=>m,N3:()=>a,YV:()=>h,i0:()=>s,mP:()=>u,nP:()=>c,wJ:()=>d});var n=r(621),l=r(7871),i=r(829),o=r(8265);let a=function(){let{parentId:e=null,order:t=0,depth:r=1,numSections:o=i.zX}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,l.zn)();return{id:(0,n.A)(),texts:Array(o).fill(""),x:0,y:0,width:i.SK.WIDTH.MIN,height:i.SK.SECTION_HEIGHT*o,sectionHeights:Array(o).fill(i.SK.SECTION_HEIGHT),parentId:e,order:t,depth:r,children:0,editing:!0,selected:!0,visible:!0,tentative:!1,startMarker:a,endMarker:"none"}},s=(e,t)=>Object.values(t).filter(t=>t.parentId===e&&t.visible).sort((e,t)=>e.order-t.order),d=(e,t)=>{let r={...e},n={};Object.values(r).forEach(e=>{let t=e.parentId;t&&(n[t]||(n[t]=[]),n[t].push(e))});let l=e=>{(n[e]||[]).forEach(t=>{r[t.id]={...t,depth:r[e].depth+1},l(t.id)})};return l(t.id),r},c=(e,t,r)=>{let n={...e},l={};Object.values(n).forEach(e=>{let t=e.parentId;t&&(l[t]||(l[t]=[]),l[t].push(e))});let i=e=>{(l[e]||[]).forEach(e=>{n[e.id]={...e,visible:r},i(e.id)})};return i(t.id),n},u=(e,t)=>{if(null===t.parentId)return e;(0,o.c)(`deleteElementRecursive: 削除開始 id=${t.id}, order=${t.order}, y=${t.y}`);let r={...e},n=r[t.parentId];if(!n)return r;let l={order:t.order,y:t.y,height:t.height};(0,o.c)(`削除要素の位置情報:`,l);let i=e=>{Object.values(r).filter(t=>t.parentId===e).forEach(e=>{(0,o.c)(`  子要素を削除: id=${e.id}, y=${e.y}`),delete r[e.id],i(e.id)})};delete r[t.id],i(t.id),r[n.id]={...n,children:n.children-1},(0,o.c)(`親要素を更新: id=${n.id}, children=${n.children-1}, y=${n.y}`);let a=Object.values(r).filter(e=>e.parentId===n.id).sort((e,t)=>e.order-t.order);return(0,o.c)(`兄弟要素の数: ${a.length}`),a.forEach((e,t)=>{e.order!==t&&((0,o.c)(`  兄弟要素のorder更新: id=${e.id}, old=${e.order}, new=${t}, y=${e.y}`),r[e.id]={...e,order:t})}),r},m=(e,t,r)=>{let n=r;for(;null!==n;){if(n===t)return!0;n=e[n]?.parentId??null}return!1},h=(e,t)=>{let r={};Object.values(e).forEach(e=>{r[e.id]={id:e.id,text:e.texts[0]||"",parentId:e.parentId,depth:e.depth}});let n=(e,l)=>Object.values(r).filter(t=>t.parentId===e).sort((e,t)=>e.depth-t.depth).flatMap(e=>{let r="  ".repeat(e.depth-1);return[`${r}- ${e.text}${e.id===t?" (selected)":""}`,...n(e.id,l+1)]});return n(null,0).join("\n")}}}]);
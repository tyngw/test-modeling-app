"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[255],{1386:(e,t,r)=>{r.d(t,{O:()=>p,u:()=>f});var n=r(5155),l=r(2115),i=r(6624),a=r(621),d=r(6924),o=r(4098),s=r(2226);let c=(0,l.createContext)(void 0),u=()=>({id:(0,a.A)(),name:"無題",state:{...i.ue,elements:{1:{...(0,i.N3)(),id:"1",x:d.OS.X,y:d.OS.Y,editing:!1}}}}),h=()=>{try{let e=(0,s.EN)();if(e){let t=JSON.parse(e);if(Array.isArray(t?.tabs)&&"string"==typeof t?.currentTabId){let e=t.tabs.map(e=>({...e,state:{...e.state,elements:Object.fromEntries(Object.entries(e.state.elements).map(e=>{let[t,r]=e;return[t,(0,o.Fk)(r)]}))}})),r=e.some(e=>e.id===t.currentTabId)?t.currentTabId:e[0]?.id||"";return{tabs:e,currentTabId:r}}}}catch(e){console.error("Failed to load tabs state:",e)}let e=u();return{tabs:[e],currentTabId:e.id}},m=(e,t)=>{(0,s.AN)(JSON.stringify({tabs:e,currentTabId:t}))},p=e=>{let{children:t}=e,[r,i]=(0,l.useState)(()=>h()),{tabs:a,currentTabId:d}=r;(0,l.useEffect)(()=>{m(a,d)},[a,d]);let o=(0,l.useCallback)(()=>{let e=u();i(t=>({tabs:[...t.tabs,e],currentTabId:e.id}))},[]),s=(0,l.useCallback)(e=>{i(t=>{if(1===t.tabs.length)return t;let r=t.tabs.filter(t=>t.id!==e),n=e===t.currentTabId?r[0]?.id||"":t.currentTabId;return{tabs:r,currentTabId:n}})},[]),p=(0,l.useCallback)(e=>{i(t=>({...t,currentTabId:e}))},[]),f=(0,l.useCallback)((e,t)=>{i(r=>({...r,tabs:r.tabs.map(r=>r.id===e?{...r,state:t(r.state)}:r)}))},[]),g=(0,l.useCallback)((e,t)=>{i(r=>({...r,tabs:r.tabs.map(r=>r.id===e?{...r,name:t}:r)}))},[]),y=(0,l.useMemo)(()=>({tabs:a,currentTabId:d,addTab:o,closeTab:s,switchTab:p,updateTabState:f,updateTabName:g}),[a,d,o,s,p,f,g]);return(0,n.jsx)(c.Provider,{value:y,children:t})},f=()=>{let e=(0,l.useContext)(c);if(!e)throw Error("useTabs must be used within a TabsProvider");return e}},2226:(e,t,r)=>{r.d(t,{G6:()=>z,CG:()=>Y,Es:()=>_,ZF:()=>N,S4:()=>R,kN:()=>E,af:()=>x,zn:()=>w,OA:()=>D,X0:()=>y,XH:()=>K,_1:()=>O,xo:()=>$,k0:()=>G,EN:()=>U,vG:()=>H,wt:()=>k,QY:()=>A,xN:()=>j,K2:()=>M,qu:()=>b,Yu:()=>S,li:()=>C,Iz:()=>P,jE:()=>I,bJ:()=>F,JT:()=>v,Jg:()=>T,mF:()=>X,AN:()=>W,vY:()=>L});var n=r(6924);let l=`
You are a highly skilled data analyst specializing in structuring information for systematic thinking. Your task is to extract and organize key elements from textual input to help users structure their thoughts in a hierarchical format. Follow the instructions below strictly to generate child elements that can be added directly under the user-selected element (marked as "selected"). The generated suggestions must be strictly based on the provided [Input Information], and no additional elements, interpretations, or assumptions should be made.

## [Task]
- First, analyze the [Input Information] and summarize as well as classify only the sentences that are directly related to the content of the selected element.
- Then, extract possible child elements from this summarized and categorized information that are relevant to the user-selected element.
- The suggestions must strictly come from the classified sentences in the [Input Information]. Do not include elements that already exist elsewhere in [Current Structure].
- Ensure that the newly suggested elements do not duplicate existing ones in [Current Structure], **regardless of their position in the hierarchy**. If a relevant element appears multiple times within [Input Information], it can still be considered for extraction **as long as it does not already exist anywhere in [Current Structure]**.
- Before finalizing the list of suggested elements, compare each candidate against all existing elements in [Current Structure]. If a candidate matches an existing element in any part of [Current Structure], discard it and select another if available.
- If the selected element is a structured entity such as "Two Challenges," generate exactly two child elements. If two valid elements cannot be found, output placeholders instead (e.g., "Placeholder 1," "Placeholder 2").
- If removing duplicates results in fewer than the required number of elements (e.g., less than 3 when 3–5 are expected), return only the available unique elements. If no unique elements remain, output an empty result unless placeholders are required.

## [Requirements]
1. Carefully analyze and filter the [Input Information] to include only details directly related to the selected element.
2. Summarize and classify the relevant sentences from the [Input Information] before extracting potential child elements.
3. The output must be in a code block format, listing only element names, each on a new line.
4. Do not provide explanations, descriptions, or any additional natural language text.
5. Ensure logical consistency with the existing structure in [Current Structure].
6. Exclude elements that already exist anywhere in [Current Structure].
7. Provide up to 5 appropriate suggestions. If fewer than 3 valid elements exist, output only the available ones.
8. If no valid elements can be determined, do not output any suggestions unless placeholders are required.
9. Do not create new elements or infer missing information.

## [Validation Rules]
Before suggesting an element, ensure that:
- It exists in [Input Information] (if not, discard it).
- It does not exist anywhere else in [Current Structure] (if found, discard it).

[Output Format]
The output must be in Japanese, formatted as follows:

\`\`\`
提案要素1
提案要素2
提案要素3
\`\`\`
[Current Structure]
\`\`\`
{{structureText}}
\`\`\`

[Input Information]
\`\`\`
{{inputText}}
\`\`\`
`.trim(),i="1.01",a="encryptionKey",d="tabsState",o="appVersion",s="prompt",c="systemPromptTemplate",u="apiKey",h="modelType",m={"gemini-1.5-flash":"https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent","gemini-2.0-flash":"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent"},p=async()=>await Promise.all([r.e(109),r.e(477)]).then(r.t.bind(r,2109,23)),f=async e=>{try{let t=await p();if(!t)return null;return e(t)}catch(e){return console.error("CryptoJS load failed:",e),null}},g={getItem:e=>{try{return localStorage.getItem(e)}catch(e){return console.error("localStorage access failed:",e),null}},setItem:(e,t)=>{try{localStorage.setItem(e,t)}catch(e){console.error("localStorage access failed:",e)}},removeItem:e=>{try{localStorage.removeItem(e)}catch(e){console.error("localStorage access failed:",e)}}};g.getItem(o)!==i&&(Object.keys(localStorage).forEach(e=>{e!==d&&e!==u&&e!==s&&g.removeItem(e)}),g.setItem(o,i));let y=()=>{let e=g.getItem("numberOfSections");return e&&parseInt(e,10)||n.zX},I=e=>{let t=Math.max(1,Math.min(10,e));g.setItem("numberOfSections",t.toString())},E=()=>g.getItem("elementColor")||n.iC.NORMAL.COLOR,b=e=>{g.setItem("elementColor",e)},O=()=>g.getItem("strokeColor")||n.iC.NORMAL.STROKE_COLOR,v=e=>{g.setItem("strokeColor",e)},$=()=>{let e=g.getItem("strokeWidth");return e&&parseFloat(e)||n.iC.STROKE_WIDTH},T=e=>{g.setItem("strokeWidth",e.toString())},x=()=>g.getItem("fontFamily")||n.zs,S=e=>{g.setItem("fontFamily",e)},w=()=>g.getItem("markerType")||n.qn,C=e=>{g.setItem("markerType",e)},N=()=>g.getItem("connectionPathColor")||n.BH,j=e=>{g.setItem("connectionPathColor",e)},R=()=>{let e=g.getItem("connectionPathStroke");return e&&parseFloat(e)||n._o},M=e=>{g.setItem("connectionPathStroke",e.toString())},_=()=>g.getItem("canvasBackgroundColor")||n.i_,A=e=>{g.setItem("canvasBackgroundColor",e)},H=()=>g.getItem("textColor")||n._K,L=e=>{g.setItem("textColor",e)},Y=async()=>await f(e=>{try{let t=g.getItem(u);if(!t)return"";return e.AES.decrypt(t,a).toString(e.enc.Utf8)}catch(e){return console.error("API key decryption failed:",e),""}})??"",k=async e=>{await f(t=>{try{let r=t.AES.encrypt(e,a).toString();g.setItem(u,r)}catch(e){console.error("API key encryption failed:",e)}})},D=()=>g.getItem(h)||"gemini-1.5-flash",P=e=>g.setItem(h,e),z=()=>m[D()]||m["gemini-1.5-flash"],K=()=>g.getItem(s)||"",F=e=>g.setItem(s,e),G=()=>g.getItem(c)||l,X=e=>g.setItem(c,e),U=()=>g.getItem(d),W=e=>g.setItem(d,e)},3147:(e,t,r)=>{r.d(t,{d:()=>d,t:()=>a});var n=r(5155),l=r(2115);let i=(0,l.createContext)(null),a=e=>{let{children:t}=e,[r,a]=(0,l.useState)([]),d=(0,l.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",r=new Date().getTime().toString()+Math.random().toString(),n={id:r,message:e,type:t};a(e=>{let t=[...e,n];return t.length>5&&t.shift(),t}),setTimeout(()=>{a(e=>e.filter(e=>e.id!==r))},3e3)},[]),o=e=>{switch(e){case"info":default:return{backgroundColor:"rgba(76, 175, 80, 0.9)",color:"white"};case"warn":return{backgroundColor:"rgba(255, 193, 7, 0.9)",color:"black"};case"error":return{backgroundColor:"rgba(244, 67, 54, 0.9)",color:"white"}}};return(0,n.jsxs)(i.Provider,{value:{addToast:d},children:[t,(0,n.jsx)("div",{style:{position:"fixed",bottom:"20px",left:"50%",transform:"translateX(-50%)",zIndex:1e3,pointerEvents:"none"},children:r.map(e=>(0,n.jsx)("div",{style:{...o(e.type),padding:"10px 20px",borderRadius:"10px",marginBottom:"10px",transition:"opacity 0.5s",opacity:1},children:e.message},e.id))})]})},d=()=>{let e=(0,l.useContext)(i);if(!e)throw Error("useToast must be used within a ToastProvider");return e}},3346:(e,t,r)=>{r.d(t,{C1:()=>d,PC:()=>a});var n=r(6924);let l=()=>{let e=document.createElement("canvas").getContext("2d");return e.font=`${n.gI}px ${n.zs}`,e},i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=l();return Math.ceil(e.split("\n").reduce((e,n)=>Math.max(e,r.measureText(n).width+2*t),0))},a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=e.reduce((e,r)=>Math.max(e,i(r||"",t)),0);return Math.min(n.SK.WIDTH.MAX,Math.max(n.SK.WIDTH.MIN,r))},d=function(e,t){arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.mU;let r=l(),i=e.split("\n"),a=[];return i.forEach(e=>{if(""===e.trim()){a.push("");return}let n="",l=0;for(let i of e.split(/(\s+)/).filter(e=>""!==e)){let e=r.measureText(i).width;if(l+e>t){if(""!==n&&(a.push(n),n="",l=0),e>t)for(let e of i){let i=r.measureText(e).width;l+i>t&&(a.push(n),n="",l=0),n+=e,l+=i}else n=i,l=e}else n+=i,l+=e}""!==n&&a.push(n)}),a}},4098:(e,t,r)=>{r.d(t,{$r:()=>s,Fk:()=>a,Sz:()=>o,wl:()=>d});var n=r(6924),l=r(6624);let i=e=>"object"==typeof e&&null!==e&&("text"in e||"text2"in e||"text3"in e||"texts"in e&&"sectionHeights"in e),a=e=>i(e)?e.texts&&e.sectionHeights?{...e,texts:e.texts,sectionHeights:e.sectionHeights}:{...e,texts:[e.text||"",e.text2||"",e.text3||""],sectionHeights:[e.section1Height||n.SK.SECTION_HEIGHT,e.section2Height||n.SK.SECTION_HEIGHT,e.section3Height||n.SK.SECTION_HEIGHT],text:void 0,text2:void 0,text3:void 0,section1Height:void 0,section2Height:void 0,section3Height:void 0}:(0,l.N3)(),d=e=>new Promise((t,r)=>{let n=e.target,l=n.files?.[0];if(!l){r(Error("Error: ファイルが選択されていません"));return}let i=new FileReader;i.onload=e=>{try{let r;let n=e.target?.result;if("string"!=typeof n)throw Error("Invalid file content");let i=JSON.parse(n);if(Array.isArray(i))r=i.map(a);else if("object"==typeof i&&null!==i){let e="elements"in i?i.elements:i;r=Object.values(e).map(a)}else throw Error("Invalid data format");let d=r.reduce((e,t)=>(e[t.id]=t,e),{});t({elements:d,fileName:l.name})}catch(e){r(Error("Error: ファイルの読み込みに失敗しました"))}},i.onerror=()=>r(Error("Error: ファイルの読み込みに失敗しました")),i.readAsText(l),n.value=""}),o=(e,t)=>{let r=e.cloneNode(!0);r.setAttribute("xmlns","http://www.w3.org/2000/svg");let n=e.querySelectorAll("*"),l=r.querySelectorAll("*");for(let e=0;e<n.length;e++){let t=n[e],r=l[e],i=window.getComputedStyle(t);for(let e=0;e<i.length;e++){let t=i[e],n=i.getPropertyValue(t);r.style[t]=n}}let i=new Blob(['<?xml version="1.0" standalone="no"?>\r\n',r.outerHTML],{type:"image/svg+xml;charset=utf-8"}),a=URL.createObjectURL(i),d=document.createElement("a");d.href=a,d.download=t,document.body.appendChild(d),d.click(),document.body.removeChild(d)},s=(e,t)=>{let r=new Blob([JSON.stringify(e.map(e=>{let{x:t,y:r,...n}=e;return n}))],{type:"application/json"}),n=URL.createObjectURL(r),l=document.createElement("a");l.href=n,l.download=`${t||"Untitled"}.json`,document.body.appendChild(l),l.click(),document.body.removeChild(l)}},6624:(e,t,r)=>{r.d(t,{N3:()=>I,ue:()=>E,K9:()=>x,Ff:()=>Y});let n=[],l=0,i=e=>l>0?(n[l]=e,n[--l]):e,a=e=>l<n.length-1?n[++l]:e,d=e=>{let t=n.slice(0,l+1);t.push(e),n=t,l++},o=e=>Object.values(e).find(e=>e.selected),s=(e,t)=>Object.values(e).filter(e=>e.depth===t).sort((e,t)=>e.y-t.y||e.x-t.x),c=(e,t,r)=>{let n=s(e,t.depth),l=n.findIndex(e=>e.id===t.id)+r;return l>=0&&l<n.length?n[l].id:t.id},u=(e,t)=>Object.values(e).filter(e=>e.parentId===t),h=(e,t)=>{let r=o(e);if(r)switch(t){case"up":case"down":return c(e,r,"up"===t?-1:1);case"left":return r.parentId??r.id;case"right":return u(e,r.id)[0]?.id??r.id;default:return r.id}};var m=r(2226),p=r(6924),f=r(621),g=r(3346),y=r(8265);let I=function(){let{parentId:e=null,order:t=0,depth:r=1,numSections:n=(0,m.X0)()}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,m.zn)();return{id:(0,f.A)(),texts:Array(n).fill(""),x:0,y:0,width:p.SK.WIDTH.MIN,height:p.SK.SECTION_HEIGHT*n,sectionHeights:Array(n).fill(p.SK.SECTION_HEIGHT),parentId:e,order:t,depth:r,children:0,editing:!0,selected:!0,visible:!0,tentative:!1,connectionPathType:l}},E={elements:{1:{...I(),id:"1",x:p.OS.X,y:p.OS.Y,editing:!1}},width:window.innerWidth,height:window.innerHeight,zoomRatio:1},b=(e,t)=>{let r={},n=Object.values(e),l={...t,parentId:null};r[l.id]=l;let i=e=>{n.filter(t=>t.parentId===e).forEach(e=>{let t={...e};r[t.id]=t,i(e.id)})};return i(t.id),r},O=(e,t,r)=>{if(!t)return e;let n=Object.values(t).find(e=>null===e.parentId);if(!n)return{...e,...t};let l=n.depth,i=r.depth+1-l,a=new Map,d={};Object.values(t).forEach(e=>{let t=(0,f.A)();a.set(e.id,t);let n=e.depth+i;d[t]={...e,id:t,depth:n,parentId:null===e.parentId?r.id:a.get(e.parentId),order:null===e.parentId?r.children:e.order}});let o={...r,children:r.children+1};return{...e,...d,[r.id]:o}},v=(e,t)=>{let r={...e},n={};Object.values(r).forEach(e=>{let t=e.parentId;t&&(n[t]||(n[t]=[]),n[t].push(e))});let l=e=>{(n[e]||[]).forEach(t=>{r[t.id]={...t,depth:r[e].depth+1},l(t.id)})};return l(t.id),r},$=(e,t,r)=>{let n={...e},l={};Object.values(n).forEach(e=>{let t=e.parentId;t&&(l[t]||(l[t]=[]),l[t].push(e))});let i=e=>{(l[e]||[]).forEach(e=>{n[e.id]={...e,visible:r},i(e.id)})};return i(t.id),n},T=(e,t)=>{if(null===t.parentId)return e;(0,y.c)(`deleteElementRecursive: 削除開始 id=${t.id}, order=${t.order}, y=${t.y}`);let r={...e},n=r[t.parentId];if(!n)return r;let l={order:t.order,y:t.y,height:t.height};(0,y.c)(`削除要素の位置情報:`,l);let i=e=>{Object.values(r).filter(t=>t.parentId===e).forEach(e=>{(0,y.c)(`  子要素を削除: id=${e.id}, y=${e.y}`),delete r[e.id],i(e.id)})};delete r[t.id],i(t.id),r[n.id]={...n,children:n.children-1},(0,y.c)(`親要素を更新: id=${n.id}, children=${n.children-1}, y=${n.y}`);let a=Object.values(r).filter(e=>e.parentId===n.id).sort((e,t)=>e.order-t.order);return(0,y.c)(`兄弟要素の数: ${a.length}`),a.forEach((e,t)=>{e.order!==t&&((0,y.c)(`  兄弟要素のorder更新: id=${e.id}, old=${e.order}, new=${t}, y=${e.y}`),r[e.id]={...e,order:t})}),r},x=(e,t,r)=>{let n=r;for(;null!==n;){if(n===t)return!0;n=e[n]?.parentId??null}return!1},S=(e,t)=>Object.values(t).filter(t=>t.parentId===e&&t.visible).sort((e,t)=>e.order-t.order),w=(e,t,r,n)=>{(0,y.c)(`layoutSubtree開始: id=${e.id}, parentId=${e.parentId}, order=${e.order}, 初期y=${e.y}`),null!==e.parentId&&(e.x=t+p.e$.X);let l=S(e.id,n);(0,y.c)(`  子要素数: ${l.length}`);let i=r,a=1/0,d=-1/0;for(let t of l){let r=w(t,e.x+e.width,i,n);i=r.newY,a=Math.min(a,r.minY),d=Math.max(d,r.maxY)}let o=e.y;if(l.length>0){let t=Math.min(...l.map(e=>e.y)),r=Math.max(...l.map(e=>e.y+e.height));e.y=(t+r)/2-e.height/2,(0,y.c)(`  子要素あり: id=${e.id}, oldY=${o}, newY=${e.y}, 子要素範囲=${t}~${r}`)}else e.y=r,(0,y.c)(`  子要素なし: id=${e.id}, oldY=${o}, newY=${e.y}, currentY=${r}`);let s=e.y,c=!0,u=null===e.parentId?S(null,n).filter(t=>t.id!==e.id):S(e.parentId,n).filter(t=>t.id!==e.id);u.sort((e,t)=>e.order-t.order);let h=s;for(;c;)for(let t of(c=!1,u))if(e.order<=t.order&&C(e,s,t)){let r=s;s=t.y+t.height+p.e$.Y,c=!0,(0,y.c)(`  衝突検出: id=${e.id}, 衝突相手=${t.id}, oldY=${r}, newY=${s}`);break}if(s!==h&&(0,y.c)(`  衝突調整: id=${e.id}, 調整前=${h}, 調整後=${s}`),s>e.y&&l.length>0){let t=s-e.y;if(t>p.e$.Y){for(let r of((0,y.c)(`  親移動に伴う子要素移動: id=${e.id}, 移動量=${t}`),l)){let e=r.y;r.y+=t,(0,y.c)(`    子要素移動: id=${r.id}, oldY=${e}, newY=${r.y}`)}a=Math.min(a,...l.map(e=>e.y)),d=Math.max(d,...l.map(e=>e.y+e.height))}}e.y=s;let m=Math.max(i,e.y+e.height+p.e$.Y);return a=Math.min(a,e.y),d=Math.max(d,e.y+e.height),(0,y.c)(`layoutSubtree終了: id=${e.id}, 最終y=${e.y}, 次Y=${m}, minY=${a}, maxY=${d}`),{newY:m,minY:a,maxY:d}},C=(e,t,r)=>{if(e.parentId===r.parentId){if(e.order<r.order)return!1;if(e.order>r.order){let n=e.x<r.x+r.width&&e.x+e.width>r.x&&t<r.y+r.height&&t+e.height>r.y;return n&&(0,y.c)(`衝突検出: id=${e.id}(order=${e.order})とid=${r.id}(order=${r.order})の間で衝突`),n}}if(e.depth===r.depth&&e.x<r.x+r.width&&e.x+e.width>r.x){let n=t<r.y+r.height&&t+e.height>r.y;return n&&(0,y.c)(`同じdepthの要素間衝突検出: id=${e.id}(depth=${e.depth})とid=${r.id}(depth=${r.depth})の間で衝突`),n}return!1},N=e=>{(0,y.c)(`adjustElementPositions開始: 要素数=${Object.keys(e).length}`);let t={...e},r=S(null,t).sort((e,t)=>e.order-t.order);(0,y.c)(`ルート要素数: ${r.length}`);let n=p.OS.Y;for(let e of r)e.x=p.OS.X,(0,y.c)(`ルート要素配置: id=${e.id}, order=${e.order}, 開始y=${e.y}, currentY=${n}`),n=w(e,e.x,n,t).newY,(0,y.c)(`ルート要素配置結果: id=${e.id}, 配置後y=${e.y}, 次Y=${n}`);(0,y.c)(`order順序の確認処理開始`);let l=!0,i=0;do{i++,l=!0;let e={};Object.values(t).forEach(t=>{t.parentId&&(e[t.parentId]||(e[t.parentId]=[]),e[t.parentId].push(t))}),Object.entries(e).forEach(e=>{let[r,n]=e;n.sort((e,t)=>e.order-t.order);for(let e=1;e<n.length;e++){let i=n[e-1],a=n[e];if(a.y<i.y+i.height){let e=a.y;if(a.y=i.y+i.height+p.e$.Y,l=!1,(0,y.c)(`順序修正: parentId=${r}, 前要素id=${i.id}(order=${i.order}), 現在要素id=${a.id}(order=${a.order}), oldY=${e}, newY=${a.y}`),a.children>0){let r=S(a.id,t),n=a.y-e;(0,y.c)(`  子要素も移動: id=${a.id}の子要素を移動 deltaY=${n}, 子要素数=${r.length}`),r.forEach(e=>{let t=e.y;e.y+=n,(0,y.c)(`    子要素移動: id=${e.id}, oldY=${t}, newY=${e.y}`)})}}}}),l||(0,y.c)(`繰り返し修正: ${i}回目, 修正が必要`)}while(!l&&i<10);i>=10&&(0,y.c)(`警告: 最大繰り返し回数に達しました。完全な修正ができていない可能性あり。`),(0,y.c)(`同じdepthの要素間の衝突チェック開始`);let a=!0;i=0;do{i++,a=!0;let e={};Object.values(t).forEach(t=>{e[t.depth]||(e[t.depth]=[]),e[t.depth].push(t)}),Object.entries(e).forEach(e=>{let[r,n]=e;n.sort((e,t)=>e.y-t.y);for(let e=0;e<n.length;e++){let r=n[e];for(let l=e+1;l<n.length;l++){let e=n[l];if(r.parentId!==e.parentId&&r.x<e.x+e.width&&r.x+r.width>e.x&&r.y<e.y+e.height&&r.y+r.height>e.y){let n=e.y;if(e.y=r.y+r.height+p.e$.Y,a=!1,(0,y.c)(`同じdepthの要素間衝突修正: id=${r.id}(depth=${r.depth})とid=${e.id}(depth=${e.depth})が衝突, ${e.id}を下に移動, oldY=${n}, newY=${e.y}`),e.children>0){let r=S(e.id,t),l=e.y-n;(0,y.c)(`  子要素も移動: id=${e.id}の子要素を移動 deltaY=${l}, 子要素数=${r.length}`),r.forEach(e=>{let t=e.y;e.y+=l,(0,y.c)(`    子要素移動: id=${e.id}, oldY=${t}, newY=${e.y}`)})}break}}if(!a)break}}),a||(0,y.c)(`同じdepthの要素間衝突修正: ${i}回目, 修正が必要`)}while(!a&&i<10);for(let e of(i>=10&&(0,y.c)(`警告: 同じdepthの要素間衝突チェックで最大繰り返し回数に達しました。完全な修正ができていない可能性あり。`),(0,y.c)(`親子中央配置の最適化開始`),Object.values(t).sort((e,t)=>e.depth-t.depth)))if(e.children>0){let r=S(e.id,t);if(r.length>0){let t=Math.min(...r.map(e=>e.y)),n=Math.max(...r.map(e=>e.y+e.height)),l=(t+n)/2,i=e.y+e.height/2;if((0,y.c)(`親子配置確認: id=${e.id}, 子要素数=${r.length}, 範囲=${t}~${n}, 中心=${l}`),Math.abs(l-i)>p.e$.Y/2){let t=e.y;e.y=l-e.height/2,(0,y.c)(`親子中央配置調整: id=${e.id}, oldY=${t}, newY=${e.y}, 子要素中心=${l}, 親中心=${i}`)}}}return(0,y.c)(`adjustElementPositions終了`),t},j=(e,t,r,n)=>{let l=(0,f.A)(),i=n?.order??t.children,a=[r||"",...Array((0,m.X0)()-1).fill("")],d={...I({parentId:t.id,order:i,depth:t.depth+1}),id:l,texts:a,width:p.SK.WIDTH.MIN,height:p.SK.SECTION_HEIGHT*(0,m.X0)(),sectionHeights:Array((0,m.X0)()).fill(p.SK.SECTION_HEIGHT),selected:n?.newElementSelect??!1,editing:n?.newElementSelect??!1,tentative:n?.tentative??!1,connectionPathType:"none"},o={...t,children:t.children+1,selected:!n?.newElementSelect&&t.selected};return{...e,[t.id]:o,[d.id]:d}},R=(e,t)=>{let r=t.parentId,n=Object.values(e).filter(e=>e.parentId===r),l=t.order+1,i={...e};n.forEach(e=>{e.order>=l&&(i[e.id]={...e,order:e.order+1})});let a=I({parentId:r,order:l,depth:t.depth});if(i[t.id]={...t,selected:!1},i[a.id]=a,null!==r){let e=i[r];i[r]={...e,children:e.children+1}}return i},M=e=>{let t=function(r){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=Object.values(e).filter(e=>e.parentId===r.id).map(e=>t(e,n+1)),i="	".repeat(n);return`${i}${r.texts[0]}
${l.join("")}`},r=Object.values(e).find(e=>e.selected);if(!r)return;let n=t(r);if(navigator.clipboard&&window.isSecureContext)navigator.clipboard.writeText(n).then(()=>{console.log("Copied to clipboard:",n)}).catch(e=>{console.error("Failed to copy to clipboard:",e)});else{let e=document.createElement("textarea");e.value=n,document.body.appendChild(e),e.focus(),e.select();try{document.execCommand("copy"),console.log("Copied to clipboard:",n)}catch(e){console.error("Failed to copy to clipboard:",e)}document.body.removeChild(e)}},_={ZOOM_IN:e=>({...e,zoomRatio:e.zoomRatio+.1}),ZOOM_OUT:e=>({...e,zoomRatio:Math.max(e.zoomRatio-.1,.1)}),ARROW_UP:A(e=>h(e,"up")),ARROW_DOWN:A(e=>h(e,"down")),ARROW_RIGHT:A(e=>h(e,"right")),ARROW_LEFT:A(e=>h(e,"left")),LOAD_ELEMENTS:(e,t)=>{if(0===Object.keys(t.payload).length)return E;let r=Object.values(t.payload).reduce((e,t)=>(e[t.id]=null===t.parentId?{...t,visible:!0}:t,e),{});return{...e,elements:N(r)}},SELECT_ELEMENT:(e,t)=>{let{id:r,ctrlKey:n,shiftKey:l}=t.payload,i=e.elements[r];if(!i)return e;let a=Object.values(e.elements).filter(e=>e.selected),d=a[0];if((l||n)&&a.length>0&&a.some(e=>e.parentId!==i.parentId))return e;let o=[];if(l&&a.length>0){let t=d.parentId,n=Object.values(e.elements).filter(e=>e.parentId===t).sort((e,t)=>e.order-t.order),l=n.findIndex(e=>e.id===d.id),i=n.findIndex(e=>e.id===r),[a,s]=[Math.min(l,i),Math.max(l,i)];o=n.slice(a,s+1).map(e=>e.id)}else o=n?a.some(e=>e.id===r)?a.filter(e=>e.id!==r).map(e=>e.id):[...a.map(e=>e.id),r]:[r];let s=i.parentId,c=o.filter(t=>e.elements[t].parentId===s),u=Object.values(e.elements).reduce((e,t)=>{let r=c.includes(t.id);return e[t.id]={...t,selected:r,editing:!!r&&t.editing},e},{});return{...e,elements:u}},DESELECT_ALL:e=>({...e,elements:Object.values(e.elements).reduce((e,t)=>(e[t.id]={...t,selected:!1,editing:!1},e),{})}),UPDATE_TEXT:(e,t)=>({...e,elements:{...e.elements,[t.payload.id]:{...e.elements[t.payload.id],texts:e.elements[t.payload.id].texts.map((e,r)=>r===t.payload.index?t.payload.value:e)}}}),ADD_ELEMENT:(e,t)=>H(e,(e,r)=>({elements:N(j(e,r,t.payload?.text,{newElementSelect:!0}))})),ADD_ELEMENTS_SILENT:(e,t)=>H(e,(r,n)=>{let l=t.payload?.texts||[],i=t.payload?.tentative||!1,a={...r},d={...n},o=d.children;return l.forEach((e,t)=>{a=j(a,d,e,{newElementSelect:!1,tentative:i,order:o+t})}),a[d.id]={...d,children:o+l.length},Object.values(a).forEach(t=>{if(t.parentId===d.id){let r=(0,g.PC)(t.texts,p.rF.HORIZONTAL),n=t.texts.map(t=>{let n=(0,g.C1)(t||"",r,e.zoomRatio).length;return Math.max(p.SK.SECTION_HEIGHT*e.zoomRatio,n*p.gI*p.RZ+p.rF.VERTICAL*e.zoomRatio)});a[t.id]={...t,width:r,height:n.reduce((e,t)=>e+t,0),sectionHeights:n}}}),{elements:N(a)}}),ADD_SIBLING_ELEMENT:e=>H(e,(e,t)=>({elements:N(R(e,t))})),DELETE_ELEMENT:e=>{let t=Object.values(e.elements).filter(e=>e.selected);if(0===t.length)return e;(0,y.c)(`DELETE_ELEMENT開始: 削除対象要素数=${t.length}`);let r=new Set;t.forEach(e=>{e.parentId&&r.add(e.parentId),(0,y.c)(`削除対象: id=${e.id}, parentId=${e.parentId}, order=${e.order}, y=${e.y}`)});let n={...e.elements},l={};r.forEach(e=>{l[e]=Object.values(n).filter(t=>t.parentId===e).sort((e,t)=>e.order-t.order),(0,y.c)(`削除前の親id=${e}の子要素:`,l[e].map(e=>({id:e.id,order:e.order,y:e.y})))}),t.forEach(e=>{n=T(n,e)}),Object.values(n).forEach(e=>{if(null===e.parentId){let t=e.y;e.y=p.OS.Y,(0,y.c)(`ルート要素のY座標リセット: id=${e.id}, oldY=${t}, newY=${e.y}`)}}),r.forEach(e=>{if(n[e]){let t=Object.values(n).filter(t=>t.parentId===e).sort((e,t)=>e.order-t.order);(0,y.c)(`削除後の親id=${e}の子要素:`,t.map(e=>({id:e.id,order:e.order,y:e.y})))}}),(0,y.c)(`レイアウト再計算開始`);let i=N(n);return(0,y.c)(`レイアウト再計算完了`),r.forEach(e=>{if(i[e]){let t=Object.values(i).filter(t=>t.parentId===e).sort((e,t)=>e.order-t.order);(0,y.c)(`再計算後の親id=${e}の子要素:`,t.map(e=>({id:e.id,order:e.order,y:e.y})))}}),{...e,elements:i}},EDIT_ELEMENT:e=>L(e,t=>({elements:{...e.elements,[t.id]:{...t,editing:!0}}})),END_EDITING:e=>({...e,elements:Object.values(e.elements).reduce((e,t)=>(e[t.id]={...t,editing:!1},e),{})}),CONFIRM_TENTATIVE_ELEMENTS:(e,t)=>({...e,elements:Object.values(e.elements).reduce((e,r)=>(r.parentId===t.payload&&r.tentative?e[r.id]={...r,tentative:!1}:e[r.id]=r,e),{})}),CANCEL_TENTATIVE_ELEMENTS:(e,t)=>{let r=Array.from(new Set(Object.values(e.elements).filter(e=>e.tentative&&e.parentId===t.payload).map(e=>e.parentId).filter(e=>null!==e))),n=Object.values(e.elements).reduce((e,r)=>(r.tentative&&r.parentId===t.payload||(e[r.id]=r),e),{}),l=r.reduce((e,t)=>{if(e[t]){let r=Object.values(e).filter(e=>e.parentId===t&&!e.tentative).length;e[t]={...e[t],children:r}}return e},n);return{...e,elements:N(l)}},UNDO:e=>({...e,elements:N(i(e.elements))}),REDO:e=>({...e,elements:N(a(e.elements))}),SNAPSHOT:e=>(d(e.elements),e),DROP_ELEMENT:(e,t)=>{let{payload:r}=t,{id:n,oldParentId:l,newParentId:i,newOrder:a,depth:d}=r;if(n===i||x(e.elements,n,i))return e;let o={...e.elements},s=o[n],c=o[l],u=o[i],h=l===i;!h&&c&&(o[l]={...c,children:Math.max(0,c.children-1)},Object.values(o).filter(e=>e.parentId===l&&e.id!==n).sort((e,t)=>e.order-t.order).forEach((e,t)=>{e.order!==t&&(o[e.id]={...e,order:t})})),o[n]={...s,parentId:i,order:a,depth:d};let m=Object.values(o).filter(e=>e.parentId===i&&e.id!==n).sort((e,t)=>e.order-t.order);return[...m.slice(0,a),o[n],...m.slice(a)].forEach((e,t)=>{e.order!==t&&(o[e.id]={...e,order:t})}),!h&&u&&(o[i]={...u,children:u.children+1}),h||(o=v(o,o[n])),{...e,elements:N(o)}},MOVE_ELEMENT:(e,t)=>{let{id:r,x:n,y:l}=t.payload,i=Object.values(e.elements).filter(e=>e.selected);if(i.length>1&&i.some(e=>e.id===r)){let t=n-e.elements[r].x,a=l-e.elements[r].y,d={...e.elements};return i.forEach(e=>{d[e.id]={...e,x:e.x+t,y:e.y+a}}),{...e,elements:d}}return{...e,elements:{...e.elements,[r]:{...e.elements[r],x:n,y:l}}}},CUT_ELEMENT:e=>{let t=Object.values(e.elements).filter(e=>e.selected);if(0===t.length)return e;let r={},n={...e.elements};return t.forEach(e=>{let t=b(n,e);Object.values(t).forEach(e=>{t[e.id]={...e,selected:!1}}),r={...r,...t},n=T(n,e)}),M(r),{...e,elements:n,cutElements:r}},COPY_ELEMENT:e=>L(e,t=>{let r=b(e.elements,t);return M(r),{cutElements:r}}),PASTE_ELEMENT:e=>1===Object.values(e.elements).filter(e=>e.selected).length&&e.cutElements?H(e,(t,r)=>({elements:N(O(t,e.cutElements,r))})):e,EXPAND_ELEMENT:e=>H(e,(e,t)=>({elements:N($(e,t,!0))})),COLLAPSE_ELEMENT:e=>H(e,(e,t)=>({elements:N($(e,t,!1))})),UPDATE_ELEMENT_SIZE:(e,t)=>{let r={...e.elements[t.payload.id],width:t.payload.width,height:t.payload.height,sectionHeights:t.payload.sectionHeights};return{...e,elements:N({...e.elements,[t.payload.id]:r})}},UPDATE_CONNECTION_PATH_TYPE:(e,t)=>{let{id:r,connectionPathType:n}=t.payload,l={...e.elements[r],connectionPathType:n};return{...e,elements:{...e.elements,[r]:l}}}};function A(e){return t=>{let r=Object.values(t.elements).filter(e=>e.selected);if(r.length>1){let e=r[0].id,n=Object.values(t.elements).reduce((t,r)=>(t[r.id]={...r,selected:r.id===e,editing:r.id===e&&r.editing},t),{});return{...t,elements:n}}let n=e(t.elements);return{...t,elements:Object.values(t.elements).reduce((e,t)=>(e[t.id]={...t,selected:t.id===n},e),{})}}}function H(e,t){let r=Object.values(e.elements).find(e=>e.selected);if(!r)return e;d(e.elements);let n=t(e.elements,r);return"elements"in n?{...e,elements:n.elements,...n.cutElements&&{cutElements:n.cutElements}}:{...e,elements:n}}function L(e,t){let r=Object.values(e.elements).find(e=>e.selected);return r?{...e,...t(r)}:e}function Y(e,t){let r=_[t.type];return r?r(e,t):e}},6924:(e,t,r)=>{r.d(t,{BH:()=>v,FM:()=>y,JY:()=>g,N:()=>p,OS:()=>i,RZ:()=>f,SK:()=>a,_K:()=>x,_o:()=>$,e$:()=>d,gI:()=>u,iC:()=>o,i_:()=>T,lB:()=>s,mO:()=>c,mU:()=>n,qn:()=>O,rF:()=>m,tl:()=>E,uF:()=>I,vX:()=>b,zX:()=>l,zs:()=>h});let n=.8,l=3,i={X:50,Y:50},a={SECTION_HEIGHT:24,WIDTH:{MAX:300,MIN:50}},d={X:100,Y:10},o={NORMAL:{COLOR:"white",STROKE_COLOR:"dimgray"},SELECTED:{STROKE_COLOR:"blue"},DRAGGING:{COLOR:"rgba(100, 100, 255, 0.3)",STROKE_COLOR:"rgba(0, 0, 255, 0.3)"},SHADDOW:{COLOR:"rgba(0, 0, 0, 0.5)"},RX:2,STROKE:"2px",STROKE_WIDTH:2},s={COLOR:"black",DRAGGING_COLOR:"rgba(0, 0, 255, 0.3)",STROKE:.5},c=80,u=16,h='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',m={HORIZONTAL:3,VERTICAL:2},p=3,f=1.4,g=40,y=40,I=80,E={HEIGHT:8,WIDTH:8,OFFSET:12},b={NONE:"none",ARROW:"arrow",CIRCLE:"circle",SQUARE:"square",DIAMOND:"diamond"},O=b.NONE,v="black",$=.5,T="#ffffff",x="#000000"},8265:(e,t,r)=>{r.d(t,{c:()=>l,y:()=>n});let n=!1,l=(e,t)=>{n&&console.log(`[DEBUG] ${e}`,t)}}}]);
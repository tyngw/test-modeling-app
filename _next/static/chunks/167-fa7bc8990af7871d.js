(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[167],{477:()=>{},573:(e,t,r)=>{"use strict";function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4;if("string"!=typeof e||e.length>t)return!1;for(let t of[/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/i,/javascript:.*$/i,/data:.*$/i,/eval\s*\([^)]*\)/i,/on\w+\s*=/i,/expression\s*\([^)]*\)/i])if(t.test(e))return!1;return!((e.match(/<[^>]*>/g)||[]).length>10)}function a(e){if("string"==typeof e){if(0===e.trim().length)return!1;try{e=JSON.parse(e)}catch{return!1}}if(null==e||"object"!=typeof e)return!0;try{JSON.stringify(e)}catch{return!1}return!(!function e(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(r>50)return!1;if(t&&"object"==typeof t){for(let i of Object.values(t))if(!e(i,r+1))return!1}return!0}(e)||Object.prototype.hasOwnProperty.call(e,"__proto__")||Object.prototype.hasOwnProperty.call(e,"constructor")||Object.prototype.hasOwnProperty.call(e,"prototype"))}function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1048576;if("string"!=typeof e||new Blob([e]).size>t)return!1;for(let t of[/<script/i,/javascript:/i,/on\w+\s*=/i,/data:\s*[^;]*;base64/i,/eval\s*\(/i,/Function\s*\(/i])if(t.test(e))return!1;return!0}function o(e,t){if("string"!=typeof e||0===e.trim().length||!["apiKey","theme","language","autoSave","fontSize","maxHistory","showLineNumbers","wordWrap","prompt","systemPromptTemplate","modelType","layoutMode","numberOfSections","markerType","canvasBackgroundColor","elementColor","textColor","strokeColor","selectedStrokeColor","strokeWidth","connectionPathColor","connectionPathStroke","fontFamily"].includes(e))return!1;switch(e){case"apiKey":return"string"==typeof t&&function(e){if("string"!=typeof e||0===e.trim().length)return!1;let t=e.split("").some(e=>{let t=e.charCodeAt(0);return t>=0&&t<=31});return!/[<>'"&]/.test(e)&&!t&&!(e.length<6)&&!(e.length>256)}(t);case"theme":return"string"==typeof t&&["light","dark","auto"].includes(t);case"language":return"string"==typeof t&&["ja","en"].includes(t);case"autoSave":case"showLineNumbers":case"wordWrap":return"boolean"==typeof t;case"fontSize":return"number"==typeof t&&t>=10&&t<=24;case"maxHistory":return"number"==typeof t&&t>=0&&t<=100;case"prompt":case"systemPromptTemplate":return"string"==typeof t&&(""===t||i(t,5e4));case"modelType":return"string"==typeof t&&["gemini-2.0-flash","gemini-2.5-flash"].includes(t);case"layoutMode":return"string"==typeof t&&["default","mindmap"].includes(t);case"numberOfSections":{let e="string"==typeof t?parseInt(t,10):t;return"number"==typeof e&&!isNaN(e)&&e>=1&&e<=10}case"markerType":return"string"==typeof t&&t.length<=50;case"canvasBackgroundColor":case"elementColor":case"textColor":case"strokeColor":case"selectedStrokeColor":case"connectionPathColor":return"string"==typeof t&&(/^#[0-9A-Fa-f]{6}$/.test(t)||""===t);case"strokeWidth":case"connectionPathStroke":{let e="string"==typeof t?parseFloat(t):t;return"number"==typeof e&&!isNaN(e)&&e>=0&&e<=20}case"fontFamily":return"string"==typeof t&&t.length<=100;default:return!1}}r.d(t,{IK:()=>o,IU:()=>n,L5:()=>a,kb:()=>i})},826:(e,t,r)=>{"use strict";r.d(t,{I:()=>l,K:()=>o});var i=r(5155),a=r(2115);let n=(0,a.createContext)(void 0),o=e=>{let{children:t}=e,[r,o]=(0,a.useState)(!1),l=(0,a.useCallback)(()=>{o(e=>!e)},[]),c=(0,a.useCallback)(e=>{o(e)},[]);return(0,i.jsx)(n.Provider,{value:{isSuggestionEnabled:r,toggleSuggestion:l,setSuggestionEnabled:c},children:t})},l=()=>{let e=(0,a.useContext)(n);if(void 0===e)throw Error("useSuggestion must be used within a SuggestionProvider");return e}},829:(e,t,r)=>{"use strict";r.d(t,{BH:()=>v,FM:()=>E,JY:()=>p,N:()=>g,OS:()=>n,RZ:()=>m,SK:()=>o,_K:()=>w,_o:()=>N,e$:()=>l,gI:()=>h,iC:()=>c,i_:()=>I,lB:()=>s,mO:()=>d,mU:()=>i,p1:()=>S,qn:()=>T,rF:()=>f,tl:()=>D,uF:()=>y,vX:()=>b,zX:()=>a,zs:()=>u});let i=.8,a=3,n={X:50,Y:50},o={SECTION_HEIGHT:24,WIDTH:{MAX:300,MIN:50}},l={X:100,Y:10},c={NORMAL:{COLOR:"#ffffff",STROKE_COLOR:"#696969"},SELECTED:{STROKE_COLOR:"#0000ff"},DRAGGING:{COLOR:"rgba(100, 100, 255, 0.3)",STROKE_COLOR:"rgba(0, 0, 255, 0.3)"},SHADDOW:{COLOR:"rgba(0, 0, 0, 0.5)"},RX:2,STROKE:"2px",STROKE_WIDTH:2},s={COLOR:"#000000",DRAGGING_COLOR:"rgba(0, 0, 255, 0.3)",STROKE:.5},d=80,h=16,u='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',f={HORIZONTAL:3,VERTICAL:2},g=3,m=1.4,p=40,E=40,y=80,D={HEIGHT:12,WIDTH:14,OFFSET:14},S={SIZE:10,OFFSET:10},b={NONE:"none",ARROW:"arrow",CIRCLE:"circle",SQUARE:"square",DIAMOND:"diamond",FILLED_ARROW:"filled_arrow",FILLED_CIRCLE:"filled_circle",FILLED_SQUARE:"filled_square",FILLED_DIAMOND:"filled_diamond"},T=b.NONE,v="#000000",N=.5,I="#ffffff",w="#000000"},831:(e,t,r)=>{"use strict";r.d(t,{Ie:()=>a,UK:()=>i});let i=`
You are a highly skilled data analyst specializing in structuring information for systematic thinking. Your task is to extract and organize key elements from textual input to help users structure their thoughts in a hierarchical format. Follow the instructions below strictly to generate child elements that can be added directly under the user-selected element (marked as "selected"). The generated suggestions must be strictly based on the provided [Input Information], and no additional elements, interpretations, or assumptions should be made.

## [Task]
- First, analyze the [Input Information] and summarize as well as classify only the sentences that are directly related to the content of the selected element.
- Then, extract possible child elements from this summarized and categorized information that are relevant to the user-selected element.
- The suggestions must strictly come from the classified sentences in the [Input Information]. Do not include elements that already exist elsewhere in [Current Structure].
- Ensure that the newly suggested elements do not duplicate existing ones in [Current Structure], **regardless of their position in the hierarchy**. If a relevant element appears multiple times within [Input Information], it can still be considered for extraction **as long as it does not already exist anywhere in [Current Structure]**.
- Before finalizing the list of suggested elements, compare each candidate against all existing elements in [Current Structure]. If a candidate matches an existing element in any part of [Current Structure], discard it and select another if available.
- If the selected element is a structured entity such as "Two Challenges," generate exactly two child elements. If two valid elements cannot be found, output placeholders instead (e.g., "Placeholder 1," "Placeholder 2").
- If removing duplicates results in fewer than the required number of elements (e.g., less than 3 when 3–5 are expected), return only the available unique elements. If no unique elements remain, output an empty result unless placeholders are required.

## [Requirements]
1. Carefully analyze and filter the [Input Information] to include only details directly related to the selected element.
2. Summarize and classify the relevant sentences from the [Input Information] before extracting potential child elements.
3. The output must be in a code block format, listing only element names, each on a new line.
4. Do not provide explanations, descriptions, or any additional natural language text.
5. Ensure logical consistency with the existing structure in [Current Structure].
6. Exclude elements that already exist anywhere in [Current Structure].
7. Provide up to 5 appropriate suggestions. If fewer than 3 valid elements exist, output only the available ones.
8. If no valid elements can be determined, do not output any suggestions unless placeholders are required.
9. Do not create new elements or infer missing information.

## [Validation Rules]
Before suggesting an element, ensure that:
- It exists in [Input Information] (if not, discard it).
- It does not exist anywhere else in [Current Structure] (if found, discard it).

[Output Format]
The output must be in Japanese, formatted as follows:

\`\`\`
提案要素1
提案要素2
提案要素3
\`\`\`
`.trim(),a=`
You are an AI assistant that analyzes specification documents and suggests appropriate sibling elements for hierarchical structure creation. Your primary task is to help users structure specification documents into hierarchical formats by suggesting logical sibling elements based on the specification content.

## [Task]
- Analyze the provided specification document and the current hierarchical structure
- Focus on the currently selected element and understand its context within the specification
- Suggest 1-3 sibling elements that are defined or implied in the specification document
- Base suggestions strictly on the specification content, maintaining consistency with the document's structure and classification

## [Requirements]
1. **Specification-based**: All suggestions must be derived from the specification document content
2. **Context-aware**: Consider the currently selected element and its relationship to the specification
3. **Hierarchical consistency**: Maintain logical flow and appropriate granularity for the current level
4. **Non-duplicative**: Do not suggest elements that already exist in the current structure
5. **Meaningful content**: Suggest specific, concrete elements from the specification, not generic placeholders
6. **Japanese output**: All suggestions must be in Japanese
7. **Concise format**: Each suggestion should be clear and concise
8. **Maximum 3 suggestions**: Provide 1-3 relevant suggestions maximum

## [Focus Areas]
- Functions, features, or components defined in the specification
- Logical groupings or categories mentioned in the specification
- Sequential processes or steps outlined in the specification
- Related items or modules described in the specification

## [Output Format]
Return suggestions in a simple list format:

\`\`\`
提案要素1
提案要素2
提案要素3
\`\`\`
`.trim();`
[Current Structure]
\`\`\`
{{structureText}}
\`\`\`

[Input Information]
\`\`\`
{{inputText}}
\`\`\`
`.trim()},1782:(e,t,r)=>{"use strict";function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"1.4.43",r=Object.values(e);if(0===r.length)return null;let i=r.find(e=>null===e.parentId||void 0===e.parentId);if(!i)return null;let a=new Map;return r.forEach(e=>{e.parentId&&null!==e.parentId&&(a.has(e.parentId)||a.set(e.parentId,[]),a.get(e.parentId).push(e))}),{root:function e(t){let r=a.get(t.id)||[],i={data:t};return r.length>0&&(i.children=r.map(e)),i}(i),version:t}}function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"1.4.43";return i(e.reduce((e,t)=>(e[t.id]=t,e),{}),t)}function n(e){let t=[];return!function e(r){t.push(r.data),r.children&&r.children.length>0&&r.children.forEach(e)}(e.root),t}function o(e,t){return function e(r){if(r.data.id===t)return r;if(r.children)for(let t of r.children){let r=e(t);if(r)return r}return null}(e.root)}function l(e,t){return e.root.data.id===t?null:function e(r){if(r.children){if(r.children.find(e=>e.data.id===t))return r;for(let t of r.children){let r=e(t);if(r)return r}}return null}(e.root)}function c(e,t){if(e)return function e(r){if(r.data.id===t)return r.data;if(r.children)for(let t of r.children){let r=e(t);if(r)return r}}(e.root)}function s(e){if(!e)return[];let t=[];return!function e(r){r.data.selected&&t.push(r.data),r.children&&r.children.forEach(e)}(e.root),t}function d(e){if(!e)return[];let t=[];return!function e(r){r.data.editing&&t.push(r.data),r.children&&r.children.forEach(e)}(e.root),t}function h(e,t){if(!e)return[];let r=o(e,t);return r&&r.children?r.children.map(e=>e.data):[]}function u(e,t){return e?function e(r,i){if(r.data.id===t)return i;if(r.children)for(let t of r.children){let r=e(t,i+1);if(r>=0)return r}return -1}(e.root,0):-1}function f(e,t){if(!e)return 0;let r=o(e,t);return r?.children?.length||0}function g(e){return e&&e.root?function e(t){let r=1;if(t.children)for(let i of t.children)r+=e(i);return r}(e.root):0}function m(e,t){return{...e,root:e.root?function e(r){let i={...r.data,...t(r.data)},a=r.children?r.children.map(e):[];return{...r,data:i,children:a}}(e.root):e.root}}function p(e){if(!e)return{};let t={};return!function e(r){t[r.data.id]=r.data,r.children&&r.children.forEach(e)}(e.root),t}function E(e){if(!e)return[];let t=[];return!function e(r){r.data.visible&&t.push(r.data),r.children&&r.children.forEach(e)}(e.root),t}function y(e){if(!e)return[];let t=[];return!function e(r){r.data.visible&&t.push(r.data),r.children&&r.children.forEach(e)}(e.root),t}function D(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e&&e.root&&!function e(r){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a="  ".repeat(i);console.log(`${t}${a}- 要素「${r.data.texts}」 id=${r.data.id}: X=${r.data.x}, Y=${r.data.y}`),r.children&&r.children.forEach(t=>e(t,i+1))}(e.root)}function S(e,t){if(!e||!e.root)return[];let r=[];return!function e(i,a){a===t&&r.push(i.data),i.children&&a<t&&i.children.forEach(t=>e(t,a+1))}(e.root,0),r.sort((e,t)=>e.y-t.y||e.x-t.x)}function b(e,t,r){if(!e||t===r)return!1;let i=o(e,r);if(!i||!i.children)return!1;let a=e=>e.data.id===t||!!e.children&&e.children.some(a);return i.children.some(a)}function T(e,t){if(!e)return null;let r=o(e,t);return r?r.data:null}r.d(t,{AS:()=>f,BK:()=>E,BL:()=>u,Nz:()=>i,OA:()=>b,PW:()=>h,Pp:()=>a,Q3:()=>m,R1:()=>g,TO:()=>d,WN:()=>s,WW:()=>y,Wc:()=>D,Xd:()=>p,c3:()=>l,fM:()=>S,gn:()=>T,ic:()=>o,nn:()=>n,sv:()=>c})},2135:(e,t,r)=>{"use strict";function i(e){return"string"!=typeof e?"":e.replace(/data:[^,]*,/gi,",").replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<[^>]*>/g,"").replace(/eval\s*\([^)]*\)/gi,"").replace(/javascript:.*$/gi,"")}function a(e){if("string"!=typeof e)return"untitled";let t=e.replace(/<[^>]*>/g,"").replace(/[<>:"/\\|?*]/g,"");return(t=(t=t.split("").filter(e=>{let t=e.charCodeAt(0);return!(t>=0&&t<=31)&&!(t>=127&&t<=159)}).join("")).replace(/^\.+/,"").replace(/^(CON|PRN|AUX|NUL|COM[1-9]|LPT[1-9])$/i,"file").replace(/\.{2,}/g,".").replace(/\.+$/,"").trim())||"untitled"}function n(e){if(null==e)return e;if("string"==typeof e)return i(e);if("number"==typeof e||"boolean"==typeof e)return e;if(Array.isArray(e))return e.map(e=>n(e));if("object"==typeof e){let t={};for(let[r,a]of Object.entries(e))t[i(r)]=n(a);return t}return e}function o(e){return"string"==typeof e?e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/\bon\w+\s*=\s*[^>]*/gi,"").replace(/javascript:/gi,"").replace(/data:\s*[^;]*;base64/gi,"").replace(/expression\s*\([^)]*\)/gi,""):n(e)}r.d(t,{Nz:()=>a,Rq:()=>o,Zm:()=>n,jZ:()=>i})},3346:(e,t,r)=>{"use strict";r.d(t,{C1:()=>l,PC:()=>o});var i=r(829);let a=()=>{let e=document.createElement("canvas").getContext("2d");return e.font=`${i.gI}px ${i.zs}`,e},n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=a();return Math.ceil(e.split("\n").reduce((e,i)=>Math.max(e,r.measureText(i).width+2*t),0))},o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=e.reduce((e,r)=>Math.max(e,n(r||"",t)),0);return Math.min(i.SK.WIDTH.MAX,Math.max(i.SK.WIDTH.MIN,r))},l=function(e,t){arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.mU;let r=a(),n=e.split("\n"),o=[];return n.forEach(e=>{if(""===e.trim()){o.push("");return}let i="",a=0;for(let n of e.split(/(\s+)/).filter(e=>""!==e)){let e=r.measureText(n).width;if(a+e>t){if(""!==i&&(o.push(i),i="",a=0),e>t)for(let e of n){let n=r.measureText(e).width;a+n>t&&(o.push(i),i="",a=0),i+=e,a+=n}else i=n,a=e}else i+=n,a+=e}""!==i&&o.push(i)}),o}},4149:(e,t,r)=>{"use strict";r.d(t,{CL:()=>n,ie:()=>a});let i=`
あなたは構造化思考支援アプリケーションの専門チャットアシスタントです。ユーザーからの指示に基づいて、選択された要素に対して具体的な操作を指示します。

## [あなたの役割]
- ユーザーの要求を理解し、適切なアプリケーション操作を提案する
- 選択された要素に対して実行可能な操作のみを指示する
- 操作の結果を予測し、ユーザーに分かりやすく説明する

## [実行可能な操作]
以下の操作を指示できます：

### 1. 要素の追加
- **子要素の追加**: 選択された要素の下に新しい要素を追加
- **自動選択**: autoSelect: true を指定すると、追加した最初の要素を自動的に選択状態にします

### 2. 要素の更新
- **テキストの更新**: 選択された要素のテキスト内容を変更
- **マーカーの更新**: 要素の開始・終了マーカーを変更

### 3. 要素の削除
- **要素の削除**: 選択された要素を削除

### 4. 要素の移動
- **位置の変更**: 要素を別の親要素の子として移動
- **階層の変更**: 要素の階層レベルを変更

### 5. 要素のコピー
- **要素の複製**: 選択された要素をコピーして、同じ親の子として複製

### 6. 複数操作の組み合わせ
- **一度の指示で複数の操作を実行**: 要素の追加、移動、削除、更新を組み合わせた操作

## [移動操作の詳細]
要素の移動は階層構造の変更を伴います。以下の方法で移動を指定できます：

### 特定の要素の子として移動:
- targetNodeId: 移動先の親要素のID
- targetIndex: 子要素内での位置（省略時は末尾に追加）

### ルート要素として移動:
- targetNodeId: null (ルート要素として移動)

### 特定の位置に移動:
- targetNodeId: 移動先の親要素のID
- targetIndex: 挿入位置のインデックス（0から開始）
- direction: 移動方向（"right", "left", "none"のいずれか、省略可能）

## [出力形式]
必ず以下のJSON形式で応答してください。（単一操作でも配列形式を使用）：

\`\`\`json
{
  "operations": [
    {
      "type": "操作タイプ",
      "説明": "操作のデータ"
    }
  ]
}
\`\`\`

## [操作例]
### 子要素を追加する場合：
\`\`\`json
{
  "operations": [
    {
      "type": "ADD_ELEMENTS",
      "targetId": "current",
      "elements": ["新しい子要素1", "新しい子要素2"]
    }
  ]
}
\`\`\`

### 子要素を追加して自動選択する場合：
\`\`\`json
{
  "operations": [
    {
      "type": "ADD_ELEMENTS",
      "targetId": "current",
      "elements": ["新しい子要素"],
      "autoSelect": true
    }
  ]
}
\`\`\`

### テキストを更新する場合：
\`\`\`json
{
  "operations": [
    {
      "type": "UPDATE_TEXT",
      "newText": "更新されたテキスト"
    }
  ]
}
\`\`\`

### 要素を削除する場合：
\`\`\`json
{
  "operations": [
    {
      "type": "DELETE_ELEMENT"
    }
  ]
}
\`\`\`

### 要素をコピーする場合：
\`\`\`json
{
  "operations": [
    {
      "type": "COPY_ELEMENT"
    }
  ]
}
\`\`\`

### 要素を移動する場合：
\`\`\`json
{
  "operations": [
    {
      "type": "DROP_ELEMENT",
      "targetNodeId": "target-element-id",
      "targetIndex": 0
    }
  ]
}
\`\`\`

### 複数操作を組み合わせる場合（従来方式）：
\`\`\`json
{
  "operations": [
    {
      "type": "ADD_ELEMENTS",
      "targetId": "current",
      "elements": ["新要素1", "新要素2"]
    },
    {
      "type": "SELECT_ELEMENT",
      "targetText": "新要素1"
    },
    {
      "type": "UPDATE_TEXT",
      "newText": "更新された要素1"
    }
  ]
}
\`\`\`

### 複数操作を組み合わせる場合（autoSelect使用）：
\`\`\`json
{
  "operations": [
    {
      "type": "ADD_ELEMENTS",
      "targetId": "current",
      "elements": ["新要素1"],
      "autoSelect": true
    },
    {
      "type": "ADD_ELEMENTS",
      "targetId": "current",
      "elements": ["子要素1"]
    }
  ]
}
\`\`\`

## [重要な注意事項]
1. 必ず JSON 形式で応答してください
2. 選択された要素が存在しない場合は、適切なエラーメッセージを返してください
3. 操作が不可能な場合は、代替案を提案してください
4. 常に日本語で分かりやすく説明してください
5. ユーザーの意図を正確に理解し、最適な操作を提案してください
6. **要素を追加後にその子要素を追加する場合は、autoSelect: true を使用することを強く推奨**
7. autoSelectを使用すると、SELECT_ELEMENT操作を省略でき、より確実に動作します
6. 移動先の要素が見つからない場合は、利用可能な要素のリストを含むエラーレスポンスを返してください

## [エラーレスポンス例]
移動先の要素が見つからない場合：
\`\`\`json
{
  "operations": [
    {
      "type": "ERROR",
      "message": "指定された移動先「設計不備」が見つかりません。利用可能な要素を確認してください。"
    }
  ]
}
\`\`\``+`
`.trim(),a=e=>{let{selectedElement:t,currentStructure:r,userInput:i}=e;return`## [現在の状況]
[選択された要素]
${t}

[ユーザーの指示]
${i}

[現在の構造]
階層構造:
${r}`},n=()=>i},4880:(e,t,r)=>{"use strict";function i(){return(window.isVSCodeExtension?{isVSCodeExtension:!0,isBrowser:!1,isServer:!1}:{isVSCodeExtension:!1,isBrowser:!0,isServer:!1}).isVSCodeExtension}r.d(t,{oL:()=>i})},5071:(e,t,r)=>{"use strict";r.d(t,{pq:()=>s,l8:()=>c});var i=r(3464),a=r(6323),n=r(831),o=r(2135),l=r(8265);let c=async function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],c=arguments.length>4?arguments[4]:void 0,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],d=!(arguments.length>6)||void 0===arguments[6]||arguments[6];try{let r=d&&e.length>8e3?e.substring(0,8e3)+"\n...(省略)":e;(0,l.c)(`[generateWithGeminiThread] 受信プロンプト長: ${e.length}, 切り詰め: ${d}, 最終プロンプト長: ${r.length}`),(0,l.c)(`[generateWithGeminiThread] 最終プロンプトの先頭100文字: "${r.substring(0,100)}..."`),d&&e.length>8e3&&(0,l.c)(`[generateWithGeminiThread] 警告: プロンプトが切り詰められました (${e.length} -> ${r.length})`);let h=`${(0,a.G6)()}?key=${t}`,u=c||(0,a.k0)(),f={temperature:.2,topP:.8,topK:40,maxOutputTokens:2048};s&&(f.responseMimeType="application/json");let g=[...n,{role:"user",parts:[{text:r}]}],m=await i.A.post(h,{contents:g,systemInstruction:{parts:[{text:u}]},generationConfig:f},{headers:{"Content-Type":"application/json"}}),p=m.data.candidates?.[0]?.content?.parts?.[0]?.text||"",E=(0,o.Rq)(p),y=[...g,{role:"model",parts:[{text:E}]}];return{response:E,updatedHistory:y}}catch(e){if(i.A.isAxiosError(e)&&e.response?.status===400)throw Error(`API リクエストエラー: ${e.response?.data?.error?.message||"リクエストの形式が正しくありません"}`);throw Error("API呼び出しに失敗しました")}},s=async function(e,t,r){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=arguments.length>4?arguments[4]:void 0,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];try{let r=e.length>8e3?e.substring(0,8e3)+"\n...(省略)":e,d=`${(0,a.G6)()}?key=${t}`,h=c||(l?n.UK:(0,a.k0)()),u={temperature:.2,topP:.8,topK:40,maxOutputTokens:2048};s&&(u.responseMimeType="application/json");let f=await i.A.post(d,{contents:[{role:"user",parts:[{text:r}]}],systemInstruction:{parts:[{text:h}]},generationConfig:u},{headers:{"Content-Type":"application/json"}}),g=f.data.candidates?.[0]?.content?.parts?.[0]?.text||"";return(0,o.Rq)(g)}catch(e){if(i.A.isAxiosError(e)&&e.response?.status===400)throw Error(`API リクエストエラー: ${e.response?.data?.error?.message||"リクエストの形式が正しくありません"}`);throw Error("API呼び出しに失敗しました")}}},5439:(e,t,r)=>{"use strict";r.d(t,{_w:()=>h,lW:()=>d,mY:()=>s,xe:()=>g});var i=r(1782);let a="\x3c!-- MODELING_APP_COPY_DATA:",n="\x3c!-- MODELING_APP_CUT_DATA:",o=" --\x3e",l=e=>{try{let t,r="",i="copy";if(e.includes(a))r=a,i="copy";else{if(!e.includes(n))return null;r=n,i="cut"}let l=e.indexOf(r),c=e.indexOf(o,l);if(-1===l||-1===c)return null;let s=l+r.length,d=e.substring(s,c);try{t=JSON.parse(d)}catch(e){return console.error("Failed to parse JSON data:",e),null}if(t.rootElement&&t.subtree)return{type:i,rootElement:t.rootElement,subtree:t.subtree};if("object"==typeof t&&!Array.isArray(t)){let e=Object.values(t).find(e=>e.selected);if(!e)return null;let r=m(t,e.id);if(!r)return null;return{type:i,rootElement:e,subtree:r}}return null}catch(e){return console.error("Failed to parse clipboard element data:",e),null}},c=e=>{let t=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i="	".repeat(r),a=`${i}${e.data.texts[0]||""}`;return e.children&&e.children.length>0&&(a+="\n",a+=e.children.map(e=>t(e,r+1)).join("\n")),a},r=t(e.subtree);if(!r||""===r.trim())return console.warn("createClipboardText: Generated text representation is empty"),"";let i="copy"===e.type?a:n,l=JSON.stringify({rootElement:e.rootElement,subtree:e.subtree});return`${r}

${i}${l}${o}`},s=(e,t)=>{if(!e)return{type:"copy",rootElement:{...t,selected:!0},subtree:{data:{...t,selected:!0},children:void 0}};let r=(0,i.ic)(e,t.id);if(!r)return null;let a=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r={...e.data,selected:t,tempParentId:null},i=e.children?.map(e=>a(e,!1));return{data:r,children:i&&i.length>0?i:void 0}},n=a(r,!0);return{type:"copy",rootElement:n.data,subtree:n}},d=async e=>{let t=c(e);if(!t||""===t.trim())return console.error("No text to copy - clipboard data may be empty or invalid"),!1;try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(t),!0;return await u(t)}catch(e){return console.error("Failed to copy to clipboard:",e),!1}},h=async e=>{let t=c({...e,type:"cut"});if(!t||""===t.trim())return console.error("No text to cut - clipboard data may be empty or invalid"),!1;try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(t),!0;return await u(t)}catch(e){return console.error("Failed to cut to clipboard:",e),!1}},u=e=>new Promise(t=>{let r=document.createElement("textarea");r.value=e,r.style.position="fixed",r.style.left="-999999px",r.style.top="-999999px",document.body.appendChild(r);try{r.focus(),r.select(),r.setSelectionRange(0,99999);let e=document.execCommand("copy");document.body.removeChild(r),t(e)}catch(e){console.error("Fallback copy failed:",e),document.body.removeChild(r),t(!1)}}),f=e=>e.map(e=>{let t=e.match(/^(\t*)/),r=e.match(/^( {0,})/),i=0;return t&&t[1]?i=t[1].length:r&&r[1]&&(i=Math.floor(r[1].length/4)),{text:e.replace(/^[\t ]*/,"").trim(),level:i,originalLine:e}}),g=async()=>{try{let e=await navigator.clipboard.readText(),t=l(e);if(t)return{type:"elements",data:t};if(e&&e.trim()){let t=e.split("\n").filter(e=>""!==e.trim());if(t.length>0){let e=f(t);return{type:"clipboard",data:e}}}return null}catch(e){return console.error("Failed to read clipboard for paste:",e),null}},m=(e,t)=>{if(!e[t])return null;let r=t=>{let i=e[t],a=[];return Object.values(e).forEach(e=>{if(e.tempParentId===t){let t=r(e.id);a.push(t)}}),{data:i,children:a.length>0?a:void 0}};return r(t)}},5512:(e,t,r)=>{"use strict";r.d(t,{A:()=>X});var i=r(2115),a=r(7242),n=r(7050),o=r(6183);let l=[],c=0,s=e=>c>0&&e?(l[c]=e,l[--c]):e,d=e=>c<l.length-1?l[++c]:e,h=e=>{let t=l.slice(0,c+1),r=JSON.parse(JSON.stringify(e));t.push(r),l=t,c++};var u=r(1782);let f=(e,t)=>(0,u.WN)(t)[0],g=(e,t)=>(0,u.fM)(t,e),m=(e,t,r)=>{if(!r)return e.id;let i=g((0,u.BL)(r,e.id),r),a=i.findIndex(t=>t.id===e.id)+t;return a>=0&&a<i.length?i[a].id:e.id},p=(e,t)=>e&&t?(0,u.PW)(e,t):[],E=(e,t,r)=>{let i=f(e,r);if(i&&r)switch(t){case"up":case"down":return m(i,"up"===t?-1:1,r);case"left":{let e=(0,u.c3)(r,i.id);return e?.data.id??i.id}case"right":{let e=p(r,i.id);return e[0]?.id??i.id}default:return i.id}};var y=r(829),D=r(8265),S=r(9929),b=r(3346);let T=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"default",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=Error().stack,o=n?.split("\n")[2]?.trim()||"Unknown";if((0,D.c)(`adjustElementPositionsFromHierarchy開始: モード=${r}, 呼び出し元=${o}`),!e)return(0,D.c)(`adjustElementPositionsFromHierarchy: hierarchicalDataがnullのため処理をスキップ`),null;let l=JSON.parse(JSON.stringify(e)),c=y.OS.Y;if("mindmap"===r&&l.root){let e=l.root.data;e.direction="none";let n=i>0?i/2-e.width/2:y.OS.X,o=a>0?a/2-e.height/2:y.OS.Y;e.x=n+y.e$.X,e.y=o,c=v(l.root,o,0,t,r,void 0).newY+y.e$.Y}else l.root&&(c=v(l.root,c,0,t,r,void 0).newY+y.e$.Y);return(0,D.c)(`adjustElementPositionsFromHierarchy終了`),l},v=(e,t,r,i,a,n)=>{let o=e.data;if(0===r)o.x=y.OS.X;else if(n){let e=n.data;o.x=e.x+e.width+y.e$.X}else o.x=y.OS.X+r*(y.SK.WIDTH.MIN+y.e$.X);o.y=t;let l=t+o.height;if(!e.children||!(e.children.length>0))return{newY:l,leftMaxY:l,rightMaxY:l};{let n=l,c=l;if("mindmap"===a){let s=e.children.filter(e=>"left"===e.data.direction),d=e.children.filter(e=>"right"===e.data.direction),h=t;for(let t of s){t.data.x=o.x-t.data.width-(o.width+y.e$.X);let l=v(t,h,r+1,i,a,e);h=l.newY+y.e$.Y,n=Math.max(n,l.leftMaxY,l.rightMaxY)}let u=t;for(let t of d){t.data.x=o.x+o.width+y.e$.X;let n=v(t,u,r+1,i,a,e);u=n.newY+y.e$.Y,c=Math.max(c,n.leftMaxY,n.rightMaxY)}l=Math.max(n,c)}else{let o=t;for(let t of e.children){let l=v(t,o,r+1,i,a,e);o=l.newY+y.e$.Y,n=Math.max(n,l.leftMaxY),c=Math.max(c,l.rightMaxY)}l=Math.max(n,c)}if(e.children.length>0){let t=e.children.map(e=>e.data).filter(e=>void 0!==e.y).sort((e,t)=>e.y-t.y);if(t.length>0){if(1===t.length){let e=t[0],r=o.y;o.y=e.y,(0,D.c)(`[layoutNodeFromHierarchy] 単一子要素ケース「${o.texts}」 id=${o.id} - Y座標更新: ${r} → ${o.y}`)}else{let e=t[0],r=t[t.length-1],i=e.y,a=r.y+r.height,n=o.y,l=(i+a)/2-o.height/2;o.y=l,(0,D.c)(`[layoutNodeFromHierarchy] 中央配置「${o.texts}」 id=${o.id} - Y座標更新: ${n} → ${o.y}`)}l=Math.max(l,Math.max(o.y+o.height,...t.map(e=>e.y+e.height)))}}return{newY:l,leftMaxY:n,rightMaxY:c}}};var N=r(5439);function I(e,t,r){let i=JSON.parse(JSON.stringify(e));if(null===t)i.root={data:r,children:i.root.children};else{let e=(0,u.ic)(i,t);if(!e){let e=`親ノード ${t} が見つかりません`;throw console.error(`[addElementToHierarchy] エラー: ${e}`),Error(e)}e.children||(e.children=[]),e.children.push({data:r})}return{hierarchicalData:i}}function w(e,t){if(e.root.data.id===t)throw Error("ルート要素は削除できません");let r=JSON.parse(JSON.stringify(e)),i=(0,u.c3)(r,t);if(!i||!i.children)throw Error(`要素 ${t} の親が見つかりません`);let a=i.children.findIndex(e=>e.data.id===t);if(-1===a)throw Error(`要素 ${t} が見つかりません`);return i.children.splice(a,1),{hierarchicalData:r}}function O(e,t,r){let i=JSON.parse(JSON.stringify(e)),a=(0,u.ic)(i,t);if(!a)throw Error(`更新対象の要素 ${t} が見つかりません`);return a.data={...a.data,...r},{hierarchicalData:i}}function x(e,t,r){let i=JSON.parse(JSON.stringify(e)),a=(0,u.ic)(i,t);if(!a)throw Error(`親要素 ${t} が見つかりません`);return!function e(t){t.children&&t.children.forEach(t=>{t.data.visible=r,e(t)})}(a),{hierarchicalData:i}}function C(e,t){let r=JSON.parse(JSON.stringify(e)),i=new Set(t);return!function e(t){t.data.selected=i.has(t.data.id),t.children&&t.children.forEach(e)}(r.root),{hierarchicalData:r}}let A=e=>"object"==typeof e&&null!==e&&"id"in e&&"string"==typeof e.id,L=(e,t)=>{let r=(0,u.c3)(e,t);return r?r.data:null},M=(e,t,r,i,a,n)=>{let o=[],l=[];for(let c=0;c<t.length;c++){let s=t[c],d=(0,b.PC)([s],y.rF.HORIZONTAL),h=(0,b.C1)(s||"",d,e.zoomRatio||1).length,u=Math.max(y.SK.SECTION_HEIGHT*(e.zoomRatio||1),h*y.gI*y.RZ+y.rF.VERTICAL*(e.zoomRatio||1)),f=Array(e.numberOfSections).fill(u).reduce((e,t)=>e+t,0),g=(Date.now()+c).toString();o.push(g);let m={...(0,S.N3)({numSections:e.numberOfSections,direction:"none"===i.direction?"right":i.direction}),id:g,x:a,y:n+c*(f+y.e$.Y),width:d,height:f,sectionHeights:Array(e.numberOfSections).fill(u),texts:Array(e.numberOfSections).fill("").map((e,r)=>0===r?t[c]:""),tentative:r,editing:!1,selected:!1};l.push(m)}return{elements:l,elementIds:o}},_=(()=>{let e={...(0,S.N3)({direction:"none",selected:!0,editing:!1}),id:"1",x:y.OS.X,y:y.OS.Y,editing:!1},t={...e,parentId:null},r=(0,u.Nz)({1:t});return r?{hierarchicalData:r,width:window.innerWidth,height:window.innerHeight,zoomRatio:1,numberOfSections:y.zX}:(console.error("Failed to create initial hierarchical data"),{hierarchicalData:{root:{data:e},version:"1.4.43"},width:window.innerWidth,height:window.innerHeight,zoomRatio:1,numberOfSections:y.zX})})(),$=(e,t)=>({...e,hierarchicalData:t.hierarchicalData}),k=e=>(0,u.WN)(e.hierarchicalData),R=e=>{let t=k(e);return 1===t.length?t[0]:void 0};function P(e){return t=>{let r=k(t);if(r.length>1){let e=r[0].id;if(!t.hierarchicalData)return t;let i=C(t.hierarchicalData,[e]);return $(t,i)}let i=e((0,u.Xd)(t.hierarchicalData),t.hierarchicalData);if(!i||!t.hierarchicalData)return t;let a=C(t.hierarchicalData,[i]);return $(t,a)}}let j=(e,t)=>(r,i)=>i.payload&&e(i.payload)?t(r,i.payload):((0,D.c)(`Invalid payload for action ${i.type}:`,i.payload),r),H=e=>t=>e(t),z={ZOOM_IN:H(e=>({...e,zoomRatio:e.zoomRatio+.1})),ZOOM_OUT:H(e=>({...e,zoomRatio:Math.max(e.zoomRatio-.1,.1)})),ARROW_UP:H(P((e,t)=>E(e,"up",t))),ARROW_DOWN:H(P((e,t)=>E(e,"down",t))),ARROW_RIGHT:H(P((e,t)=>E(e,"right",t))),ARROW_LEFT:H(P((e,t)=>E(e,"left",t))),LOAD_ELEMENTS:j(e=>"object"==typeof e&&null!==e&&Object.values(e).every(e=>"object"==typeof e&&null!==e&&"id"in e&&"string"==typeof e.id),(e,t)=>{if(0===Object.keys(t).length)return(0,D.c)("Loading empty elements map, returning initial state"),_;let r=(0,u.Nz)(t);return r?{...e,hierarchicalData:r}:((0,D.c)("Failed to convert flat structure to hierarchical"),e)}),SELECT_ELEMENT:j(e=>"object"==typeof e&&null!==e&&"id"in e&&"string"==typeof e.id,(e,t)=>{let{id:r,ctrlKey:i=!1,shiftKey:a=!1}=t;if(!e.hierarchicalData)return e;let n=(0,u.sv)(e.hierarchicalData,r);if(!n)return(0,D.c)(`Element with id ${r} not found`),e;let o=(0,u.TO)(e.hierarchicalData),l=e;if(o.length>0){if((0,D.c)(`SELECT_ELEMENT: Ending editing for ${o.length} elements`),!l.hierarchicalData)return l;let t=(0,u.Q3)(l.hierarchicalData,()=>({editing:!1}));if(t){let r=T(t,()=>e.numberOfSections,e.layoutMode,e.width||0,e.height||0);if(r){let e=function(e,t){(0,D.c)(`[updateHierarchyWithElementChanges] 開始 - 更新対象要素数: ${Object.keys(t).length}`);let r=JSON.parse(JSON.stringify(e)),i=function e(r){let i=!1,a=t[r.data.id];if(a){let e=r.data.y,t=a.y;r.data=a,i=!0,Math.abs(e-t)>.1&&(0,D.c)(`[updateHierarchyWithElementChanges] 要素「${r.data.texts}」 id=${r.data.id} - Y座標更新: ${e} → ${t}`)}if(r.children&&r.children.length>0)for(let t of r.children)e(t)&&(i=!0);return i}(r.root);return(0,D.c)(`[updateHierarchyWithElementChanges] 完了 - 更新有無: ${i}`),r}(t,(0,u.Xd)(r));e&&(l={...l,hierarchicalData:e})}}}let c=k(l),s=c[0];if((a||i)&&c.length>0&&l.hierarchicalData&&c.some(e=>{let t=(0,u.c3)(l.hierarchicalData,e.id),r=(0,u.c3)(l.hierarchicalData,n.id);return t?.data.id!==r?.data.id}))return l;let d=[];if(a&&c.length>0){let e=l.hierarchicalData?(0,u.c3)(l.hierarchicalData,s.id):null,t=e?.data.id||null,i=t?(0,u.PW)(l.hierarchicalData,t):l.hierarchicalData?.root.children?.map(e=>e.data)||[];i.sort((e,t)=>e.id.localeCompare(t.id));let a=i.findIndex(e=>e.id===s.id),n=i.findIndex(e=>e.id===r),[o,c]=[Math.min(a,n),Math.max(a,n)];d=i.slice(o,c+1).map(e=>e.id)}else d=i?c.some(e=>e.id===r)?c.filter(e=>e.id!==r).map(e=>e.id):[...c.map(e=>e.id),r]:[r];let h=l.hierarchicalData?(0,u.c3)(l.hierarchicalData,n.id):null,f=h?.data.id||null,g=d.filter(e=>{let t=(0,u.sv)(l.hierarchicalData,e);if(!t)return!1;let r=l.hierarchicalData?(0,u.c3)(l.hierarchicalData,t.id):null;return(r?.data.id||null)===f});if(!l.hierarchicalData)return l;let m=C(l.hierarchicalData,g);return $(l,m)}),DESELECT_ALL:H(e=>{if(!e.hierarchicalData)return e;let t=C(e.hierarchicalData,[]);return $(e,t)}),UPDATE_TEXT:j(e=>"object"==typeof e&&null!==e&&"id"in e&&"index"in e&&"value"in e&&"string"==typeof e.id&&"number"==typeof e.index&&"string"==typeof e.value,(e,t)=>{if(!e.hierarchicalData)return e;let r=(0,u.sv)(e.hierarchicalData,t.id);if(!r)return e;let i={...r,texts:r.texts.map((e,r)=>r===t.index?t.value:e)},a=O(e.hierarchicalData,t.id,i);return $(e,a)}),UPDATE_START_MARKER:j(e=>"object"==typeof e&&null!==e&&"id"in e&&"string"==typeof e.id&&"startMarker"in e,(e,t)=>{if(!e.hierarchicalData)return e;let r=(0,u.sv)(e.hierarchicalData,t.id);if(!r)return e;let i={...r,startMarker:t.startMarker},a=O(e.hierarchicalData,t.id,i);return $(e,a)}),UPDATE_END_MARKER:j(e=>"object"==typeof e&&null!==e&&"id"in e&&"string"==typeof e.id&&"endMarker"in e,(e,t)=>{if(!e.hierarchicalData)return e;let r=(0,u.sv)(e.hierarchicalData,t.id);if(!r)return e;let i={...r,endMarker:t.endMarker},a=O(e.hierarchicalData,t.id,i);return $(e,a)}),UPDATE_CONNECTION_PATH_TYPE:j(A,(e,t)=>{let{id:r,connectionPathType:i}=t;if(!i||!e.hierarchicalData)return(0,D.c)("connectionPathType is missing in payload"),e;let a=(0,u.sv)(e.hierarchicalData,r);if(!a)return e;let n={...a,startMarker:i,connectionPathType:i},o=O(e.hierarchicalData,r,n);return $(e,o)}),UPDATE_END_CONNECTION_PATH_TYPE:j(A,(e,t)=>{let{id:r,endConnectionPathType:i}=t;if(!i||!e.hierarchicalData)return(0,D.c)("endConnectionPathType is missing in payload"),e;let a=(0,u.sv)(e.hierarchicalData,r);if(!a)return e;let n={...a,endMarker:i,endConnectionPathType:i},o=O(e.hierarchicalData,r,n);return $(e,o)}),EDIT_ELEMENT:H(e=>{let t=R(e);if(!t||!e.hierarchicalData)return(0,D.c)("EDIT_ELEMENT: No selected element or hierarchical data"),e;(0,D.c)(`EDIT_ELEMENT: Editing element ${t.id}`,{currentEditing:t.editing,willSetEditing:!0});let r={...t,editing:!0},i=O(e.hierarchicalData,t.id,r);return(0,D.c)("EDIT_ELEMENT: Result hierarchy updated",{editingElements:i.hierarchicalData?(0,u.TO)(i.hierarchicalData).map(e=>e.id):[]}),$(e,i)}),END_EDITING:H(e=>{if(!e.hierarchicalData)return e;let t=(0,u.Q3)(e.hierarchicalData,e=>({...e,editing:!1}));return setTimeout(()=>{window.__handleEndEditingSuggestion?((0,D.c)("[END_EDITING] サジェスト処理を実行します"),(0,window.__handleEndEditingSuggestion)().catch(e=>{(0,D.c)(`[END_EDITING] サジェスト処理でエラー: ${e instanceof Error?e.message:"不明なエラー"}`)})):(0,D.c)("[END_EDITING] サジェスト処理関数が見つかりません")},300),{...e,hierarchicalData:t}}),MOVE_ELEMENT:j(e=>"object"==typeof e&&null!==e&&"id"in e&&"x"in e&&"y"in e&&"string"==typeof e.id&&"number"==typeof e.x&&"number"==typeof e.y,(e,t)=>{let{id:r,x:i,y:a}=t,n=k(e),o=(0,u.sv)(e.hierarchicalData,r);if(!o||!e.hierarchicalData)return(0,D.c)(`Element with id ${r} not found for move operation`),e;if(n.length>1&&n.some(e=>e.id===r)){let t=i-o.x,r=a-o.y,l=e.hierarchicalData;for(let e of n){let i={...e,x:e.x+t,y:e.y+r};l=O(l,e.id,i).hierarchicalData}return{...e,hierarchicalData:l}}let l={...o,x:i,y:a},c=O(e.hierarchicalData,r,l);return $(e,c)}),UPDATE_ELEMENT_SIZE:j(e=>"object"==typeof e&&null!==e&&"id"in e&&"width"in e&&"height"in e&&"sectionHeights"in e&&"string"==typeof e.id&&"number"==typeof e.width&&"number"==typeof e.height&&Array.isArray(e.sectionHeights),(e,t)=>{let{id:r,width:i,height:a,sectionHeights:n}=t,o=(0,u.sv)(e.hierarchicalData,r);if(!o||!e.hierarchicalData)return(0,D.c)(`Element with id ${r} not found for size update`),e;if(i<=0||a<=0)return(0,D.c)(`Invalid size values: width=${i}, height=${a}`),e;let l={...o,width:i,height:a,sectionHeights:n},c=O(e.hierarchicalData,r,l),s=T(c.hierarchicalData,()=>e.numberOfSections,e.layoutMode,e.width||0,e.height||0);return s?{...e,hierarchicalData:s}:((0,D.c)(`UPDATE_ELEMENT_SIZE: 位置調整に失敗しました`),$(e,c))}),ADD_ELEMENT:j(e=>null==e||"object"==typeof e&&null!==e&&(!("text"in e)||"string"==typeof e.text),(e,t)=>{let r,i,a;(0,D.c)(`[ADD_ELEMENT] アクション開始 - payload:`,t);let n=R(e);if((0,D.c)(`[ADD_ELEMENT] 選択された要素:`,n),!n)return(0,D.c)(`[ADD_ELEMENT] エラー: 選択された要素がありません`),e;if(!e.hierarchicalData)return(0,D.c)(`[ADD_ELEMENT] エラー: hierarchicalDataがnullです`),e;(0,D.c)(`[ADD_ELEMENT] 現在のhierarchicalData:`,e.hierarchicalData),h(e.hierarchicalData);let o=t?.text,l=(0,u.R1)(e.hierarchicalData);(0,D.c)(`[ADD_ELEMENT] 全要素数:`,l);let c=(0,u.PW)(e.hierarchicalData,n.id).filter(e=>e.visible);if((0,D.c)(`[ADD_ELEMENT] 選択要素の子要素数:`,c.length),c.length>0){let e=c[c.length-1];r=e.x,i=e.y+e.height+y.e$.Y,(0,D.c)(`[ADD_ELEMENT] 既存の子要素あり - 最後の子要素の下に配置`)}else r=n.x+n.width+y.e$.X,i=n.y,(0,D.c)(`[ADD_ELEMENT] 子要素なし - 親要素の右隣に配置`);let s={...(0,S.N3)({numSections:e.numberOfSections,direction:"none"===n.direction?"right":n.direction}),id:Date.now().toString(),x:r,y:i,texts:o?[o,...Array(Math.max(0,e.numberOfSections-1)).fill("")]:Array(e.numberOfSections).fill(""),selected:!0};(0,D.c)(`[ADD_ELEMENT] 新要素作成: ID=${s.id}, X=${s.x}, Y=${s.y}`);try{(0,D.c)(`[ADD_ELEMENT] addElementToHierarchy開始 - parentId=${n.id}`),a=I(e.hierarchicalData,n.id,s),(0,D.c)(`[ADD_ELEMENT] addElementToHierarchy完了:`,a)}catch(t){return(0,D.c)(`[ADD_ELEMENT] addElementToHierarchyでエラー:`,t),e}(0,D.c)(`[ADD_ELEMENT] 選択状態の更新開始 - 新要素ID: ${s.id}`);let d=C(a.hierarchicalData,[s.id]);(0,D.c)(`[ADD_ELEMENT] 選択状態更新完了:`,d);let f=(0,u.R1)(d.hierarchicalData);(0,D.c)(`[ADD_ELEMENT] 選択状態更新後の全要素数:`,f);let g=(0,u.Xd)(d.hierarchicalData)[s.id];g?(0,D.c)(`[ADD_ELEMENT] 選択状態更新後の新要素: X=${g.x}, Y=${g.y}, selected=${g.selected}`):(0,D.c)(`[ADD_ELEMENT] エラー: 選択状態更新後に新要素が見つかりません`),(0,D.c)(`[ADD_ELEMENT] 位置調整開始`);let m=T(d.hierarchicalData,()=>e.numberOfSections,e.layoutMode,e.width||0,e.height||0);if(!m)return(0,D.c)(`[ADD_ELEMENT] エラー: 位置調整に失敗しました`),e;let p=(0,u.Xd)(m)[s.id];return p?(0,D.c)(`[ADD_ELEMENT] 位置調整後の新要素: X=${p.x}, Y=${p.y}, selected=${p.selected}`):(0,D.c)(`[ADD_ELEMENT] エラー: 位置調整後に新要素が見つかりません`),(0,D.c)(`[ADD_ELEMENT] 位置調整後の全要素座標:`),m&&(0,u.Wc)(m,"  "),(0,D.c)(`[ADD_ELEMENT] 階層構造内での位置更新開始`),(0,D.c)(`[ADD_ELEMENT] 最終的な階層構造内の要素座標:`),(0,u.Wc)(m,"  "),(0,D.c)(`[ADD_ELEMENT] 成功: 最終的なhierarchicalData:`,m),{...e,hierarchicalData:m}}),ADD_ELEMENTS_SILENT:j(e=>null==e||"object"==typeof e&&null!==e&&(!("texts"in e)||Array.isArray(e.texts))&&(!("tentative"in e)||"boolean"==typeof e.tentative)&&(!("parentId"in e)||"string"==typeof e.parentId)&&(!("onError"in e)||"function"==typeof e.onError),(e,t)=>{let r,i,a;if(!(r=t?.targetNodeId?(0,u.sv)(e.hierarchicalData,t.targetNodeId):R(e))||!e.hierarchicalData){let r=e.hierarchicalData?t?.targetNodeId?`指定された要素（ID: ${t.targetNodeId}）が見つかりません。要素が削除されている可能性があります。`:"選択された要素がありません。要素を選択してから操作を実行してください。":"階層データが存在しません。";return t?.onError&&t.onError(r),(0,D.c)(`[ADD_ELEMENTS_SILENT] ${r} (targetNodeId: ${t?.targetNodeId||"未指定"})`),e}h(e.hierarchicalData);let n=t?.texts||[],o=t?.tentative||!1,l=(0,u.PW)(e.hierarchicalData,r.id).filter(e=>e.visible);if(l.length>0){let e=l[l.length-1];i=e.x,a=e.y+e.height+y.e$.Y}else i=r.x+r.width+y.e$.X,a=r.y;let c=e.hierarchicalData,s=[];for(let t=0;t<n.length;t++){let l=n[t],d=(0,b.PC)([l],y.rF.HORIZONTAL),h=(0,b.C1)(l||"",d,e.zoomRatio||1).length,u=Math.max(y.SK.SECTION_HEIGHT*(e.zoomRatio||1),h*y.gI*y.RZ+y.rF.VERTICAL*(e.zoomRatio||1)),f=Array(e.numberOfSections).fill(u).reduce((e,t)=>e+t,0),g=(Date.now()+t).toString();s.push(g);let m={...(0,S.N3)({numSections:e.numberOfSections,direction:"none"===r.direction?"right":r.direction}),id:g,x:i,y:a+t*(f+y.e$.Y),width:d,height:f,sectionHeights:Array(e.numberOfSections).fill(u),texts:Array(e.numberOfSections).fill("").map((e,r)=>0===r?n[t]:""),tentative:o,editing:!1,selected:!1};c=I(c,r.id,m).hierarchicalData}let d=T(c,()=>e.numberOfSections,e.layoutMode,e.width||0,e.height||0);return d?((0,D.c)(`[ADD_ELEMENTS_SILENT] ${n.length}個の要素を追加しました (IDs: ${s.join(", ")})`),t?.onSuccess&&setTimeout(()=>t.onSuccess(s),0),{...e,hierarchicalData:d}):((0,D.c)(`[ADD_ELEMENTS_SILENT] 位置調整に失敗しました`),e)}),ADD_SIBLING_ELEMENTS_SILENT:j(e=>"object"==typeof e&&null!==e&&"targetNodeId"in e&&"string"==typeof e.targetNodeId&&(!("texts"in e)||Array.isArray(e.texts))&&(!("tentative"in e)||"boolean"==typeof e.tentative)&&(!("position"in e)||["before","after"].includes(e.position))&&(!("onError"in e)||"function"==typeof e.onError)&&(!("onSuccess"in e)||"function"==typeof e.onSuccess),(e,t)=>{let r,i;if(!e.hierarchicalData){let r="階層データが存在しません。";return t?.onError&&t.onError(r),(0,D.c)(`[ADD_SIBLING_ELEMENTS_SILENT] ${r}`),e}let a=(0,u.sv)(e.hierarchicalData,t.targetNodeId);if(!a){let r=`指定された要素（ID: ${t.targetNodeId}）が見つかりません。`;return t?.onError&&t.onError(r),(0,D.c)(`[ADD_SIBLING_ELEMENTS_SILENT] ${r}`),e}if(!L(e.hierarchicalData,t.targetNodeId)){let r=`基準要素（ID: ${t.targetNodeId}）の親要素が見つかりません。`;return t?.onError&&t.onError(r),(0,D.c)(`[ADD_SIBLING_ELEMENTS_SILENT] ${r}`),e}h(e.hierarchicalData);let n=t?.texts||[],o=t?.tentative||!1,l=t?.position||"after";if(0===n.length)return(0,D.c)("[ADD_SIBLING_ELEMENTS_SILENT] 追加するテキストがありません"),e;"after"===l?(r=a.x,i=a.y+a.height+y.e$.Y):(r=a.x,i=a.y-y.e$.Y);let{elements:c,elementIds:s}=M(e,n,o,a,r,i),d=T(function(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"after",a=JSON.parse(JSON.stringify(e)),n=(0,u.c3)(a,t);if(!n){let e=`基準要素 ${t} の親ノードが見つかりません`;throw console.error(`[addMultipleSiblingsToHierarchy] エラー: ${e}`),Error(e)}if(!n.children){let e=`親ノードに子要素がありません`;throw console.error(`[addMultipleSiblingsToHierarchy] エラー: ${e}`),Error(e)}let o=n.children.findIndex(e=>e.data.id===t);if(-1===o){let e=`基準要素 ${t} が見つかりません`;throw console.error(`[addMultipleSiblingsToHierarchy] エラー: ${e}`),Error(e)}let l=r.map(e=>({data:e}));return n.children.splice("before"===i?o:o+1,0,...l),{hierarchicalData:a}}(e.hierarchicalData,t.targetNodeId,c,l).hierarchicalData,()=>e.zoomRatio||1);return d?((0,D.c)(`[ADD_SIBLING_ELEMENTS_SILENT] ${n.length}個の兄弟要素を追加しました (IDs: ${s.join(", ")})`),t?.onSuccess&&t.onSuccess(s),{...e,hierarchicalData:d}):((0,D.c)(`[ADD_SIBLING_ELEMENTS_SILENT] 位置調整に失敗しました`),e)}),ADD_SIBLING_ELEMENT:H(e=>{let t,r,i;let a=R(e);if(!a||!e.hierarchicalData)return e;h(e.hierarchicalData);let n=(0,u.c3)(e.hierarchicalData,a.id),o=n?n.data:null,l=o?(0,u.PW)(e.hierarchicalData,o.id).filter(e=>e.visible):[];if(l.length>0){let e=l[l.length-1];t=e.x,r=e.y+e.height+y.e$.Y}else t=a.x,r=a.y+a.height+y.e$.Y;let c={...(0,S.N3)({numSections:e.numberOfSections,direction:a.direction}),id:Date.now().toString(),x:t,y:r,texts:Array(e.numberOfSections).fill(""),selected:!0};(0,D.c)(`[ADD_SIBLING_ELEMENT] 新要素作成: ID=${c.id}, X=${c.x}, Y=${c.y}`);try{i=I(e.hierarchicalData,o?.id||null,c)}catch{return e}let s=T((0,u.Q3)(i.hierarchicalData,e=>({selected:e.id===c.id,editing:e.id===c.id})),()=>e.numberOfSections,e.layoutMode,e.width||0,e.height||0);if(!s)return(0,D.c)(`[ADD_SIBLING_ELEMENT] 位置調整に失敗しました`),e;let d=(0,u.Xd)(s);return{...e,hierarchicalData:s,elementsCache:d,cacheValid:!0}}),DELETE_ELEMENT:H(e=>{let t=k(e);if(0===t.length||!e.hierarchicalData)return e;(0,D.c)(`DELETE_ELEMENT開始: 削除対象要素数=${t.length}`),h(e.hierarchicalData);let r=t[0],i=e.hierarchicalData?(0,u.c3)(e.hierarchicalData,r.id):null,a=i?(0,u.PW)(e.hierarchicalData,i.data.id).filter(e=>!e.selected).sort((e,t)=>e.id.localeCompare(t.id)):[],n=a[0]?.id||i?.data.id,o=e.hierarchicalData;for(let e of t)o=w(o,e.id).hierarchicalData;n&&(o=C(o,[n]).hierarchicalData);let l=T(o,()=>e.numberOfSections,e.layoutMode,e.width||0,e.height||0);if(!l)return(0,D.c)(`DELETE_ELEMENT: 位置調整に失敗しました`),e;let c=(0,u.Xd)(l);return{...e,hierarchicalData:l,elementsCache:c,cacheValid:!0}}),CONFIRM_TENTATIVE_ELEMENTS:j(e=>"string"==typeof e,(e,t)=>{if(!e.hierarchicalData)return e;let r={...e.hierarchicalData,root:function r(i){let a={...i},n=(0,u.c3)(e.hierarchicalData,i.data.id),o=n?.data.id||null;return i.data.tentative&&o===t&&(a.data={...i.data,tentative:!1}),i.children&&i.children.length>0&&(a.children=i.children.map(r)),a}(e.hierarchicalData.root)},i=(0,u.Xd)(r);return{...e,hierarchicalData:r,elementsCache:i,cacheValid:!0}}),CANCEL_TENTATIVE_ELEMENTS:j(e=>"string"==typeof e,(e,t)=>{if(!e.hierarchicalData)return e;let r=function r(i){let a=(0,u.c3)(e.hierarchicalData,i.data.id),n=a?.data.id||null;if(i.data.tentative&&n===t)return null;let o={...i};if(i.children&&i.children.length>0){let e=i.children.map(r).filter(e=>null!==e);e.length>0?o.children=e:delete o.children}return o}(e.hierarchicalData.root);if(!r)return e;let i=T({...e.hierarchicalData,root:r},()=>e.numberOfSections,e.layoutMode,e.width||0,e.height||0);if(!i)return(0,D.c)(`CANCEL_TENTATIVE_ELEMENTS: 位置調整に失敗しました`),e;let a=(0,u.Xd)(i);return{...e,hierarchicalData:i,elementsCache:a,cacheValid:!0}}),UNDO:H(e=>{let t=s(e.hierarchicalData);return t?{...e,hierarchicalData:t}:e}),REDO:H(e=>{let t=d(e.hierarchicalData);return t?{...e,hierarchicalData:t}:e}),SNAPSHOT:H(e=>(e.hierarchicalData&&h(e.hierarchicalData),e)),DROP_ELEMENT:j(e=>"object"==typeof e&&null!==e&&"id"in e&&"string"==typeof e.id&&("targetNodeId"in e&&("string"==typeof e.targetNodeId||null===e.targetNodeId)||!("targetNodeId"in e))&&("targetIndex"in e&&"number"==typeof e.targetIndex||!("targetIndex"in e))&&("direction"in e&&"string"==typeof e.direction||!("direction"in e)),(e,t)=>{let{id:r,targetNodeId:i,targetIndex:a,direction:n}=t;if(!(0,u.sv)(e.hierarchicalData,r)||!e.hierarchicalData)return(0,D.c)(`Element with id ${r} not found for drop operation`),e;if(void 0!==a&&a<0)return(0,D.c)(`Invalid drop values: targetIndex=${a}`),e;if(r===i)return(0,D.c)("Invalid drop operation: circular reference detected"),e;let o=function(e,t,r,i){if(t===e.root.data.id)throw Error("ルート要素は移動できません");if(t===r)throw Error("自分自身を親にすることはできません");let a=(t,r)=>{let i=(0,u.ic)(e,t);return!!i&&!!i.children&&i.children.some(e=>e.data.id===r||a(e.data.id,r))};if(r&&a(t,r))throw Error("循環参照が発生するため移動できません");let n=JSON.parse(JSON.stringify(e)),o=(0,u.ic)(n,t);if(!o)throw Error(`移動対象の要素 ${t} が見つかりません`);let l=(0,u.c3)(n,t);if(l&&l.children){let e=l.children.findIndex(e=>e.data.id===t);-1!==e&&l.children.splice(e,1)}if(null===r)n.root.children||(n.root.children=[]),n.root.children.splice(i,0,o);else{let e=(0,u.ic)(n,r);if(!e)throw Error(`新しい親 ${r} が見つかりません`);e.children||(e.children=[]);let t=Math.min(i,e.children.length);e.children.splice(t,0,o)}return{hierarchicalData:n}}(e.hierarchicalData,r,i,a||0);if(void 0!==n){let e=(0,u.ic)(o.hierarchicalData,r);e&&(e.data={...e.data,direction:n},(0,D.c)(`Element ${r} direction updated to: ${n}`))}let l=T(o.hierarchicalData,()=>e.numberOfSections,e.layoutMode,e.width||0,e.height||0);if(!l)return(0,D.c)(`DROP_ELEMENT: 位置調整に失敗しました`),$(e,o);let c=(0,u.Xd)(l);return{...e,hierarchicalData:l,elementsCache:c,cacheValid:!0}}),CUT_ELEMENT:H(e=>{let t=k(e);if(0===t.length||!e.hierarchicalData)return e;let r=e.hierarchicalData,i=[];return t.forEach(t=>{let a=(0,N.mY)(e.hierarchicalData,t);a&&i.push({...a,type:"cut"}),r=w(r,t.id).hierarchicalData}),i.length>0&&(0,N._w)(i[0]).catch(e=>{console.error("Failed to cut elements to clipboard:",e)}),{...e,hierarchicalData:r}}),COPY_ELEMENT:H(e=>{let t=R(e);if(!t)return e;let r=(0,N.mY)(e.hierarchicalData,t);return r&&(0,N.lW)(r).catch(e=>{console.error("Failed to copy elements to clipboard:",e)}),e}),PASTE_ELEMENT:H(e=>e),EXPAND_ELEMENT:H(e=>{let t=R(e);if(!t||!e.hierarchicalData)return e;let r=x(e.hierarchicalData,t.id,!0),i=T(r.hierarchicalData,()=>e.numberOfSections,e.layoutMode,e.width||0,e.height||0);if(!i)return(0,D.c)(`EXPAND_ELEMENT: 位置調整に失敗しました`),$(e,r);let a=(0,u.Xd)(i);return{...e,hierarchicalData:i,elementsCache:a,cacheValid:!0}}),COLLAPSE_ELEMENT:H(e=>{let t=R(e);if(!t||!e.hierarchicalData)return e;let r=x(e.hierarchicalData,t.id,!1),i=T(r.hierarchicalData,()=>e.numberOfSections,e.layoutMode,e.width||0,e.height||0);if(!i)return(0,D.c)(`COLLAPSE_ELEMENT: 位置調整に失敗しました`),$(e,r);let a=(0,u.Xd)(i);return{...e,hierarchicalData:i,elementsCache:a,cacheValid:!0}}),ADD_HIERARCHICAL_ELEMENTS:j(e=>"object"==typeof e&&null!==e&&"hierarchicalItems"in e&&Array.isArray(e.hierarchicalItems)&&e.hierarchicalItems.every(e=>"object"==typeof e&&null!==e&&"string"==typeof e.text&&"number"==typeof e.level&&"string"==typeof e.originalLine)&&(!("parentId"in e)||"string"==typeof e.parentId)&&(!("onError"in e)||"function"==typeof e.onError),(e,t)=>{let r;if(!e.hierarchicalData)return e;h(e.hierarchicalData);let{targetNodeId:i,hierarchicalItems:a}=t;if(!(r=i?(0,u.sv)(e.hierarchicalData,i):R(e)))return t?.onError&&t.onError("親要素が見つかりません"),e;let n=e.hierarchicalData,o=[{element:r,level:-1}];for(let t=0;t<a.length;t++){let{text:r,level:i}=a[t];for(;o.length>0&&o[o.length-1].level>=i;)o.pop();let l=o[o.length-1];if(!l)continue;let c=(0,b.PC)([r],y.rF.HORIZONTAL),s=(0,b.C1)(r||"",c,e.zoomRatio||1).length,d=Math.max(y.SK.SECTION_HEIGHT*(e.zoomRatio||1),s*y.gI*y.RZ+y.rF.VERTICAL*(e.zoomRatio||1)),h=Array(e.numberOfSections).fill(d).reduce((e,t)=>e+t,0),u={...(0,S.N3)({numSections:e.numberOfSections,direction:"none"===l.element.direction?"right":l.element.direction}),id:`${Date.now()}-${t}`,x:0,y:0,width:c,height:h,sectionHeights:Array(e.numberOfSections).fill(d),texts:Array(e.numberOfSections).fill("").map((e,t)=>0===t?r:""),tentative:!1,editing:!1,selected:!1};n=I(n,l.element.id,u).hierarchicalData,o.push({element:u,level:i})}let l=T(n,()=>e.numberOfSections,e.layoutMode,e.width||0,e.height||0);if(!l)return(0,D.c)(`ADD_HIERARCHICAL_ELEMENTS: 位置調整に失敗しました`),e;let c=(0,u.Xd)(l);return(0,D.c)(`[ADD_HIERARCHICAL_ELEMENTS] ${a.length}個の階層要素を追加しました`),{...e,hierarchicalData:l,elementsCache:c,cacheValid:!0}}),PASTE_CLIPBOARD_ELEMENTS:j(e=>"object"==typeof e&&null!==e&&"clipboardData"in e&&"targetElementId"in e&&"string"==typeof e.targetElementId&&"object"==typeof e.clipboardData,(e,t)=>{let{clipboardData:r,targetElementId:i}=t;if(!e.hierarchicalData||!r)return e;let a=(0,u.sv)(e.hierarchicalData,i);if(!a)return e;try{let t=e=>{let r=Date.now().toString()+Math.random().toString(36).substr(2,9);return{data:{...e.data,id:r,selected:!1,editing:!1,x:a.x+20,y:a.y+20},children:e.children?e.children.map(e=>t(e)):void 0}},n=t(r.subtree),o=I(e.hierarchicalData,i,n.data);if(!o.hierarchicalData)return e;let l=o.hierarchicalData,c=(e,t)=>{t.children&&t.children.forEach(t=>{let r=I(l,e,t.data);r.hierarchicalData&&(l=r.hierarchicalData,c(t.data.id,t))})};c(n.data.id,n);let s=T(l,()=>e.numberOfSections,e.layoutMode,e.width||0,e.height||0);if(!s)return{...e,hierarchicalData:l};let d=(0,u.Xd)(s);return{...e,hierarchicalData:s,elementsCache:d,cacheValid:!0}}catch(t){return console.error("PASTE_CLIPBOARD_ELEMENTS: Error occurred:",t),e}})},F=(e,t)=>{try{let r=z[t.type];if(!r)return(0,D.c)(`Unknown action type: ${t.type}`),e;let i=r(e,t);if(!i||"object"!=typeof i)return(0,D.c)(`Invalid state returned for action ${t.type}`),e;if(void 0===i.hierarchicalData)return(0,D.c)(`Invalid hierarchical structure in state for action ${t.type}`),e;return i}catch(r){return(0,D.c)(`Error handling action ${t.type}:`,r),e}};function X(){let{tabs:e,currentTabId:t,addTab:r,closeTab:l,switchTab:c,updateTabState:s,updateTabName:d,updateTabSaveStatus:h}=(0,a.u)(),u=e.find(e=>e.id===t),f=(0,i.useCallback)(e=>{t&&s(t,r=>{let i=F(r,e);if("END_EDITING"===e.type){let e=(0,n.sV)(i.hierarchicalData);if(e){let r=(0,o.re)(u?.name||"無題",e);r!==u?.name&&d(t,r)}}return i})},[t,s,u,d]),g=(0,i.useCallback)(()=>{if(!u||!t)return;let e=(0,n.sV)(u.state.hierarchicalData);if(e){let r=(0,o.re)(u.name,e);r!==u.name&&d(t,r)}},[u,t,d]),m=(0,i.useCallback)(t=>{let r=e.find(e=>e.id===t);return r?r.isSaved?(l(t),{needsConfirmation:!1}):{needsConfirmation:!0,tabId:t}:(l(t),{needsConfirmation:!1})},[e,l]),p=(0,i.useCallback)(e=>{l(e)},[l]);return{tabs:e,currentTabId:t,currentTab:u,addTab:r,closeTab:l,switchTab:c,updateTabState:s,updateTabName:d,updateTabSaveStatus:h,forceCloseTab:p,dispatch:f,updateTabNameFromRootElement:g,handleCloseTabRequest:m}}},5992:(e,t,r)=>{"use strict";r.d(t,{b:()=>s});var i=r(4880),a=r(6183),n=r(1782);class o{async saveSvg(e,t){(0,a.Sz)(e,t)}async saveElements(e,t){(0,a.$r)(e,t)}async loadElements(){return new Promise((e,t)=>{let r=document.createElement("input");r.type="file",r.accept=".json",r.onchange=async r=>{try{let t=await (0,a.wl)(r);e(t)}catch(e){t(e)}},r.click()})}}class l{getVSCodeAPI(){let e=window;if(e.vscodeFileAPI)return e.vscodeFileAPI;throw Error("VSCode API が利用できません")}async saveSvg(e,t){return new Promise((r,i)=>{try{let a=e.cloneNode(!0);a.removeAttribute("style"),a.removeAttribute("transform");let n=new XMLSerializer().serializeToString(a),o=this.getVSCodeAPI(),l=e=>{"saveCompleted"===e.data.type&&(window.removeEventListener("message",l),e.data.success?r():e.data.cancelled?i(Error("SVG保存がキャンセルされました")):i(Error(e.data.error||"SVGの保存に失敗しました")))};window.addEventListener("message",l);let c=setTimeout(()=>{window.removeEventListener("message",l),i(Error("SVG保存がタイムアウトしました"))},3e4),s=r;r=()=>{clearTimeout(c),s()};let d=i;i=e=>{clearTimeout(c),d(e)},o.saveFile({type:"svg",content:'<?xml version="1.0" standalone="no"?>\r\n'+n},t)}catch(e){console.error("SVG保存エラー:",e),i(e)}})}async saveElements(e,t){return new Promise((r,i)=>{try{let a=this.getVSCodeAPI(),n=e=>{"saveCompleted"===e.data.type&&(window.removeEventListener("message",n),e.data.success?r():e.data.cancelled?i(Error("ファイル保存がキャンセルされました")):i(Error(e.data.error||"ファイルの保存に失敗しました")))};window.addEventListener("message",n);let o=setTimeout(()=>{window.removeEventListener("message",n),i(Error("ファイル保存がタイムアウトしました"))},3e4),l=r;r=()=>{clearTimeout(o),l()};let c=i;i=e=>{clearTimeout(o),c(e)},a.saveFile({type:"elements",content:e},t)}catch(e){console.error("要素保存エラー:",e),i(e)}})}async loadElements(e){return new Promise((t,r)=>{try{let i=this.getVSCodeAPI(),a=e=>{if("fileLoaded"===e.data.type){window.removeEventListener("message",a);try{let r=e.data.data.content,i=e.data.data.fileName;if(r&&"object"==typeof r&&r.root&&r.version)t({hierarchicalData:r,fileName:i});else{let e=r;e&&"object"==typeof e&&!Array.isArray(e)&&e.elements&&(e=e.elements);let a={};Array.isArray(e)?a=e.reduce((e,t)=>(t&&t.id&&(e[t.id]=t),e),{}):e&&"object"==typeof e&&(a=e);let o=(0,n.Pp)(Object.values(a));if(!o)throw Error("レガシー形式から階層構造への変換に失敗しました");t({hierarchicalData:o,fileName:i})}}catch(e){console.error("\uD83D\uDCC2 Error processing loaded file:",e),r(e)}}};window.addEventListener("message",a);let o=setTimeout(()=>{window.removeEventListener("message",a),r(Error("ファイル読み込みがタイムアウトしました"))},3e4),l=t;t=e=>{clearTimeout(o),l(e)};let c=r;r=e=>{clearTimeout(o),c(e)},i.loadFile(e)}catch(e){console.error("ファイル読み込みエラー:",e),r(e)}})}}function c(){return(0,i.oL)()?new l:new o}let s={get loadElements(){let e=c();return e.loadElements.bind(e)},get saveElements(){let e=c();return e.saveElements.bind(e)},get saveSvg(){let e=c();return e.saveSvg.bind(e)}}},6183:(e,t,r)=>{"use strict";r.d(t,{Fk:()=>s,re:()=>g,sV:()=>f,wl:()=>d,$r:()=>p,Sz:()=>m});var i=r(829),a=r(9929),n=r(2135),o=r(573),l=r(1782);let c=e=>"object"==typeof e&&null!==e&&("text"in e||"text2"in e||"text3"in e||"texts"in e&&"sectionHeights"in e),s=e=>{if(!c(e))return(0,a.N3)();if(e.texts&&e.sectionHeights){let t=(0,a.N3)(),r={...t,id:e.id||t.id,texts:e.texts,sectionHeights:e.sectionHeights,x:void 0!==e.x?Number(e.x):t.x,y:void 0!==e.y?Number(e.y):t.y,width:void 0!==e.width?Number(e.width):t.width,height:void 0!==e.height?Number(e.height):t.height,editing:void 0!==e.editing?!!e.editing:t.editing,selected:void 0!==e.selected?!!e.selected:t.selected,visible:void 0!==e.visible?!!e.visible:t.visible,tentative:void 0!==e.tentative?!!e.tentative:t.tentative,startMarker:t.startMarker,endMarker:t.endMarker,direction:void 0!==e.direction?e.direction:null===e.parentId?"none":"right"};return e.connectionPathType?r.startMarker=e.connectionPathType:e.startMarker&&(r.startMarker=e.startMarker),e.endConnectionPathType?r.endMarker=e.endConnectionPathType:e.endMarker&&(r.endMarker=e.endMarker),r}let t=(0,a.N3)(),r={...t,id:e.id||t.id,texts:[e.text||"",e.text2||"",e.text3||""],sectionHeights:[e.section1Height||i.SK.SECTION_HEIGHT,e.section2Height||i.SK.SECTION_HEIGHT,e.section3Height||i.SK.SECTION_HEIGHT],x:void 0!==e.x?Number(e.x):0,y:void 0!==e.y?Number(e.y):0,width:void 0!==e.width?Number(e.width):t.width,height:void 0!==e.height?Number(e.height):t.height,editing:void 0!==e.editing?!!e.editing:t.editing,selected:void 0!==e.selected?!!e.selected:t.selected,visible:void 0!==e.visible?!!e.visible:t.visible,tentative:void 0!==e.tentative?!!e.tentative:t.tentative,startMarker:t.startMarker,endMarker:t.endMarker,direction:void 0!==e.direction?e.direction:t.direction||"right"};return e.connectionPathType?r.startMarker=e.connectionPathType:e.startMarker&&(r.startMarker=e.startMarker),e.endConnectionPathType?r.endMarker=e.endConnectionPathType:e.endMarker&&(r.endMarker=e.endMarker),r},d=e=>new Promise((t,r)=>{let i=e.target,a=i.files?.[0];if(!a){r(Error("Error: ファイルが選択されていません"));return}let c=(0,n.Nz)(a.name);if(!c||"untitled"===c){r(Error("Error: 安全でないファイル名が検出されました"));return}let d=new FileReader;d.onload=e=>{try{let r;let i=e.target?.result;if("string"!=typeof i)throw Error("Invalid file content");if(!(0,o.IU)(i))throw Error("ファイル内容が安全でない可能性があります");let c=JSON.parse(i);if(!(0,o.L5)(c))throw Error("JSONデータが安全でない可能性があります");let d=(0,n.Zm)(c);if(function(e){return"object"==typeof e&&null!==e&&"root"in e&&"object"==typeof e.root&&null!==e.root&&"data"in e.root&&"version"in e}(d))r=d;else{let e={};if(function(e){return"object"==typeof e&&null!==e&&"elements"in e&&Array.isArray(e.elements)&&"version"in e}(d))e=d.elements.filter(e=>!!(e.id||Object.prototype.hasOwnProperty.call(e,"id"))||(console.warn("IDが欠けている要素を削除します"),!1)).map(e=>s(e)).reduce((e,t)=>(e[t.id]=t,e),{});else{if(Array.isArray(d))e=d.filter(e=>!!(e.id||Object.prototype.hasOwnProperty.call(e,"id"))||(console.warn("IDが欠けている要素を削除します"),!1)).map(e=>s(e)).reduce((e,t)=>(e[t.id]=t,e),{});else if(function(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)&&!("elements"in e)&&!("root"in e)&&Object.keys(e).length>0&&Object.values(e).some(e=>"object"==typeof e&&null!==e&&"id"in e&&"texts"in e)}(d))e=Object.values(d).filter(e=>!!(e.id||Object.prototype.hasOwnProperty.call(e,"id"))||(console.warn("IDが欠けている要素を削除します"),!1)).map(e=>s(e)).reduce((e,t)=>(e[t.id]=t,e),{});else throw console.error("認識できないデータ形式です"),Error("認識できないデータ形式です")}let t=(0,l.Pp)(Object.values(e));if(!t)throw Error("レガシー形式から階層構造への変換に失敗しました");r=t}t({hierarchicalData:r,fileName:a.name})}catch(e){console.error("ファイル読み込みエラー:",e),r(Error(`Error: ファイルの読み込みに失敗しました - ${e instanceof Error?e.message:String(e)}`))}},d.onerror=()=>{console.error("ファイル読み込みエラー"),r(Error("Error: ファイルの読み込みに失敗しました"))},d.readAsText(a),i.value=""}),h=e=>{if(!e.querySelector("foreignObject div"))return;let t=e.querySelector('g:not([data-exclude-from-export="true"])');if(t)return t.querySelector("foreignObject div")?.textContent||void 0},u=e=>{if(0===e.length)return;let t=e[0];if(t&&t.texts&&t.texts.length>0){let e=t.texts[0];return e&&"string"==typeof e?e:void 0}},f=e=>{if(!e||!e.root)return;let t=e.root.data;if(t&&t.texts&&t.texts.length>0){let e=t.texts[0];return e&&"string"==typeof e?e:void 0}},g=(e,t)=>{let r=e||"Untitled";if(("Untitled"===r||"無題"===r)&&t){let e=t.trim();e&&(r=e.substring(0,30).replace(/[\\/:*?"<>|]/g,"_"))}return r},m=(e,t)=>{let r=e.cloneNode(!0);r.setAttribute("xmlns","http://www.w3.org/2000/svg"),r.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");let a=e.getAttribute("viewBox");a&&r.setAttribute("viewBox",a);let n=e.getAttribute("width")||e.clientWidth.toString(),o=e.getAttribute("height")||e.clientHeight.toString();r.setAttribute("width",n),r.setAttribute("height",o);let l=document.createElementNS("http://www.w3.org/2000/svg","rect");l.setAttribute("width","100%"),l.setAttribute("height","100%"),l.setAttribute("fill",i.i_),r.insertBefore(l,r.firstChild),r.querySelectorAll('[data-exclude-from-export="true"]').forEach(e=>e.parentNode?.removeChild(e)),r.querySelectorAll('rect[stroke="'+i.iC.SELECTED.STROKE_COLOR+'"]').forEach(e=>{e.getAttribute("height")!==e.getAttribute("width")&&(e.setAttribute("stroke",i.iC.NORMAL.STROKE_COLOR),e.removeAttribute("filter"),e.setAttribute("style",e.getAttribute("style")?.replace(/filter:[^;]+;?/,"")||""))}),r.querySelectorAll("foreignObject div").forEach(e=>{let t=e.getAttribute("style")||"",r=`
            ${t}
            font-family: ${i.zs};
            font-size: ${i.gI}px;
            color: ${i._K};
            white-space: pre-wrap;
            word-break: break-word;
            user-select: text;
        `;e.setAttribute("style",r)}),r.querySelectorAll('line[stroke="'+i.iC.SELECTED.STROKE_COLOR+'"]').forEach(e=>{e.setAttribute("stroke",i.iC.NORMAL.STROKE_COLOR)});let c=document.createElementNS("http://www.w3.org/2000/svg","style");c.textContent=`
        text { font-family: ${i.zs}; font-size: ${i.gI}px; }
        foreignObject div { font-family: ${i.zs}; font-size: ${i.gI}px; }
    `,r.appendChild(c),r.setAttribute("style","user-select: text;"),r.setAttribute("text-rendering","optimizeLegibility");let s=new Blob(['<?xml version="1.0" standalone="no"?>\r\n',new XMLSerializer().serializeToString(r)],{type:"image/svg+xml;charset=utf-8"}),d=URL.createObjectURL(s),u=g(t,h(e)),f=document.createElement("a");f.href=d,f.download=u,document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(d)},p=(e,t)=>{let r=g(t,u(e)),i=(0,l.Pp)(e);if(!i){console.error("階層構造への変換に失敗しました");let t=new Blob([JSON.stringify(e.map(e=>{let{x:t,y:r,...i}=e;return i}))],{type:"application/json"}),i=URL.createObjectURL(t),a=document.createElement("a");a.href=i,a.download=`${r}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a);return}let a=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),n=URL.createObjectURL(a),o=document.createElement("a");o.href=n,o.download=`${r}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(n)}},6323:(e,t,r)=>{"use strict";r.d(t,{G6:()=>ee,CG:()=>J,Es:()=>z,ZF:()=>R,S4:()=>j,kN:()=>w,af:()=>M,zn:()=>$,OA:()=>Z,XH:()=>U,N4:()=>W,_1:()=>x,xo:()=>A,$f:()=>v,k0:()=>V,EN:()=>et,vG:()=>X,wt:()=>K,QY:()=>F,xN:()=>P,K2:()=>H,qu:()=>O,Yu:()=>_,li:()=>k,Iz:()=>Q,bJ:()=>B,LL:()=>G,JT:()=>C,Jg:()=>L,hS:()=>N,mF:()=>q,AN:()=>er,vY:()=>Y});var i=r(2109),a=r.n(i),n=r(829),o=r(831);let l="1.01";var c=r(2135),s=r(573);let d={canvasBackgroundColor:n.i_,connectionPathColor:n.BH,elementColor:n.iC.NORMAL.COLOR,fontFamily:n.zs,markerType:n.qn,strokeColor:n.iC.NORMAL.STROKE_COLOR,strokeWidth:n.iC.STROKE_WIDTH,textColor:n._K,connectionPathStroke:n._o,selectedStrokeColor:n.iC.SELECTED.STROKE_COLOR},h="styles",u="tabsState",f="appVersion",g="prompt",m="systemPromptTemplate",p="apiKey",E="modelType",y={"gemini-2.0-flash":"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent","gemini-2.5-flash":"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent"},D="test-modeling-app-key-2024",S={getItem:e=>{try{let t=localStorage.getItem(e);if(null===t)return null;if(t.length>1048576)return console.warn(`LocalStorage値が大きすぎます: ${e}`),null;return t}catch(e){return console.error("localStorage access failed:",e),null}},setItem:(e,t)=>{if(!e||"string"!=typeof e||0===e.trim().length){console.error("無効なlocalStorageキー:",e);return}if("string"!=typeof t){console.error("localStorageの値は文字列である必要があります");return}if(t.length>1048576){console.error("localStorageの値が大きすぎます");return}try{localStorage.setItem(e,t)}catch(e){console.error("localStorage access failed:",e)}},removeItem:e=>{try{localStorage.removeItem(e)}catch(e){console.error("localStorage access failed:",e)}}};S.getItem(f)!==l&&(Object.keys(localStorage).forEach(e=>{e!==u&&e!==p&&e!==g&&S.removeItem(e)}),S.setItem(f,l)),S.removeItem("numberOfSections");let b=(e,t)=>{let r=S.getItem(e);if(!r)return t;if("string"==typeof t)return(0,c.jZ)(r);if("number"==typeof t){let e=Number(r);return isNaN(e)?t:e}return r},T=(e,t)=>{if(null==t)return;if(e===p){K(String(t));return}if(!(0,s.IK)(e,t)){console.warn(`設定値が無効です: ${e} = ${t}`);return}let r=t;"string"==typeof t&&(r=(0,c.jZ)(t)),S.setItem(e,String(r))},v=()=>{let e=S.getItem(h);if(!e){let e=I();return e.selectedStrokeColor||(e.selectedStrokeColor=n.iC.SELECTED.STROKE_COLOR,S.setItem(h,JSON.stringify(e))),e}try{let t=JSON.parse(e);return t.selectedStrokeColor||(t.selectedStrokeColor=n.iC.SELECTED.STROKE_COLOR,S.setItem(h,JSON.stringify(t))),{...d,...t}}catch(e){return console.error("Failed to parse styles:",e),d}},N=e=>{let t={...v(),...e};S.setItem(h,JSON.stringify(t))},I=()=>{let e={...d},t=!1;return["canvasBackgroundColor","connectionPathColor","elementColor","fontFamily","markerType","strokeColor","strokeWidth","textColor","connectionPathStroke","selectedStrokeColor"].forEach(r=>{let i=S.getItem(r);null!==i&&(t=!0,"strokeWidth"===r||"connectionPathStroke"===r?e[r]=parseFloat(i):e[r]=i,S.removeItem(r))}),t&&S.setItem(h,JSON.stringify(e)),e},w=()=>v().elementColor,O=e=>N({elementColor:e}),x=()=>v().strokeColor,C=e=>N({strokeColor:e}),A=()=>v().strokeWidth,L=e=>N({strokeWidth:e}),M=()=>v().fontFamily,_=e=>N({fontFamily:e}),$=()=>v().markerType,k=e=>N({markerType:e}),R=()=>v().connectionPathColor,P=e=>N({connectionPathColor:e}),j=()=>v().connectionPathStroke,H=e=>N({connectionPathStroke:e}),z=()=>v().canvasBackgroundColor,F=e=>N({canvasBackgroundColor:e}),X=()=>v().textColor,Y=e=>N({textColor:e}),W=()=>v().selectedStrokeColor,G=e=>N({selectedStrokeColor:e}),J=()=>{try{let e=S.getItem(p);if(!e)return"";return a().AES.decrypt(e,D).toString(a().enc.Utf8)}catch(e){return console.error("API key decryption failed:",e),""}},K=e=>{try{let t=a().AES.encrypt(e,D).toString();S.setItem(p,t)}catch(e){console.error("API key encryption failed:",e)}},U=()=>b(g,""),B=e=>T(g,e),V=()=>b(m,o.UK),q=e=>T(m,e),Z=()=>{let e=b(E,Object.keys(y)[0]);return"gemini-1.5-flash"===e?(Q("gemini-2.0-flash"),"gemini-2.0-flash"):e},Q=e=>T(E,e),ee=()=>y[Z()]||y["gemini-2.0-flash"],et=()=>S.getItem(u),er=e=>S.setItem(u,e)},7050:(e,t,r)=>{"use strict";r.d(t,{$r:()=>i.$r,Sz:()=>i.Sz,sV:()=>i.sV,wl:()=>i.wl});var i=r(6183);r(5992)},7242:(e,t,r)=>{"use strict";r.d(t,{O:()=>m,u:()=>p});var i=r(5155),a=r(2115),n=r(1782),o=r(621),l=r(829),c=r(9929),s=r(6183),d=r(6323);let h=(0,a.createContext)(void 0),u=e=>{let t=e??l.zX,r="default",i={...(0,c.N3)({numSections:t,selected:!0,editing:!1}),id:"1",x:l.OS.X,y:l.OS.Y,editing:!1},a={...i,parentId:null},s={1:a};console.log("createInitialTabState - initialElements:",s),console.log("createInitialTabState - legacyRootElement:",a);let d=(0,n.Nz)(s);if(console.log("createInitialTabState - hierarchicalData:",d),!d){console.error("Failed to create hierarchical data for new tab");let e={root:{data:i},version:"1.4.43"};return console.log("createInitialTabState - using fallback hierarchicalData:",e),{id:(0,o.A)(),name:"無題",isSaved:!1,lastSavedElements:JSON.stringify({1:i}),state:{hierarchicalData:e,width:window.innerWidth,height:window.innerHeight,zoomRatio:1,numberOfSections:t,layoutMode:r},layoutMode:r}}return{id:(0,o.A)(),name:"無題",isSaved:!1,lastSavedElements:JSON.stringify({1:i}),state:{hierarchicalData:d,width:window.innerWidth,height:window.innerHeight,zoomRatio:1,numberOfSections:t,layoutMode:r},layoutMode:r}},f=()=>{try{let e=(0,d.EN)();if(e){let t=JSON.parse(e);if(Array.isArray(t?.tabs)&&"string"==typeof t?.currentTabId){let e=t.tabs.map(e=>({...e,layoutMode:e.layoutMode||"default",state:{...e.state,..."elements"in e.state&&{elementsCache:Object.fromEntries(Object.entries(e.state.elements).map(e=>{let[t,r]=e;return[t,(0,s.Fk)(r)]}))}}})),r=e.some(e=>e.id===t.currentTabId)?t.currentTabId:e[0]?.id||"";return{tabs:e,currentTabId:r}}}}catch{}let e=u();return{tabs:[e],currentTabId:e.id}},g=(e,t)=>{(0,d.AN)(JSON.stringify({tabs:e,currentTabId:t}))},m=e=>{let{children:t}=e,[r,o]=(0,a.useState)(()=>f()),{tabs:c,currentTabId:s}=r;(0,a.useEffect)(()=>{g(c,s)},[c,s]);let d=(0,a.useCallback)(()=>{let e=c.find(e=>e.id===s),t=u(e?.state.numberOfSections??l.zX);return o(e=>({tabs:[...e.tabs,t],currentTabId:t.id})),t.id},[c,s]),m=(0,a.useCallback)(e=>{o(t=>{if(1===t.tabs.length)return t;let r=t.tabs.filter(t=>t.id!==e),i=e===t.currentTabId?r[0]?.id||"":t.currentTabId;return{tabs:r,currentTabId:i}})},[]),p=(0,a.useCallback)(e=>{o(t=>{if(!t.tabs.find(t=>t.id===e))return t;let r=t.tabs.map(t=>t.id===e?{...t,state:{...t.state,layoutMode:t.layoutMode}}:t);return{...t,currentTabId:e,tabs:r}})},[]),E=(0,a.useCallback)((e,t)=>{o(r=>{let i=r.tabs.map(r=>{if(r.id===e){let e=t(r.state),i=JSON.stringify(JSON.parse(JSON.stringify(e.hierarchicalData?(0,n.Xd)(e.hierarchicalData):{}))),a=r.lastSavedElements!==i;return{...r,state:e,isSaved:!a}}return r});return{...r,tabs:i}})},[]),y=(0,a.useCallback)((e,t)=>{o(r=>({...r,tabs:r.tabs.map(r=>r.id===e?{...r,name:t}:r)}))},[]),D=(0,a.useCallback)((e,t,r)=>{o(i=>{let a=i.tabs.map(i=>i.id===e?{...i,isSaved:t,lastSavedElements:r||i.lastSavedElements}:i);return{...i,tabs:a}})},[]),S=(0,a.useCallback)(()=>{let e=c.find(e=>e.id===s);return e?.state},[c,s]),b=(0,a.useCallback)(()=>{let e=c.find(e=>e.id===s);return e?.state.numberOfSections??l.zX},[c,s]),T=(0,a.useCallback)(e=>{let t=Math.max(1,Math.min(10,e));E(s,e=>({...e,numberOfSections:t}))},[s,E]),v=(0,a.useCallback)(()=>{let e=c.find(e=>e.id===s);return e?.layoutMode||"default"},[c,s]),N=(0,a.useCallback)(e=>{o(t=>({...t,tabs:t.tabs.map(t=>t.id===s?{...t,layoutMode:e,state:{...t.state,layoutMode:e}}:t)}))},[s]),I=(0,a.useMemo)(()=>({tabs:c,currentTabId:s,addTab:d,closeTab:m,switchTab:p,updateTabState:E,updateTabName:y,updateTabSaveStatus:D,getCurrentTabState:S,getCurrentTabNumberOfSections:b,updateCurrentTabNumberOfSections:T,getCurrentTabLayoutMode:v,updateCurrentTabLayoutMode:N}),[c,s,d,m,p,E,y,D,S,b,T,v,N]);return(0,i.jsx)(h.Provider,{value:I,children:t})},p=()=>{let e=(0,a.useContext)(h);if(!e)throw Error("useTabs must be used within a TabsProvider");return e}},7451:(e,t,r)=>{"use strict";r.d(t,{d:()=>l,t:()=>o});var i=r(5155),a=r(2115);let n=(0,a.createContext)(null),o=e=>{let{children:t}=e,[r,o]=(0,a.useState)([]),[l,c]=(0,a.useState)(new Map),s=(0,a.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",r=`${e}:${t}`,i=Date.now();o(a=>{if(a.some(r=>r.message===e&&r.type===t))return a;let n=l.get(r);if(n&&i-n<3e3)return a;c(e=>{let t=new Map(e);for(let[e,a]of(t.set(r,i),t.entries()))i-a>1e4&&t.delete(e);return t});let s=new Date().getTime().toString()+Math.random().toString(),d=[...a,{id:s,message:e,type:t}];return d.length>5&&d.shift(),setTimeout(()=>{o(e=>e.filter(e=>e.id!==s))},3e3),d})},[l]),d=e=>{switch(e){case"info":default:return{backgroundColor:"rgba(76, 175, 80, 0.9)",color:"white"};case"warn":return{backgroundColor:"rgba(255, 193, 7, 0.9)",color:"#000000"};case"error":return{backgroundColor:"rgba(244, 67, 54, 0.9)",color:"white"}}};return(0,i.jsxs)(n.Provider,{value:{addToast:s},children:[t,(0,i.jsx)("div",{style:{position:"fixed",bottom:"20px",left:"50%",transform:"translateX(-50%)",zIndex:1e3,pointerEvents:"none"},children:r.map(e=>(0,i.jsx)("div",{style:{...d(e.type),padding:"10px 20px",borderRadius:"10px",marginBottom:"10px",transition:"opacity 0.5s",opacity:1},children:e.message},e.id))})]})},l=()=>{let e=(0,a.useContext)(n);if(!e)throw Error("useToast must be used within a ToastProvider");return e}},8265:(e,t,r)=>{"use strict";r.d(t,{c:()=>a,y:()=>i});let i=!1,a=(e,t)=>{i&&console.log(`[DEBUG] ${e}`,t)}},8963:(e,t,r)=>{"use strict";r.d(t,{CG:()=>i.CG,OA:()=>i.OA,XH:()=>i.XH});var i=r(6323)},9929:(e,t,r)=>{"use strict";r.d(t,{N3:()=>l,Je:()=>s,K9:()=>c,EJ:()=>d});var i=r(621),a=r(6323),n=r(829);let o={MAX_ELEMENT_TEXT_LENGTH:20},l=function(){let{numSections:e=n.zX,direction:t="right",selected:r=!0,editing:o=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,a.zn)();return{id:(0,i.A)(),texts:Array(e).fill(""),x:0,y:0,width:n.SK.WIDTH.MIN,height:n.SK.SECTION_HEIGHT*e,sectionHeights:Array(e).fill(n.SK.SECTION_HEIGHT),editing:o,selected:r,visible:!0,tentative:!1,startMarker:l,endMarker:"none",direction:t}},c=(e,t,r)=>!1,s=e=>{if(!e)return"階層構造がありません";let t=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i="  ".repeat(r),a=e.data,n=d(a.texts.filter(e=>e&&e.trim()).join(", ")||"(テキストなし)"),o=`${i}- ID: ${a.id} | テキスト: "${n}"`;return e.children&&e.children.length>0&&(o+="\n"+e.children.map(e=>t(e,r+1)).join("\n")),o},r=t(e.root);return`階層構造:
${r}`},d=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.MAX_ELEMENT_TEXT_LENGTH;return e.substring(0,t)}}}]);
"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[980],{573:(e,t,r)=>{function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4;if("string"!=typeof e||e.length>t)return!1;for(let t of[/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/i,/javascript:.*$/i,/data:.*$/i,/eval\s*\([^)]*\)/i,/on\w+\s*=/i,/expression\s*\([^)]*\)/i])if(t.test(e))return!1;return!((e.match(/<[^>]*>/g)||[]).length>10)}function i(e){if("string"==typeof e){if(0===e.trim().length)return!1;try{e=JSON.parse(e)}catch{return!1}}if(null==e||"object"!=typeof e)return!0;try{JSON.stringify(e)}catch{return!1}return!(!function e(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(r>10)return!1;if(t&&"object"==typeof t){for(let n of Object.values(t))if(!e(n,r+1))return!1}return!0}(e)||Object.prototype.hasOwnProperty.call(e,"__proto__")||Object.prototype.hasOwnProperty.call(e,"constructor")||Object.prototype.hasOwnProperty.call(e,"prototype"))}function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1048576;if("string"!=typeof e||new Blob([e]).size>t)return!1;for(let t of[/<script/i,/javascript:/i,/on\w+\s*=/i,/data:\s*[^;]*;base64/i,/eval\s*\(/i,/Function\s*\(/i])if(t.test(e))return!1;return!0}function o(e,t){if("string"!=typeof e||0===e.trim().length||!["apiKey","theme","language","autoSave","fontSize","maxHistory","showLineNumbers","wordWrap"].includes(e))return!1;switch(e){case"apiKey":return function(e){if("string"!=typeof e||0===e.trim().length)return!1;let t=e.split("").some(e=>{let t=e.charCodeAt(0);return t>=0&&t<=31});return!/[<>'"&]/.test(e)&&!t&&!(e.length<8)&&!(e.length>128)}(t);case"theme":return["light","dark","auto"].includes(t);case"language":return["ja","en"].includes(t);case"autoSave":case"showLineNumbers":case"wordWrap":return"boolean"==typeof t;case"fontSize":return"number"==typeof t&&t>=10&&t<=24;case"maxHistory":return"number"==typeof t&&t>=0&&t<=100;default:return!1}}r.d(t,{IK:()=>o,IU:()=>l,L5:()=>i,kb:()=>n})},829:(e,t,r)=>{r.d(t,{BH:()=>S,FM:()=>y,JY:()=>g,N:()=>m,OS:()=>l,RZ:()=>p,SK:()=>o,_K:()=>C,_o:()=>w,e$:()=>a,gI:()=>u,iC:()=>d,i_:()=>x,lB:()=>s,mO:()=>c,mU:()=>n,p1:()=>v,qn:()=>I,rF:()=>f,tl:()=>E,uF:()=>b,vX:()=>O,zX:()=>i,zs:()=>h});let n=.8,i=3,l={X:50,Y:50},o={SECTION_HEIGHT:24,WIDTH:{MAX:300,MIN:50}},a={X:100,Y:10},d={NORMAL:{COLOR:"#ffffff",STROKE_COLOR:"#696969"},SELECTED:{STROKE_COLOR:"#0000ff"},DRAGGING:{COLOR:"rgba(100, 100, 255, 0.3)",STROKE_COLOR:"rgba(0, 0, 255, 0.3)"},SHADDOW:{COLOR:"rgba(0, 0, 0, 0.5)"},RX:2,STROKE:"2px",STROKE_WIDTH:2},s={COLOR:"black",DRAGGING_COLOR:"rgba(0, 0, 255, 0.3)",STROKE:.5},c=80,u=16,h='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',f={HORIZONTAL:3,VERTICAL:2},m=3,p=1.4,g=40,y=40,b=80,E={HEIGHT:12,WIDTH:14,OFFSET:14},v={SIZE:10,OFFSET:10},O={NONE:"none",ARROW:"arrow",CIRCLE:"circle",SQUARE:"square",DIAMOND:"diamond",FILLED_ARROW:"filled_arrow",FILLED_CIRCLE:"filled_circle",FILLED_SQUARE:"filled_square",FILLED_DIAMOND:"filled_diamond"},I=O.NONE,S="black",w=.5,x="#ffffff",C="#000000"},831:(e,t,r)=>{r.d(t,{U:()=>n});let n=`
You are a highly skilled data analyst specializing in structuring information for systematic thinking. Your task is to extract and organize key elements from textual input to help users structure their thoughts in a hierarchical format. Follow the instructions below strictly to generate child elements that can be added directly under the user-selected element (marked as "selected"). The generated suggestions must be strictly based on the provided [Input Information], and no additional elements, interpretations, or assumptions should be made.

## [Task]
- First, analyze the [Input Information] and summarize as well as classify only the sentences that are directly related to the content of the selected element.
- Then, extract possible child elements from this summarized and categorized information that are relevant to the user-selected element.
- The suggestions must strictly come from the classified sentences in the [Input Information]. Do not include elements that already exist elsewhere in [Current Structure].
- Ensure that the newly suggested elements do not duplicate existing ones in [Current Structure], **regardless of their position in the hierarchy**. If a relevant element appears multiple times within [Input Information], it can still be considered for extraction **as long as it does not already exist anywhere in [Current Structure]**.
- Before finalizing the list of suggested elements, compare each candidate against all existing elements in [Current Structure]. If a candidate matches an existing element in any part of [Current Structure], discard it and select another if available.
- If the selected element is a structured entity such as "Two Challenges," generate exactly two child elements. If two valid elements cannot be found, output placeholders instead (e.g., "Placeholder 1," "Placeholder 2").
- If removing duplicates results in fewer than the required number of elements (e.g., less than 3 when 3–5 are expected), return only the available unique elements. If no unique elements remain, output an empty result unless placeholders are required.

## [Requirements]
1. Carefully analyze and filter the [Input Information] to include only details directly related to the selected element.
2. Summarize and classify the relevant sentences from the [Input Information] before extracting potential child elements.
3. The output must be in a code block format, listing only element names, each on a new line.
4. Do not provide explanations, descriptions, or any additional natural language text.
5. Ensure logical consistency with the existing structure in [Current Structure].
6. Exclude elements that already exist anywhere in [Current Structure].
7. Provide up to 5 appropriate suggestions. If fewer than 3 valid elements exist, output only the available ones.
8. If no valid elements can be determined, do not output any suggestions unless placeholders are required.
9. Do not create new elements or infer missing information.

## [Validation Rules]
Before suggesting an element, ensure that:
- It exists in [Input Information] (if not, discard it).
- It does not exist anywhere else in [Current Structure] (if found, discard it).

[Output Format]
The output must be in Japanese, formatted as follows:

\`\`\`
提案要素1
提案要素2
提案要素3
\`\`\`
`.trim();`
[Current Structure]
\`\`\`
{{structureText}}
\`\`\`

[Input Information]
\`\`\`
{{inputText}}
\`\`\`
`.trim()},1050:(e,t,r)=>{r.d(t,{N3:()=>n.N3,YV:()=>n.YV});var n=r(9499)},1231:(e,t,r)=>{let n;r.d(t,{u:()=>R,F:()=>H});let i=[],l=0,o=e=>l>0?(i[l]=e,i[--l]):e,a=e=>l<i.length-1?i[++l]:e,d=e=>{let t=i.slice(0,l+1);t.push(e),i=t,l++},s=e=>Object.values(e).find(e=>e.selected),c=(e,t)=>Object.values(e).filter(e=>e.depth===t).sort((e,t)=>e.y-t.y||e.x-t.x),u=(e,t,r)=>{let n=c(e,t.depth),i=n.findIndex(e=>e.id===t.id)+r;return i>=0&&i<n.length?n[i].id:t.id},h=(e,t)=>Object.values(e).filter(e=>e.parentId===t),f=(e,t)=>{let r=s(e);if(r)switch(t){case"up":case"down":return u(e,r,"up"===t?-1:1);case"left":return r.parentId??r.id;case"right":return h(e,r.id)[0]?.id??r.id;default:return r.id}};var m=r(829),p=r(8265),g=r(9499);let y=function(e,t,r,n,i){let l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"default";if((0,p.c)(`[layoutNode]「${e.texts}」 id=${e.id}, depth=${n}, startY=${r} ---`),null===e.parentId)(0,p.c)(`Root element: ${e.id}`);else{let r=t[e.parentId];"none"===r.direction?(e.direction&&"none"!==e.direction||(e.direction="right"),(0,p.c)(`Mindmap mode: direction=${e.direction} (explicit or default right)`)):e.direction!==r.direction&&(e.direction=r.direction),"left"===e.direction?e.x=r.x-e.width-m.e$.X:e.x=r.x+r.width+m.e$.X}let o=(0,g.i0)(e.id,t).sort((e,t)=>e.order-t.order);(0,p.c)(`children=${o.length}`);let a=r,d=r,s=r,c=r;if(!(o.length>0))return e.y=r,a=r+e.height,(0,p.c)(`[layoutNode](子要素なし)「${e.texts}」 id=${e.id}, y=${e.y}, newY=${a}`),{newY:a,leftMaxY:a,rightMaxY:a};{let r=m.SK.SECTION_HEIGHT*i();if(a+=Math.max((e.height-r)*.5,m.e$.Y),"mindmap"===l){let r=o.filter(e=>"left"===e.direction),u=o.filter(e=>"right"===e.direction),h=a,f=a;for(let e of r){let r=y(e,t,h,n+1,i,l);h=r.newY+m.e$.Y,s=Math.max(s,r.newY)}for(let e of u){let r=y(e,t,f,n+1,i,l);f=r.newY+m.e$.Y,c=Math.max(c,r.newY)}if(o.length>0){let t=o.filter(e=>void 0!==e.y);if(t.length>0){let r=t[0],n=t[t.length-1];e.y=(r.y+n.y+n.height)/2-e.height/2}}a=Math.max(d=Math.max(s,c),e.y+e.height)}else{for(let e of o){let r=y(e,t,a,n+1,i,l);a=r.newY+m.e$.Y,d=Math.max(d,r.newY)}let r=o[0],s=o[o.length-1];e.y=(r.y+s.y+s.height)/2-e.height/2,a=Math.max(d,e.y+e.height)}return(0,p.c)(`[layoutNode](子要素あり)「${e.texts}」 id=${e.id}, y=${e.y}, maxChildBottom=${d}, finalY=${a}`),{newY:a,leftMaxY:s,rightMaxY:c}}},b=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"default",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;(0,p.c)(`adjustElementPositions開始: 要素数=${Object.keys(e).length}, モード=${r}`);let l={...e},o=(0,g.i0)(null,l).sort((e,t)=>e.order-t.order),a=m.OS.Y;if("mindmap"===r&&1===o.length){let e=o[0];e.direction="none";let d=n>0?n/2-e.width/2:m.OS.X,s=i>0?i/2-e.height/2:m.OS.Y;e.x=d+m.e$.X,e.y=s,a=y(e,l,s,0,t,r).newY+m.e$.Y}else for(let e of o)a=y(e,l,a,0,t,r).newY+m.e$.Y;return(0,p.c)(`adjustElementPositions終了`),l};var E=r(5439),v=r(621),O=r(1050),I=r(3346);let S=(e,t,r,n)=>{let i;i=n?.direction?n.direction:"none"===t.direction?"right":t.direction;let l=(0,O.N3)({parentId:t.id,order:n?.order??t.children,depth:t.depth+1,numSections:n?.numberOfSections,direction:i});r&&(l.texts[0]=r),n?.newElementSelect!==void 0&&(l.selected=n.newElementSelect,l.editing=n.newElementSelect),n?.tentative!==void 0&&(l.tentative=n.tentative);let o={...t,children:t.children+1,selected:!n?.newElementSelect&&t.selected};return{...e,[t.id]:o,[l.id]:l}},w=(e,t,r)=>{let n=t.parentId,i=Object.values(e).filter(e=>e.parentId===n),l=t.order+1,o={...e};i.forEach(e=>{e.order>=l&&(o[e.id]={...e,order:e.order+1})});let a=t.direction,d=(0,O.N3)({parentId:n,order:l,depth:t.depth,numSections:r,direction:a});if(o[t.id]={...t,selected:!1},o[d.id]=d,null!==n){let e=o[n];o[n]={...e,children:e.children+1}}return o},x=(e,t,r)=>{if(!t)return e;let n=Object.values(t).find(e=>null===e.parentId);if(!n)return{...e,...t};let i=n.depth,l=r.depth+1-i,o=new Map,a={};Object.values(t).forEach(e=>{let t=(0,v.A)();o.set(e.id,t);let n=e.depth+l;a[t]={...e,id:t,depth:n,parentId:null===e.parentId?r.id:o.get(e.parentId),order:null===e.parentId?r.children:e.order}});let d=o.get(n.id)||n.id;a[d]&&(a[d].selected=!0);let s={...r,children:r.children+1,selected:!1};return{...e,...a,[r.id]:s}},C=function(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o={...e},a={...t},d=a.children,s=n?.direction||"right";return r.forEach((e,t)=>{o=S(o,a,e,{newElementSelect:!1,tentative:n.tentative??!1,order:d+t,numberOfSections:n.numberOfSections,direction:s})}),o[a.id]={...a,children:d+r.length},Object.values(o).forEach(e=>{if(e.parentId===a.id){let t=(0,I.PC)(e.texts,m.rF.HORIZONTAL),r=e.texts.map(e=>{let r=(0,I.C1)(e||"",t,n.zoomRatio).length;return Math.max(m.SK.SECTION_HEIGHT*n.zoomRatio,r*m.gI*m.RZ+m.rF.VERTICAL*n.zoomRatio)});o[e.id]={...e,width:t,height:r.reduce((e,t)=>e+t,0),sectionHeights:r}}}),b(o,()=>n.numberOfSections,n.layoutMode||"mindmap",i,l)},T=(e,t,r)=>e[t]?{...e,[t]:{...e[t],...r}}:e,N=(e,t)=>{let r={...e};return Object.entries(t).forEach(e=>{let[t,n]=e;r[t]&&(r[t]={...r[t],...n})}),r},k=(e,t,r)=>{let n={...e};return Object.entries(n).forEach(e=>{let[i,l]=e;t(l)&&(n[i]={...l,...r})}),n},M=(e,t)=>{let r=t(e.elements),n=e.layoutMode||"mindmap",i=e.width||0,l=e.height||0;return{...e,elements:b(r,()=>e.numberOfSections,n,i,l)}},A=e=>(t,r)=>{if(!r.payload)return t;let{id:n}=r.payload,i=r.payload[e];return{...t,elements:T(t.elements,n,{[e]:i})}},j=e=>"object"==typeof e&&null!==e&&"id"in e&&"string"==typeof e.id,R={elements:{1:{...(0,g.N3)(),id:"1",x:m.OS.X,y:m.OS.Y,editing:!1}},width:window.innerWidth,height:window.innerHeight,zoomRatio:1,numberOfSections:m.zX};function L(e){return t=>{let r=Object.values(t.elements).filter(e=>e.selected);if(r.length>1){let e=r[0].id,n=Object.values(t.elements).reduce((t,r)=>(t[r.id]={...r,selected:r.id===e,editing:r.id===e&&r.editing},t),{});return{...t,elements:n}}let n=e(t.elements);return{...t,elements:Object.values(t.elements).reduce((e,t)=>(e[t.id]={...t,selected:t.id===n},e),{})}}}function _(e,t){let r=Object.values(e.elements).find(e=>e.selected);if(!r)return e;d(e.elements);let n=t(e.elements,r);return"elements"in n?{...e,elements:n.elements}:{...e,elements:n}}let $=(e,t)=>(r,n)=>n.payload&&e(n.payload)?t(r,n.payload):((0,p.c)(`Invalid payload for action ${n.type}:`,n.payload),r),P=e=>t=>e(t),D={ZOOM_IN:P(e=>({...e,zoomRatio:e.zoomRatio+.1})),ZOOM_OUT:P(e=>({...e,zoomRatio:Math.max(e.zoomRatio-.1,.1)})),ARROW_UP:P(L(e=>f(e,"up"))),ARROW_DOWN:P(L(e=>f(e,"down"))),ARROW_RIGHT:P(L(e=>f(e,"right"))),ARROW_LEFT:P(L(e=>f(e,"left"))),LOAD_ELEMENTS:$(e=>"object"==typeof e&&null!==e&&Object.values(e).every(e=>"object"==typeof e&&null!==e&&"id"in e&&"string"==typeof e.id),(e,t)=>{if(0===Object.keys(t).length)return(0,p.c)("Loading empty elements map, returning initial state"),R;let r=Object.values(t).reduce((e,t)=>(t.id?e[t.id]=null===t.parentId?{...t,visible:!0}:t:(0,p.c)("Skipping invalid element without id:",t),e),{});return M(e,()=>r)}),SELECT_ELEMENT:$(e=>"object"==typeof e&&null!==e&&"id"in e&&"string"==typeof e.id,(e,t)=>{let{id:r,ctrlKey:n=!1,shiftKey:i=!1}=t,l=e.elements[r];if(!l)return(0,p.c)(`Element with id ${r} not found`),e;let o=Object.values(e.elements).filter(e=>e.selected),a=o[0];if((i||n)&&o.length>0&&o.some(e=>e.parentId!==l.parentId))return e;let d=[];if(i&&o.length>0){let t=a.parentId,n=Object.values(e.elements).filter(e=>e.parentId===t).sort((e,t)=>e.order-t.order),i=n.findIndex(e=>e.id===a.id),l=n.findIndex(e=>e.id===r),[o,s]=[Math.min(i,l),Math.max(i,l)];d=n.slice(o,s+1).map(e=>e.id)}else d=n?o.some(e=>e.id===r)?o.filter(e=>e.id!==r).map(e=>e.id):[...o.map(e=>e.id),r]:[r];let s=l.parentId,c=d.filter(t=>{let r=e.elements[t];return r&&r.parentId===s}),u=k(e.elements,()=>!0,{selected:!1,editing:!1});return u=k(u,e=>c.includes(e.id),{selected:!0}),{...e,elements:u}}),DESELECT_ALL:P(e=>({...e,elements:k(e.elements,()=>!0,{selected:!1,editing:!1})})),UPDATE_TEXT:(n=(e,t)=>{let{index:r,value:n}=t;return{texts:e.texts.map((e,t)=>t===r?n:e)}},(e,t)=>{if(!t.payload)return e;let{id:r}=t.payload,i=e.elements[r];return i?{...e,elements:T(e.elements,r,n(i,t.payload))}:e}),UPDATE_START_MARKER:A("startMarker"),UPDATE_END_MARKER:A("endMarker"),UPDATE_CONNECTION_PATH_TYPE:$(j,(e,t)=>{let{id:r,connectionPathType:n}=t;return n?{...e,elements:T(e.elements,r,{startMarker:n,connectionPathType:n})}:((0,p.c)("connectionPathType is missing in payload"),e)}),UPDATE_END_CONNECTION_PATH_TYPE:$(j,(e,t)=>{let{id:r,endConnectionPathType:n}=t;return n?{...e,elements:T(e.elements,r,{endMarker:n,endConnectionPathType:n})}:((0,p.c)("endConnectionPathType is missing in payload"),e)}),EDIT_ELEMENT:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(r,n)=>{let i=Object.values(r.elements).filter(e=>e.selected);if(0===i.length)return r;let l=i.reduce((t,r)=>(t[r.id]=e(r,n?.payload),t),{}),o=N(r.elements,l);if(!t)return{...r,elements:o};{let e=r.layoutMode||"default",t=r.width||0,n=r.height||0;return{...r,elements:b(o,()=>r.numberOfSections,e,t,n)}}}}(e=>({editing:!0}),!1),END_EDITING:e=>M(e,()=>k(e.elements,()=>!0,{editing:!1})),MOVE_ELEMENT:$(e=>"object"==typeof e&&null!==e&&"id"in e&&"x"in e&&"y"in e&&"string"==typeof e.id&&"number"==typeof e.x&&"number"==typeof e.y,(e,t)=>{let{id:r,x:n,y:i}=t,l=Object.values(e.elements).filter(e=>e.selected);if(!e.elements[r])return(0,p.c)(`Element with id ${r} not found for move operation`),e;if(l.length>1&&l.some(e=>e.id===r)){let t=n-e.elements[r].x,o=i-e.elements[r].y,a=l.reduce((e,r)=>(e[r.id]={x:r.x+t,y:r.y+o},e),{});return{...e,elements:N(e.elements,a)}}return{...e,elements:T(e.elements,r,{x:n,y:i})}}),UPDATE_ELEMENT_SIZE:$(e=>"object"==typeof e&&null!==e&&"id"in e&&"width"in e&&"height"in e&&"sectionHeights"in e&&"string"==typeof e.id&&"number"==typeof e.width&&"number"==typeof e.height&&Array.isArray(e.sectionHeights),(e,t)=>{let{id:r,width:n,height:i,sectionHeights:l}=t;if(!e.elements[r])return(0,p.c)(`Element with id ${r} not found for size update`),e;if(n<=0||i<=0)return(0,p.c)(`Invalid size values: width=${n}, height=${i}`),e;let o=T(e.elements,r,{width:n,height:i,sectionHeights:l});return M(e,()=>o)}),ADD_ELEMENT:$(e=>null==e||"object"==typeof e&&null!==e&&(!("text"in e)||"string"==typeof e.text),(e,t)=>_(e,(r,n)=>({elements:b(S(r,n,t?.text,{newElementSelect:!0,numberOfSections:e.numberOfSections}),()=>e.numberOfSections,e.layoutMode,e.width||0,e.height||0)}))),ADD_ELEMENTS_SILENT:$(e=>null==e||"object"==typeof e&&null!==e&&(!("texts"in e)||Array.isArray(e.texts))&&(!("tentative"in e)||"boolean"==typeof e.tentative),(e,t)=>_(e,(r,n)=>{let i=t?.texts||[];return{elements:C(r,n,i,{tentative:t?.tentative||!1,numberOfSections:e.numberOfSections,zoomRatio:e.zoomRatio,layoutMode:e.layoutMode},e.width||0,e.height||0)}})),ADD_SIBLING_ELEMENT:e=>_(e,(t,r)=>({elements:b(w(t,r,e.numberOfSections),()=>e.numberOfSections,e.layoutMode||"default",e.width||0,e.height||0)})),DELETE_ELEMENT:e=>{let t=Object.values(e.elements).filter(e=>e.selected);if(0===t.length)return e;(0,p.c)(`DELETE_ELEMENT開始: 削除対象要素数=${t.length}`);let r={...e.elements},n=(()=>{let e=t[0],n=Object.values(r).filter(t=>t.parentId===e.parentId&&!t.selected).sort((e,t)=>e.order-t.order),i=n.filter(t=>t.order<e.order).pop(),l=n.find(t=>t.order>e.order);return i?.id||l?.id||e.parentId})();t.forEach(e=>{r=(0,g.mP)(r,e)}),Object.values(r).forEach(e=>{null===e.parentId&&(e.y=m.OS.Y)});let i=k(r,e=>e.id===n,{selected:!0});return M(e,()=>i)},CONFIRM_TENTATIVE_ELEMENTS:(e,t)=>({...e,elements:k(e.elements,e=>e.parentId===t.payload&&e.tentative,{tentative:!1})}),CANCEL_TENTATIVE_ELEMENTS:(e,t)=>{if(!t.payload)return e;let r=Array.from(new Set(Object.values(e.elements).filter(e=>e.tentative&&e.parentId===t.payload).map(e=>e.parentId).filter(e=>null!==e))),n=Object.values(e.elements).reduce((e,r)=>(r.tentative&&r.parentId===t.payload||(e[r.id]=r),e),{}),i=r.reduce((e,t)=>{if(e[t]){let r=Object.values(e).filter(e=>e.parentId===t&&!e.tentative).length;e[t]={...e[t],children:r}}return e},n);return M(e,()=>i)},UNDO:e=>M(e,()=>o(e.elements)),REDO:e=>M(e,()=>a(e.elements)),SNAPSHOT:e=>(d(e.elements),e),DROP_ELEMENT:$(e=>"object"==typeof e&&null!==e&&"id"in e&&"newOrder"in e&&"depth"in e&&"string"==typeof e.id&&"number"==typeof e.newOrder&&"number"==typeof e.depth,(e,t)=>{let{id:r,oldParentId:n,newParentId:i,newOrder:l,depth:o,direction:a}=t;if(!e.elements[r])return(0,p.c)(`Element with id ${r} not found for drop operation`),e;if(r===i||i&&(0,g.K9)(e.elements,r,i))return(0,p.c)("Invalid drop operation: circular reference detected"),e;if(l<0||o<0)return(0,p.c)(`Invalid drop values: newOrder=${l}, depth=${o}`),e;let d={...e.elements},s=d[r],c=n?d[n]:null,u=i?d[i]:null,h=n===i;!h&&c&&n&&(d[n]={...c,children:Math.max(0,c.children-1)},Object.values(d).filter(e=>e.parentId===n&&e.id!==r).sort((e,t)=>e.order-t.order).forEach((e,t)=>{e.order!==t&&(d[e.id]={...e,order:t})})),d[r]={...s,parentId:i,depth:o,order:l,...void 0!==a&&{direction:a}};let f=Object.values(d).filter(e=>e.parentId===i&&e.id!==r);return f.sort((e,t)=>e.order-t.order),f.forEach((e,t)=>{let r=t>=l?t+1:t;e.order!==r&&(d[e.id]={...e,order:r})}),!h&&u&&i&&(d[i]={...u,children:u.children+1}),h||(d=(0,g.wJ)(d,d[r])),M(e,()=>d)}),CUT_ELEMENT:e=>{let t=Object.values(e.elements).filter(e=>e.selected);if(0===t.length)return e;let r={},n={...e.elements};return t.forEach(e=>{let t=(0,E.mY)(n,e);Object.keys(t).forEach(e=>{t[e]&&(t[e]={...t[e],selected:!1})}),r={...r,...t},n=(0,g.mP)(n,e)}),(0,E.lW)(r),{...e,elements:n}},COPY_ELEMENT:e=>(function(e,t){let r=Object.values(e.elements).find(e=>e.selected);return r?{...e,...t(r)}:e})(e,t=>{let r=(0,E.mY)(e.elements,t),n={};return Object.keys(r).forEach(e=>{n[e]={...r[e],selected:!1}}),(0,E.lW)(n),{}}),PASTE_ELEMENT:e=>{if(1!==Object.values(e.elements).filter(e=>e.selected).length)return e;let t=(0,E.Lt)();return t?_(e,(r,n)=>({elements:b(x(r,t,n),()=>e.numberOfSections,e.layoutMode||"default",e.width||0,e.height||0)})):e},EXPAND_ELEMENT:e=>_(e,(t,r)=>({elements:b((0,g.nP)(t,r,!0),()=>e.numberOfSections,e.layoutMode||"default",e.width||0,e.height||0)})),COLLAPSE_ELEMENT:e=>_(e,(t,r)=>({elements:b((0,g.nP)(t,r,!1),()=>e.numberOfSections,e.layoutMode||"default",e.width||0,e.height||0)}))},H=(e,t)=>{try{let r=D[t.type];if(!r)return(0,p.c)(`Unknown action type: ${t.type}`),e;let n=r(e,t);if(!n||"object"!=typeof n)return(0,p.c)(`Invalid state returned for action ${t.type}`),e;if(!n.elements||"object"!=typeof n.elements)return(0,p.c)(`Invalid elements in state for action ${t.type}`),e;return n}catch(r){return(0,p.c)(`Error handling action ${t.type}:`,r),e}}},2135:(e,t,r)=>{function n(e){return"string"!=typeof e?"":e.replace(/data:[^,]*,/gi,",").replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<[^>]*>/g,"").replace(/eval\s*\([^)]*\)/gi,"").replace(/javascript:.*$/gi,"")}function i(e){if("string"!=typeof e)return"untitled";let t=e.replace(/<[^>]*>/g,"").replace(/[<>:"/\\|?*]/g,"");return(t=(t=t.split("").filter(e=>{let t=e.charCodeAt(0);return!(t>=0&&t<=31)&&!(t>=127&&t<=159)}).join("")).replace(/^\.+/,"").replace(/^(CON|PRN|AUX|NUL|COM[1-9]|LPT[1-9])$/i,"file").replace(/\.{2,}/g,".").replace(/\.+$/,"").trim())||"untitled"}function l(e){if(null==e)return e;if("string"==typeof e)return n(e);if("number"==typeof e||"boolean"==typeof e)return e;if(Array.isArray(e))return e.map(e=>l(e));if("object"==typeof e){let t={};for(let[r,i]of Object.entries(e))t[n(r)]=l(i);return t}return e}function o(e){return"string"==typeof e?e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/\bon\w+\s*=\s*[^>]*/gi,"").replace(/javascript:/gi,"").replace(/data:\s*[^;]*;base64/gi,"").replace(/expression\s*\([^)]*\)/gi,""):l(e)}r.d(t,{Nz:()=>i,Rq:()=>o,Zm:()=>l,jZ:()=>n})},3346:(e,t,r)=>{r.d(t,{C1:()=>a,PC:()=>o});var n=r(829);let i=()=>{let e=document.createElement("canvas").getContext("2d");return e.font=`${n.gI}px ${n.zs}`,e},l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=i();return Math.ceil(e.split("\n").reduce((e,n)=>Math.max(e,r.measureText(n).width+2*t),0))},o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=e.reduce((e,r)=>Math.max(e,l(r||"",t)),0);return Math.min(n.SK.WIDTH.MAX,Math.max(n.SK.WIDTH.MIN,r))},a=function(e,t){arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.mU;let r=i(),l=e.split("\n"),o=[];return l.forEach(e=>{if(""===e.trim()){o.push("");return}let n="",i=0;for(let l of e.split(/(\s+)/).filter(e=>""!==e)){let e=r.measureText(l).width;if(i+e>t){if(""!==n&&(o.push(n),n="",i=0),e>t)for(let e of l){let l=r.measureText(e).width;i+l>t&&(o.push(n),n="",i=0),n+=e,i+=l}else n=l,i=e}else n+=l,i+=e}""!==n&&o.push(n)}),o}},5439:(e,t,r)=>{r.d(t,{Lt:()=>o,lW:()=>l,mY:()=>i});var n=r(6323);let i=(e,t)=>{let r={},n=Object.values(e),i={...t,parentId:null};r[i.id]=i;let l=e=>{n.filter(t=>t.parentId===e).forEach(e=>{let t={...e};r[t.id]=t,l(e.id)})};return l(t.id),r},l=e=>{(0,n.i0)(JSON.stringify(e));let t=function(r){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=Object.values(e).filter(e=>e.parentId===r.id).map(e=>t(e,n+1)),l="	".repeat(n);return`${l}${r.texts[0]}
${i.join("")}`},r=Object.values(e).find(e=>e.selected);if(!r)return;let i=t(r);if(navigator.clipboard&&window.isSecureContext)navigator.clipboard.writeText(i).then(()=>{console.log("Copied to clipboard:",i)}).catch(e=>{console.error("Failed to copy to clipboard:",e)});else{let e=document.createElement("textarea");e.value=i,document.body.appendChild(e),e.focus(),e.select();try{document.execCommand("copy"),console.log("Copied to clipboard:",i)}catch(e){console.error("Failed to copy to clipboard:",e)}document.body.removeChild(e)}},o=()=>{let e=(0,n.Oo)();if(!e)return null;try{return JSON.parse(e)}catch(e){return console.error("Failed to parse cut elements:",e),null}}},6323:(e,t,r)=>{r.d(t,{G6:()=>et,CG:()=>X,Es:()=>Y,ZF:()=>P,S4:()=>H,Oo:()=>er,kN:()=>T,af:()=>R,zn:()=>_,OA:()=>Q,XH:()=>B,N4:()=>W,_1:()=>k,xo:()=>A,k0:()=>Z,EN:()=>ei,vG:()=>F,wt:()=>G,QY:()=>K,xN:()=>D,K2:()=>z,i0:()=>en,qu:()=>N,Yu:()=>L,li:()=>$,Iz:()=>ee,bJ:()=>q,LL:()=>J,JT:()=>M,Jg:()=>j,mF:()=>V,AN:()=>el,vY:()=>U});var n=r(829),i=r(831);let l="1.01";var o=r(2135),a=r(573);let d={canvasBackgroundColor:n.i_,connectionPathColor:n.BH,elementColor:n.iC.NORMAL.COLOR,fontFamily:n.zs,markerType:n.qn,strokeColor:n.iC.NORMAL.STROKE_COLOR,strokeWidth:n.iC.STROKE_WIDTH,textColor:n._K,connectionPathStroke:n._o,selectedStrokeColor:n.iC.SELECTED.STROKE_COLOR},s="styles",c="encryptionKey",u="tabsState",h="appVersion",f="prompt",m="systemPromptTemplate",p="apiKey",g="modelType",y="cutElements",b={"gemini-1.5-flash":"https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent","gemini-2.0-flash":"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent"},E=async()=>await Promise.all([r.e(109),r.e(477)]).then(r.t.bind(r,2109,23)),v=async e=>{try{let t=await E();if(!t)return null;return e(t)}catch(e){return console.error("CryptoJS load failed:",e),null}},O={getItem:e=>{try{let t=localStorage.getItem(e);if(null===t)return null;if(t.length>1048576)return console.warn(`LocalStorage値が大きすぎます: ${e}`),null;return t}catch(e){return console.error("localStorage access failed:",e),null}},setItem:(e,t)=>{if(!e||"string"!=typeof e||0===e.trim().length){console.error("無効なlocalStorageキー:",e);return}if("string"!=typeof t){console.error("localStorageの値は文字列である必要があります");return}if(t.length>1048576){console.error("localStorageの値が大きすぎます");return}try{localStorage.setItem(e,t)}catch(e){console.error("localStorage access failed:",e)}},removeItem:e=>{try{localStorage.removeItem(e)}catch(e){console.error("localStorage access failed:",e)}}};O.getItem(h)!==l&&(Object.keys(localStorage).forEach(e=>{e!==u&&e!==p&&e!==f&&O.removeItem(e)}),O.setItem(h,l)),O.removeItem("numberOfSections");let I=(e,t)=>{let r=O.getItem(e);if(!r)return t;if("string"==typeof t)return(0,o.jZ)(r);if("number"==typeof t){let e=Number(r);return isNaN(e)?t:e}return r},S=(e,t)=>{if(null==t)return;if(!(0,a.IK)(e,t)){console.warn(`設定値が無効です: ${e} = ${t}`);return}let r=t;"string"==typeof t&&e!==p&&(r=(0,o.jZ)(t)),O.setItem(e,String(r))},w=()=>{let e=O.getItem(s);if(!e){let e=C();return e.selectedStrokeColor||(e.selectedStrokeColor=n.iC.SELECTED.STROKE_COLOR,O.setItem(s,JSON.stringify(e))),e}try{let t=JSON.parse(e);return t.selectedStrokeColor||(t.selectedStrokeColor=n.iC.SELECTED.STROKE_COLOR,O.setItem(s,JSON.stringify(t))),{...d,...t}}catch(e){return console.error("Failed to parse styles:",e),d}},x=e=>{let t={...w(),...e};O.setItem(s,JSON.stringify(t))},C=()=>{let e={...d},t=!1;return["canvasBackgroundColor","connectionPathColor","elementColor","fontFamily","markerType","strokeColor","strokeWidth","textColor","connectionPathStroke","selectedStrokeColor"].forEach(r=>{let n=O.getItem(r);null!==n&&(t=!0,"strokeWidth"===r||"connectionPathStroke"===r?e[r]=parseFloat(n):e[r]=n,O.removeItem(r))}),t&&O.setItem(s,JSON.stringify(e)),e},T=()=>w().elementColor,N=e=>x({elementColor:e}),k=()=>w().strokeColor,M=e=>x({strokeColor:e}),A=()=>w().strokeWidth,j=e=>x({strokeWidth:e}),R=()=>w().fontFamily,L=e=>x({fontFamily:e}),_=()=>w().markerType,$=e=>x({markerType:e}),P=()=>w().connectionPathColor,D=e=>x({connectionPathColor:e}),H=()=>w().connectionPathStroke,z=e=>x({connectionPathStroke:e}),Y=()=>w().canvasBackgroundColor,K=e=>x({canvasBackgroundColor:e}),F=()=>w().textColor,U=e=>x({textColor:e}),W=()=>w().selectedStrokeColor,J=e=>x({selectedStrokeColor:e}),X=async()=>await v(e=>{try{let t=O.getItem(p);if(!t)return"";return e.AES.decrypt(t,c).toString(e.enc.Utf8)}catch(e){return console.error("API key decryption failed:",e),""}})??"",G=async e=>{await v(t=>{try{let r=t.AES.encrypt(e,c).toString();O.setItem(p,r)}catch(e){console.error("API key encryption failed:",e)}})},B=()=>I(f,""),q=e=>S(f,e),Z=()=>I(m,i.U),V=e=>S(m,e),Q=()=>I(g,Object.keys(b)[0]),ee=e=>S(g,e),et=()=>b[Q()]||b["gemini-1.5-flash"],er=()=>O.getItem(y),en=e=>O.setItem(y,e),ei=()=>O.getItem(u),el=e=>O.setItem(u,e)},6497:(e,t,r)=>{r.d(t,{$r:()=>m,Fk:()=>d,Sz:()=>f,Wy:()=>u,re:()=>h,wl:()=>s});var n=r(829),i=r(9499),l=r(2135),o=r(573);let a=e=>"object"==typeof e&&null!==e&&("text"in e||"text2"in e||"text3"in e||"texts"in e&&"sectionHeights"in e),d=e=>{if(!a(e))return(0,i.N3)();if(e.texts&&e.sectionHeights){let t=(0,i.N3)(),r={...t,id:e.id||t.id,texts:e.texts,sectionHeights:e.sectionHeights,x:void 0!==e.x?Number(e.x):t.x,y:void 0!==e.y?Number(e.y):t.y,width:void 0!==e.width?Number(e.width):t.width,height:void 0!==e.height?Number(e.height):t.height,parentId:void 0!==e.parentId?e.parentId:t.parentId,order:void 0!==e.order?Number(e.order):t.order,depth:void 0!==e.depth?Number(e.depth):t.depth,children:void 0!==e.children?Number(e.children):t.children,editing:void 0!==e.editing?!!e.editing:t.editing,selected:void 0!==e.selected?!!e.selected:t.selected,visible:void 0!==e.visible?!!e.visible:t.visible,tentative:void 0!==e.tentative?!!e.tentative:t.tentative,startMarker:t.startMarker,endMarker:t.endMarker,direction:void 0!==e.direction?e.direction:null===e.parentId?"none":"right"};return e.connectionPathType?r.startMarker=e.connectionPathType:e.startMarker&&(r.startMarker=e.startMarker),e.endConnectionPathType?r.endMarker=e.endConnectionPathType:e.endMarker&&(r.endMarker=e.endMarker),r}let t=(0,i.N3)(),r={...t,id:e.id||t.id,texts:[e.text||"",e.text2||"",e.text3||""],sectionHeights:[e.section1Height||n.SK.SECTION_HEIGHT,e.section2Height||n.SK.SECTION_HEIGHT,e.section3Height||n.SK.SECTION_HEIGHT],x:void 0!==e.x?Number(e.x):0,y:void 0!==e.y?Number(e.y):0,width:void 0!==e.width?Number(e.width):t.width,height:void 0!==e.height?Number(e.height):t.height,parentId:void 0!==e.parentId?e.parentId:t.parentId,order:void 0!==e.order?Number(e.order):t.order,depth:void 0!==e.depth?Number(e.depth):t.depth,children:void 0!==e.children?Number(e.children):t.children,editing:void 0!==e.editing?!!e.editing:t.editing,selected:void 0!==e.selected?!!e.selected:t.selected,visible:void 0!==e.visible?!!e.visible:t.visible,tentative:void 0!==e.tentative?!!e.tentative:t.tentative,startMarker:t.startMarker,endMarker:t.endMarker,direction:void 0!==e.direction?e.direction:null===e.parentId?"none":"right"};return e.connectionPathType?r.startMarker=e.connectionPathType:e.startMarker&&(r.startMarker=e.startMarker),e.endConnectionPathType?r.endMarker=e.endConnectionPathType:e.endMarker&&(r.endMarker=e.endMarker),r},s=e=>new Promise((t,r)=>{let n=e.target,i=n.files?.[0];if(!i){r(Error("Error: ファイルが選択されていません"));return}let a=(0,l.Nz)(i.name);if(!a||"untitled"===a){r(Error("Error: 安全でないファイル名が検出されました"));return}let s=new FileReader;s.onload=e=>{try{let r=e.target?.result;if("string"!=typeof r)throw Error("Invalid file content");if(!(0,o.IU)(r))throw Error("ファイル内容が安全でない可能性があります");let n=JSON.parse(r);if(!(0,o.L5)(n))throw Error("JSONデータが安全でない可能性があります");let a=(0,l.Zm)(n),s=[];if(Array.isArray(a))s=a;else if("object"==typeof a&&null!==a)s="elements"in a?Object.values(a.elements):Object.values(a);else throw Error("Invalid data format");let c=s.filter(e=>!!(e.id||Object.prototype.hasOwnProperty.call(e,"id"))||(console.warn("IDが欠けている要素を削除します"),!1)).map(e=>d(e)),u=new Set(c.map(e=>e.id)),h=c.filter(e=>!e.parentId||!!u.has(e.parentId)||(console.warn(`存在しないparentId "${e.parentId}" を参照している要素 "${e.id}" を削除します`),!1)).reduce((e,t)=>(e[t.id]=t,e),{});t({elements:h,fileName:i.name})}catch(e){console.error("ファイル読み込みエラー:",e),r(Error(`Error: ファイルの読み込みに失敗しました - ${e instanceof Error?e.message:String(e)}`))}},s.onerror=()=>{console.error("ファイル読み込みエラー"),r(Error("Error: ファイルの読み込みに失敗しました"))},s.readAsText(i),n.value=""}),c=e=>{if(!e.querySelector("foreignObject div"))return;let t=e.querySelector('g:not([data-exclude-from-export="true"])');if(t)return t.querySelector("foreignObject div")?.textContent||void 0},u=e=>{if(0===e.length)return;let t=e.find(e=>!e.parentId);if(t&&t.texts&&t.texts.length>0){let e=t.texts[0];return e&&"string"==typeof e?e:void 0}},h=(e,t)=>{let r=e||"Untitled";if(("Untitled"===r||"無題"===r)&&t){let e=t.trim();e&&(r=e.substring(0,30).replace(/[\\/:*?"<>|]/g,"_"))}return r},f=(e,t)=>{let r=e.cloneNode(!0);r.setAttribute("xmlns","http://www.w3.org/2000/svg"),r.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");let i=e.getAttribute("viewBox");i&&r.setAttribute("viewBox",i);let l=e.getAttribute("width")||e.clientWidth.toString(),o=e.getAttribute("height")||e.clientHeight.toString();r.setAttribute("width",l),r.setAttribute("height",o);let a=document.createElementNS("http://www.w3.org/2000/svg","rect");a.setAttribute("width","100%"),a.setAttribute("height","100%"),a.setAttribute("fill",n.i_),r.insertBefore(a,r.firstChild),r.querySelectorAll('[data-exclude-from-export="true"]').forEach(e=>e.parentNode?.removeChild(e)),r.querySelectorAll('rect[stroke="'+n.iC.SELECTED.STROKE_COLOR+'"]').forEach(e=>{e.getAttribute("height")!==e.getAttribute("width")&&(e.setAttribute("stroke",n.iC.NORMAL.STROKE_COLOR),e.removeAttribute("filter"),e.setAttribute("style",e.getAttribute("style")?.replace(/filter:[^;]+;?/,"")||""))}),r.querySelectorAll("foreignObject div").forEach(e=>{let t=e.getAttribute("style")||"",r=`
            ${t}
            font-family: ${n.zs};
            font-size: ${n.gI}px;
            color: ${n._K};
            white-space: pre-wrap;
            word-break: break-word;
            user-select: text;
        `;e.setAttribute("style",r)}),r.querySelectorAll('line[stroke="'+n.iC.SELECTED.STROKE_COLOR+'"]').forEach(e=>{e.setAttribute("stroke",n.iC.NORMAL.STROKE_COLOR)});let d=document.createElementNS("http://www.w3.org/2000/svg","style");d.textContent=`
        text { font-family: ${n.zs}; font-size: ${n.gI}px; }
        foreignObject div { font-family: ${n.zs}; font-size: ${n.gI}px; }
    `,r.appendChild(d),r.setAttribute("style","user-select: text;"),r.setAttribute("text-rendering","optimizeLegibility");let s=new Blob(['<?xml version="1.0" standalone="no"?>\r\n',new XMLSerializer().serializeToString(r)],{type:"image/svg+xml;charset=utf-8"}),u=URL.createObjectURL(s),f=h(t,c(e)),m=document.createElement("a");m.href=u,m.download=f,document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(u)},m=(e,t)=>{let r=h(t,u(e)),n=new Blob([JSON.stringify(e.map(e=>{let{x:t,y:r,...n}=e;return n}))],{type:"application/json"}),i=URL.createObjectURL(n),l=document.createElement("a");l.href=i,l.download=`${r}.json`,document.body.appendChild(l),l.click(),document.body.removeChild(l)}},7242:(e,t,r)=>{r.d(t,{O:()=>p,u:()=>g});var n=r(5155),i=r(2115),l=r(1231),o=r(621),a=r(829),d=r(9499),s=r(6497),c=r(6323);let u=(0,i.createContext)(void 0),h=e=>{let t=e??a.zX,r="default",n={1:{...(0,d.N3)({numSections:t}),id:"1",x:a.OS.X,y:a.OS.Y,editing:!1}};return{id:(0,o.A)(),name:"無題",isSaved:!1,lastSavedElements:JSON.stringify(n),state:{...l.u,numberOfSections:t,elements:n,layoutMode:r},layoutMode:r}},f=()=>{try{let e=(0,c.EN)();if(e){let t=JSON.parse(e);if(Array.isArray(t?.tabs)&&"string"==typeof t?.currentTabId){let e=t.tabs.map(e=>({...e,layoutMode:e.layoutMode||"default",state:{...e.state,elements:Object.fromEntries(Object.entries(e.state.elements).map(e=>{let[t,r]=e;return[t,(0,s.Fk)(r)]}))}})),r=e.some(e=>e.id===t.currentTabId)?t.currentTabId:e[0]?.id||"";return{tabs:e,currentTabId:r}}}}catch(e){}let e=h();return{tabs:[e],currentTabId:e.id}},m=(e,t)=>{(0,c.AN)(JSON.stringify({tabs:e,currentTabId:t}))},p=e=>{let{children:t}=e,[r,l]=(0,i.useState)(()=>f()),{tabs:o,currentTabId:d}=r;(0,i.useEffect)(()=>{m(o,d)},[o,d]);let s=(0,i.useCallback)(()=>{let e=o.find(e=>e.id===d),t=h(e?.state.numberOfSections??a.zX);return l(e=>({tabs:[...e.tabs,t],currentTabId:t.id})),t.id},[o,d]),c=(0,i.useCallback)(e=>{l(t=>{if(1===t.tabs.length)return t;let r=t.tabs.filter(t=>t.id!==e),n=e===t.currentTabId?r[0]?.id||"":t.currentTabId;return{tabs:r,currentTabId:n}})},[]),p=(0,i.useCallback)(e=>{l(t=>{if(!t.tabs.find(t=>t.id===e))return t;let r=t.tabs.map(t=>t.id===e?{...t,state:{...t.state,layoutMode:t.layoutMode}}:t);return{...t,currentTabId:e,tabs:r}})},[]),g=(0,i.useCallback)((e,t)=>{l(r=>{let n=r.tabs.map(r=>{if(r.id===e){let e=t(r.state),n=JSON.stringify(JSON.parse(JSON.stringify(e.elements))),i=r.lastSavedElements!==n;return{...r,state:e,isSaved:!i}}return r});return{...r,tabs:n}})},[]),y=(0,i.useCallback)((e,t)=>{l(r=>({...r,tabs:r.tabs.map(r=>r.id===e?{...r,name:t}:r)}))},[]),b=(0,i.useCallback)((e,t,r)=>{l(n=>{let i=n.tabs.map(n=>n.id===e?{...n,isSaved:t,lastSavedElements:r||n.lastSavedElements}:n);return{...n,tabs:i}})},[]),E=(0,i.useCallback)(()=>{let e=o.find(e=>e.id===d);return e?.state},[o,d]),v=(0,i.useCallback)(()=>{let e=o.find(e=>e.id===d);return e?.state.numberOfSections??a.zX},[o,d]),O=(0,i.useCallback)(e=>{let t=Math.max(1,Math.min(10,e));g(d,e=>({...e,numberOfSections:t}))},[d,g]),I=(0,i.useCallback)(()=>{let e=o.find(e=>e.id===d);return e?.layoutMode||"default"},[o,d]),S=(0,i.useCallback)(e=>{l(t=>({...t,tabs:t.tabs.map(t=>t.id===d?{...t,layoutMode:e,state:{...t.state,layoutMode:e}}:t)}))},[d]),w=(0,i.useMemo)(()=>({tabs:o,currentTabId:d,addTab:s,closeTab:c,switchTab:p,updateTabState:g,updateTabName:y,updateTabSaveStatus:b,getCurrentTabState:E,getCurrentTabNumberOfSections:v,updateCurrentTabNumberOfSections:O,getCurrentTabLayoutMode:I,updateCurrentTabLayoutMode:S}),[o,d,s,c,p,g,y,b,E,v,O,I,S]);return(0,n.jsx)(u.Provider,{value:w,children:t})},g=()=>{let e=(0,i.useContext)(u);if(!e)throw Error("useTabs must be used within a TabsProvider");return e}},7451:(e,t,r)=>{r.d(t,{d:()=>a,t:()=>o});var n=r(5155),i=r(2115);let l=(0,i.createContext)(null),o=e=>{let{children:t}=e,[r,o]=(0,i.useState)([]),a=(0,i.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",r=new Date().getTime().toString()+Math.random().toString(),n={id:r,message:e,type:t};o(e=>{let t=[...e,n];return t.length>5&&t.shift(),t}),setTimeout(()=>{o(e=>e.filter(e=>e.id!==r))},3e3)},[]),d=e=>{switch(e){case"info":default:return{backgroundColor:"rgba(76, 175, 80, 0.9)",color:"white"};case"warn":return{backgroundColor:"rgba(255, 193, 7, 0.9)",color:"black"};case"error":return{backgroundColor:"rgba(244, 67, 54, 0.9)",color:"white"}}};return(0,n.jsxs)(l.Provider,{value:{addToast:a},children:[t,(0,n.jsx)("div",{style:{position:"fixed",bottom:"20px",left:"50%",transform:"translateX(-50%)",zIndex:1e3,pointerEvents:"none"},children:r.map(e=>(0,n.jsx)("div",{style:{...d(e.type),padding:"10px 20px",borderRadius:"10px",marginBottom:"10px",transition:"opacity 0.5s",opacity:1},children:e.message},e.id))})]})},a=()=>{let e=(0,i.useContext)(l);if(!e)throw Error("useToast must be used within a ToastProvider");return e}},8265:(e,t,r)=>{r.d(t,{c:()=>i,y:()=>n});let n=!1,i=(e,t)=>{n&&console.log(`[DEBUG] ${e}`,t)}},9499:(e,t,r)=>{r.d(t,{K9:()=>h,N3:()=>a,YV:()=>f,i0:()=>d,mP:()=>u,nP:()=>c,wJ:()=>s});var n=r(621),i=r(6323),l=r(829),o=r(8265);let a=function(){let{parentId:e=null,order:t=0,depth:r=1,numSections:o=l.zX,direction:a=null===e?"none":"right"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=(0,i.zn)();return{id:(0,n.A)(),texts:Array(o).fill(""),x:0,y:0,width:l.SK.WIDTH.MIN,height:l.SK.SECTION_HEIGHT*o,sectionHeights:Array(o).fill(l.SK.SECTION_HEIGHT),parentId:e,order:t,depth:r,children:0,editing:!0,selected:!0,visible:!0,tentative:!1,startMarker:d,endMarker:"none",direction:a}},d=(e,t)=>Object.values(t).filter(t=>t.parentId===e&&t.visible).sort((e,t)=>e.order-t.order),s=(e,t)=>{let r={...e},n={};Object.values(r).forEach(e=>{let t=e.parentId;t&&(n[t]||(n[t]=[]),n[t].push(e))});let i=e=>{(n[e]||[]).forEach(t=>{r[t.id]={...t,depth:r[e].depth+1},i(t.id)})};return i(t.id),r},c=(e,t,r)=>{let n={...e},i={};Object.values(n).forEach(e=>{let t=e.parentId;t&&(i[t]||(i[t]=[]),i[t].push(e))});let l=e=>{(i[e]||[]).forEach(e=>{n[e.id]={...e,visible:r},l(e.id)})};return l(t.id),n},u=(e,t)=>{if(null===t.parentId)return e;(0,o.c)(`deleteElementRecursive: 削除開始 id=${t.id}, order=${t.order}, y=${t.y}`);let r={...e},n=r[t.parentId];if(!n)return r;let i={order:t.order,y:t.y,height:t.height};(0,o.c)(`削除要素の位置情報:`,i);let l=e=>{Object.values(r).filter(t=>t.parentId===e).forEach(e=>{(0,o.c)(`  子要素を削除: id=${e.id}, y=${e.y}`),delete r[e.id],l(e.id)})};delete r[t.id],l(t.id),r[n.id]={...n,children:n.children-1},(0,o.c)(`親要素を更新: id=${n.id}, children=${n.children-1}, y=${n.y}`);let a=Object.values(r).filter(e=>e.parentId===n.id).sort((e,t)=>e.order-t.order);return(0,o.c)(`兄弟要素の数: ${a.length}`),a.forEach((e,t)=>{e.order!==t&&((0,o.c)(`  兄弟要素のorder更新: id=${e.id}, old=${e.order}, new=${t}, y=${e.y}`),r[e.id]={...e,order:t})}),r},h=(e,t,r)=>{let n=r;for(;null!==n;){if(n===t)return!0;n=e[n]?.parentId??null}return!1},f=(e,t)=>{let r={};Object.values(e).forEach(e=>{r[e.id]={id:e.id,text:e.texts[0]||"",parentId:e.parentId,depth:e.depth}});let n=(e,i)=>Object.values(r).filter(t=>t.parentId===e).sort((e,t)=>e.depth-t.depth).flatMap(e=>{let r="  ".repeat(e.depth-1);return[`${r}- ${e.text}${e.id===t?" (selected)":""}`,...n(e.id,i+1)]});return n(null,0).join("\n")}}}]);
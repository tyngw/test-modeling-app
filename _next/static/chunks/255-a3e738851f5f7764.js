"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[255],{1386:(e,t,r)=>{r.d(t,{O:()=>p,u:()=>f});var l=r(5155),n=r(2115),i=r(6624),d=r(621),a=r(6924),o=r(4098),s=r(2226);let c=(0,n.createContext)(void 0),u=()=>({id:(0,d.A)(),name:"無題",state:{...i.ue,elements:{1:{...(0,i.N3)(),id:"1",x:a.OS.X,y:a.OS.Y,editing:!1}}}}),h=()=>{try{let e=(0,s.EN)();if(e){let t=JSON.parse(e);if(Array.isArray(t?.tabs)&&"string"==typeof t?.currentTabId){let e=t.tabs.map(e=>({...e,state:{...e.state,elements:Object.fromEntries(Object.entries(e.state.elements).map(e=>{let[t,r]=e;return[t,(0,o.Fk)(r)]}))}})),r=e.some(e=>e.id===t.currentTabId)?t.currentTabId:e[0]?.id||"";return{tabs:e,currentTabId:r}}}}catch(e){console.error("Failed to load tabs state:",e)}let e=u();return{tabs:[e],currentTabId:e.id}},m=(e,t)=>{(0,s.AN)(JSON.stringify({tabs:e,currentTabId:t}))},p=e=>{let{children:t}=e,[r,i]=(0,n.useState)(()=>h()),{tabs:d,currentTabId:a}=r;(0,n.useEffect)(()=>{m(d,a)},[d,a]);let o=(0,n.useCallback)(()=>{let e=u();i(t=>({tabs:[...t.tabs,e],currentTabId:e.id}))},[]),s=(0,n.useCallback)(e=>{i(t=>{if(1===t.tabs.length)return t;let r=t.tabs.filter(t=>t.id!==e),l=e===t.currentTabId?r[0]?.id||"":t.currentTabId;return{tabs:r,currentTabId:l}})},[]),p=(0,n.useCallback)(e=>{i(t=>({...t,currentTabId:e}))},[]),f=(0,n.useCallback)((e,t)=>{i(r=>({...r,tabs:r.tabs.map(r=>r.id===e?{...r,state:t(r.state)}:r)}))},[]),y=(0,n.useCallback)((e,t)=>{i(r=>({...r,tabs:r.tabs.map(r=>r.id===e?{...r,name:t}:r)}))},[]),g=(0,n.useMemo)(()=>({tabs:d,currentTabId:a,addTab:o,closeTab:s,switchTab:p,updateTabState:f,updateTabName:y}),[d,a,o,s,p,f,y]);return(0,l.jsx)(c.Provider,{value:g,children:t})},f=()=>{let e=(0,n.useContext)(c);if(!e)throw Error("useTabs must be used within a TabsProvider");return e}},2226:(e,t,r)=>{r.d(t,{G6:()=>I,CG:()=>g,X0:()=>f,XH:()=>b,k0:()=>$,EN:()=>T,Ar:()=>p,wt:()=>E,jE:()=>y,bJ:()=>O,mF:()=>x,AN:()=>v});var l=r(6924);let n=`
You are a highly skilled data analyst specializing in structuring information for systematic thinking. Your task is to extract and organize key elements from textual input to help users structure their thoughts in a hierarchical format. Follow the instructions below strictly to generate child elements that can be added directly under the user-selected element (marked as "selected"). The generated suggestions must be strictly based on the provided [Input Information], and no additional elements, interpretations, or assumptions should be made.

## [Task]
- First, analyze the [Input Information] and summarize as well as classify only the sentences that are directly related to the content of the selected element.
- Then, extract possible child elements from this summarized and categorized information that are relevant to the user-selected element.
- The suggestions must strictly come from the classified sentences in the [Input Information]. Do not include elements that already exist elsewhere in [Current Structure].
- Ensure that the newly suggested elements do not duplicate existing ones in other parts of the hierarchy.
- If the selected element is a structured entity such as "Two Challenges," generate exactly two child elements.
- If no reasonable child elements can be inferred from the [Input Information], return an empty output.

## [Requirements]
1. Carefully analyze and filter the [Input Information] to include only details directly related to the selected element.
2. Summarize and classify the relevant sentences from the [Input Information] before extracting potential child elements.
3. The output must be in a code block format, listing only element names, each on a new line.
4. Do not provide explanations, descriptions, or any additional natural language text.
5. Ensure logical consistency with the existing structure in [Current Structure].
6. Exclude elements that already exist elsewhere in [Current Structure].
7. Provide 3 to 5 appropriate suggestions unless the selected element specifies a fixed number (e.g., "Two Challenges" → exactly two suggestions).
8. If no valid elements can be determined, do not output any suggestions.
9. Do not create new elements or infer missing information.

## [Validation Rules]
Before suggesting an element, ensure that:
- It exists in [Input Information] (if not, discard it).
- It does not exist anywhere else in [Current Structure] (if found, discard it).

[Output Format]
The output must be in Japanese, formatted as follows:
\`\`\`
提案要素1
提案要素2
提案要素3
\`\`\`
[Current Structure]
\`\`\`
{{structureText}}
\`\`\`

[Input Information]
\`\`\`
{{inputText}}
\`\`\`
`.trim(),i="1.01",d="encryptionKey",a="tabsState",o="appVersion",s="prompt",c="systemPromptTemplate",u="apiKey",h=async()=>await Promise.all([r.e(109),r.e(477)]).then(r.t.bind(r,2109,23)),m=async e=>{try{let t=await h();if(!t)return null;return e(t)}catch(e){return console.error("CryptoJS load failed:",e),null}},p={getItem:e=>{try{return localStorage.getItem(e)}catch(e){return console.error("localStorage access failed:",e),null}},setItem:(e,t)=>{try{localStorage.setItem(e,t)}catch(e){console.error("localStorage access failed:",e)}},removeItem:e=>{try{localStorage.removeItem(e)}catch(e){console.error("localStorage access failed:",e)}}};p.getItem(o)!==i&&(Object.keys(localStorage).forEach(e=>{e!==a&&e!==u&&e!==s&&p.removeItem(e)}),p.setItem(o,i));let f=()=>{let e=p.getItem("numberOfSections");return e&&parseInt(e,10)||l.zX},y=e=>{let t=Math.max(1,Math.min(10,e));p.setItem("numberOfSections",t.toString())},g=async()=>await m(e=>{try{let t=p.getItem(u);if(!t)return"";return e.AES.decrypt(t,d).toString(e.enc.Utf8)}catch(e){return console.error("API key decryption failed:",e),""}})??"",E=async e=>{await m(t=>{try{let r=t.AES.encrypt(e,d).toString();p.setItem(u,r)}catch(e){console.error("API key encryption failed:",e)}})},I=()=>p.getItem("apiEndpoint")||"https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent",b=()=>p.getItem(s)||"",O=e=>p.setItem(s,e),$=()=>p.getItem(c)||n,x=e=>p.setItem(c,e),T=()=>p.getItem(a),v=e=>p.setItem(a,e)},3147:(e,t,r)=>{r.d(t,{d:()=>a,t:()=>d});var l=r(5155),n=r(2115);let i=(0,n.createContext)(null),d=e=>{let{children:t}=e,[r,d]=(0,n.useState)([]),a=(0,n.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",r=new Date().getTime().toString()+Math.random().toString(),l={id:r,message:e,type:t};d(e=>{let t=[...e,l];return t.length>5&&t.shift(),t}),setTimeout(()=>{d(e=>e.filter(e=>e.id!==r))},3e3)},[]),o=e=>{switch(e){case"info":default:return{backgroundColor:"rgba(76, 175, 80, 0.9)",color:"white"};case"warn":return{backgroundColor:"rgba(255, 193, 7, 0.9)",color:"black"};case"error":return{backgroundColor:"rgba(244, 67, 54, 0.9)",color:"white"}}};return(0,l.jsxs)(i.Provider,{value:{addToast:a},children:[t,(0,l.jsx)("div",{style:{position:"fixed",bottom:"20px",left:"50%",transform:"translateX(-50%)",zIndex:1e3,pointerEvents:"none"},children:r.map(e=>(0,l.jsx)("div",{style:{...o(e.type),padding:"10px 20px",borderRadius:"10px",marginBottom:"10px",transition:"opacity 0.5s",opacity:1},children:e.message},e.id))})]})},a=()=>{let e=(0,n.useContext)(i);if(!e)throw Error("useToast must be used within a ToastProvider");return e}},3346:(e,t,r)=>{r.d(t,{C1:()=>a,PC:()=>d});var l=r(6924);let n=()=>{let e=document.createElement("canvas").getContext("2d");return e.font=`${l.gI}px ${l.zs}`,e},i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=n();return Math.ceil(e.split("\n").reduce((e,l)=>Math.max(e,r.measureText(l).width+2*t),0))},d=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=e.reduce((e,r)=>Math.max(e,i(r||"",t)),0);return Math.min(l.SK.WIDTH.MAX,Math.max(l.SK.WIDTH.MIN,r))},a=function(e,t){arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.mU;let r=n(),i=e.split("\n"),d=[];return i.forEach(e=>{if(""===e.trim()){d.push("");return}let l="",n=0;for(let i of e.split(/(\s+)/).filter(e=>""!==e)){let e=r.measureText(i).width;if(n+e>t){if(""!==l&&(d.push(l),l="",n=0),e>t)for(let e of i){let i=r.measureText(e).width;n+i>t&&(d.push(l),l="",n=0),l+=e,n+=i}else l=i,n=e}else l+=i,n+=e}""!==l&&d.push(l)}),d}},4098:(e,t,r)=>{r.d(t,{$r:()=>s,Fk:()=>d,Sz:()=>o,wl:()=>a});var l=r(6924),n=r(6624);let i=e=>"object"==typeof e&&null!==e&&("text"in e||"text2"in e||"text3"in e||"texts"in e&&"sectionHeights"in e),d=e=>i(e)?e.texts&&e.sectionHeights?{...e,texts:e.texts,sectionHeights:e.sectionHeights}:{...e,texts:[e.text||"",e.text2||"",e.text3||""],sectionHeights:[e.section1Height||l.SK.SECTION_HEIGHT,e.section2Height||l.SK.SECTION_HEIGHT,e.section3Height||l.SK.SECTION_HEIGHT],text:void 0,text2:void 0,text3:void 0,section1Height:void 0,section2Height:void 0,section3Height:void 0}:(0,n.N3)(),a=e=>new Promise((t,r)=>{let l=e.target,n=l.files?.[0];if(!n){r(Error("Error: ファイルが選択されていません"));return}let i=new FileReader;i.onload=e=>{try{let r;let l=e.target?.result;if("string"!=typeof l)throw Error("Invalid file content");let i=JSON.parse(l);if(Array.isArray(i))r=i.map(d);else if("object"==typeof i&&null!==i){let e="elements"in i?i.elements:i;r=Object.values(e).map(d)}else throw Error("Invalid data format");let a=r.reduce((e,t)=>(e[t.id]=t,e),{});t({elements:a,fileName:n.name})}catch(e){r(Error("Error: ファイルの読み込みに失敗しました"))}},i.onerror=()=>r(Error("Error: ファイルの読み込みに失敗しました")),i.readAsText(n),l.value=""}),o=(e,t)=>{let r=e.cloneNode(!0);r.setAttribute("xmlns","http://www.w3.org/2000/svg");let l=e.querySelectorAll("*"),n=r.querySelectorAll("*");for(let e=0;e<l.length;e++){let t=l[e],r=n[e],i=window.getComputedStyle(t);for(let e=0;e<i.length;e++){let t=i[e],l=i.getPropertyValue(t);r.style[t]=l}}let i=new Blob(['<?xml version="1.0" standalone="no"?>\r\n',r.outerHTML],{type:"image/svg+xml;charset=utf-8"}),d=URL.createObjectURL(i),a=document.createElement("a");a.href=d,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a)},s=(e,t)=>{let r=new Blob([JSON.stringify(e.map(e=>{let{x:t,y:r,...l}=e;return l}))],{type:"application/json"}),l=URL.createObjectURL(r),n=document.createElement("a");n.href=l,n.download=`${t||"Untitled"}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n)}},6624:(e,t,r)=>{r.d(t,{N3:()=>E,ue:()=>I,K9:()=>v,Ff:()=>_});let l=[],n=0,i=e=>n>0?(l[n]=e,l[--n]):e,d=e=>n<l.length-1?l[++n]:e,a=e=>{let t=l.slice(0,n+1);t.push(e),l=t,n++},o=e=>Object.values(e).find(e=>e.selected),s=(e,t)=>Object.values(e).filter(e=>e.depth===t).sort((e,t)=>e.y-t.y||e.x-t.x),c=(e,t,r)=>{let l=s(e,t.depth),n=l.findIndex(e=>e.id===t.id)+r;return n>=0&&n<l.length?l[n].id:t.id},u=(e,t)=>Object.values(e).filter(e=>e.parentId===t),h=(e,t)=>{let r=o(e);if(r)switch(t){case"up":case"down":return c(e,r,"up"===t?-1:1);case"left":return r.parentId??r.id;case"right":return u(e,r.id)[0]?.id??r.id;default:return r.id}};var m=r(2226),p=r(6924),f=r(621),y=r(3346),g=r(8265);let E=function(){let{parentId:e=null,order:t=0,depth:r=1,numSections:l=(0,m.X0)()}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{id:(0,f.A)(),texts:Array(l).fill(""),x:0,y:0,width:p.SK.WIDTH.MIN,height:p.SK.SECTION_HEIGHT*l,sectionHeights:Array(l).fill(p.SK.SECTION_HEIGHT),parentId:e,order:t,depth:r,children:0,editing:!0,selected:!0,visible:!0,tentative:!1}},I={elements:{1:{...E(),id:"1",x:p.OS.X,y:p.OS.Y,editing:!1}},width:window.innerWidth,height:window.innerHeight,zoomRatio:1},b=(e,t)=>{let r={},l=Object.values(e),n={...t,parentId:null};r[n.id]=n;let i=e=>{l.filter(t=>t.parentId===e).forEach(e=>{let t={...e};r[t.id]=t,i(e.id)})};return i(t.id),r},O=(e,t,r)=>{if(!t)return e;let l=Object.values(t).find(e=>null===e.parentId);if(!l)return{...e,...t};let n=l.depth,i=r.depth+1-n,d=new Map,a={};Object.values(t).forEach(e=>{let t=(0,f.A)();d.set(e.id,t);let l=e.depth+i;a[t]={...e,id:t,depth:l,parentId:null===e.parentId?r.id:d.get(e.parentId),order:null===e.parentId?r.children:e.order}});let o={...r,children:r.children+1};return{...e,...a,[r.id]:o}},$=(e,t)=>{let r={...e},l={};Object.values(r).forEach(e=>{let t=e.parentId;t&&(l[t]||(l[t]=[]),l[t].push(e))});let n=e=>{(l[e]||[]).forEach(t=>{r[t.id]={...t,depth:r[e].depth+1},n(t.id)})};return n(t.id),r},x=(e,t,r)=>{let l={...e},n={};Object.values(l).forEach(e=>{let t=e.parentId;t&&(n[t]||(n[t]=[]),n[t].push(e))});let i=e=>{(n[e]||[]).forEach(e=>{l[e.id]={...e,visible:r},i(e.id)})};return i(t.id),l},T=(e,t)=>{if(null===t.parentId)return e;(0,g.c)(`deleteElementRecursive: 削除開始 id=${t.id}, order=${t.order}, y=${t.y}`);let r={...e},l=r[t.parentId];if(!l)return r;let n={order:t.order,y:t.y,height:t.height};(0,g.c)(`削除要素の位置情報:`,n);let i=e=>{Object.values(r).filter(t=>t.parentId===e).forEach(e=>{(0,g.c)(`  子要素を削除: id=${e.id}, y=${e.y}`),delete r[e.id],i(e.id)})};delete r[t.id],i(t.id),r[l.id]={...l,children:l.children-1},(0,g.c)(`親要素を更新: id=${l.id}, children=${l.children-1}, y=${l.y}`);let d=Object.values(r).filter(e=>e.parentId===l.id).sort((e,t)=>e.order-t.order);return(0,g.c)(`兄弟要素の数: ${d.length}`),d.forEach((e,t)=>{e.order!==t&&((0,g.c)(`  兄弟要素のorder更新: id=${e.id}, old=${e.order}, new=${t}, y=${e.y}`),r[e.id]={...e,order:t})}),r},v=(e,t,r)=>{let l=r;for(;null!==l;){if(l===t)return!0;l=e[l]?.parentId??null}return!1},S=(e,t)=>Object.values(t).filter(t=>t.parentId===e&&t.visible).sort((e,t)=>e.order-t.order),w=(e,t,r,l)=>{(0,g.c)(`layoutSubtree開始: id=${e.id}, parentId=${e.parentId}, order=${e.order}, 初期y=${e.y}`),null!==e.parentId&&(e.x=t+p.e$.X);let n=S(e.id,l);(0,g.c)(`  子要素数: ${n.length}`);let i=r,d=1/0,a=-1/0;for(let t of n){let r=w(t,e.x+e.width,i,l);i=r.newY,d=Math.min(d,r.minY),a=Math.max(a,r.maxY)}let o=e.y;if(n.length>0){let t=Math.min(...n.map(e=>e.y)),r=Math.max(...n.map(e=>e.y+e.height));e.y=(t+r)/2-e.height/2,(0,g.c)(`  子要素あり: id=${e.id}, oldY=${o}, newY=${e.y}, 子要素範囲=${t}~${r}`)}else e.y=r,(0,g.c)(`  子要素なし: id=${e.id}, oldY=${o}, newY=${e.y}, currentY=${r}`);let s=e.y,c=!0,u=null===e.parentId?S(null,l).filter(t=>t.id!==e.id):S(e.parentId,l).filter(t=>t.id!==e.id);u.sort((e,t)=>e.order-t.order);let h=s;for(;c;)for(let t of(c=!1,u))if(e.order<=t.order&&N(e,s,t)){let r=s;s=t.y+t.height+p.e$.Y,c=!0,(0,g.c)(`  衝突検出: id=${e.id}, 衝突相手=${t.id}, oldY=${r}, newY=${s}`);break}if(s!==h&&(0,g.c)(`  衝突調整: id=${e.id}, 調整前=${h}, 調整後=${s}`),s>e.y&&n.length>0){let t=s-e.y;if(t>p.e$.Y){for(let r of((0,g.c)(`  親移動に伴う子要素移動: id=${e.id}, 移動量=${t}`),n)){let e=r.y;r.y+=t,(0,g.c)(`    子要素移動: id=${r.id}, oldY=${e}, newY=${r.y}`)}d=Math.min(d,...n.map(e=>e.y)),a=Math.max(a,...n.map(e=>e.y+e.height))}}e.y=s;let m=Math.max(i,e.y+e.height+p.e$.Y);return d=Math.min(d,e.y),a=Math.max(a,e.y+e.height),(0,g.c)(`layoutSubtree終了: id=${e.id}, 最終y=${e.y}, 次Y=${m}, minY=${d}, maxY=${a}`),{newY:m,minY:d,maxY:a}},N=(e,t,r)=>{if(e.parentId===r.parentId){if(e.order<r.order)return!1;if(e.order>r.order){let l=e.x<r.x+r.width&&e.x+e.width>r.x&&t<r.y+r.height&&t+e.height>r.y;return l&&(0,g.c)(`衝突検出: id=${e.id}(order=${e.order})とid=${r.id}(order=${r.order})の間で衝突`),l}}if(e.depth===r.depth&&e.x<r.x+r.width&&e.x+e.width>r.x){let l=t<r.y+r.height&&t+e.height>r.y;return l&&(0,g.c)(`同じdepthの要素間衝突検出: id=${e.id}(depth=${e.depth})とid=${r.id}(depth=${r.depth})の間で衝突`),l}return!1},C=e=>{(0,g.c)(`adjustElementPositions開始: 要素数=${Object.keys(e).length}`);let t={...e},r=S(null,t).sort((e,t)=>e.order-t.order);(0,g.c)(`ルート要素数: ${r.length}`);let l=p.OS.Y;for(let e of r)e.x=p.OS.X,(0,g.c)(`ルート要素配置: id=${e.id}, order=${e.order}, 開始y=${e.y}, currentY=${l}`),l=w(e,e.x,l,t).newY,(0,g.c)(`ルート要素配置結果: id=${e.id}, 配置後y=${e.y}, 次Y=${l}`);(0,g.c)(`order順序の確認処理開始`);let n=!0,i=0;do{i++,n=!0;let e={};Object.values(t).forEach(t=>{t.parentId&&(e[t.parentId]||(e[t.parentId]=[]),e[t.parentId].push(t))}),Object.entries(e).forEach(e=>{let[r,l]=e;l.sort((e,t)=>e.order-t.order);for(let e=1;e<l.length;e++){let i=l[e-1],d=l[e];if(d.y<i.y+i.height){let e=d.y;if(d.y=i.y+i.height+p.e$.Y,n=!1,(0,g.c)(`順序修正: parentId=${r}, 前要素id=${i.id}(order=${i.order}), 現在要素id=${d.id}(order=${d.order}), oldY=${e}, newY=${d.y}`),d.children>0){let r=S(d.id,t),l=d.y-e;(0,g.c)(`  子要素も移動: id=${d.id}の子要素を移動 deltaY=${l}, 子要素数=${r.length}`),r.forEach(e=>{let t=e.y;e.y+=l,(0,g.c)(`    子要素移動: id=${e.id}, oldY=${t}, newY=${e.y}`)})}}}}),n||(0,g.c)(`繰り返し修正: ${i}回目, 修正が必要`)}while(!n&&i<10);i>=10&&(0,g.c)(`警告: 最大繰り返し回数に達しました。完全な修正ができていない可能性あり。`),(0,g.c)(`同じdepthの要素間の衝突チェック開始`);let d=!0;i=0;do{i++,d=!0;let e={};Object.values(t).forEach(t=>{e[t.depth]||(e[t.depth]=[]),e[t.depth].push(t)}),Object.entries(e).forEach(e=>{let[r,l]=e;l.sort((e,t)=>e.y-t.y);for(let e=0;e<l.length;e++){let r=l[e];for(let n=e+1;n<l.length;n++){let e=l[n];if(r.parentId!==e.parentId&&r.x<e.x+e.width&&r.x+r.width>e.x&&r.y<e.y+e.height&&r.y+r.height>e.y){let l=e.y;if(e.y=r.y+r.height+p.e$.Y,d=!1,(0,g.c)(`同じdepthの要素間衝突修正: id=${r.id}(depth=${r.depth})とid=${e.id}(depth=${e.depth})が衝突, ${e.id}を下に移動, oldY=${l}, newY=${e.y}`),e.children>0){let r=S(e.id,t),n=e.y-l;(0,g.c)(`  子要素も移動: id=${e.id}の子要素を移動 deltaY=${n}, 子要素数=${r.length}`),r.forEach(e=>{let t=e.y;e.y+=n,(0,g.c)(`    子要素移動: id=${e.id}, oldY=${t}, newY=${e.y}`)})}break}}if(!d)break}}),d||(0,g.c)(`同じdepthの要素間衝突修正: ${i}回目, 修正が必要`)}while(!d&&i<10);for(let e of(i>=10&&(0,g.c)(`警告: 同じdepthの要素間衝突チェックで最大繰り返し回数に達しました。完全な修正ができていない可能性あり。`),(0,g.c)(`親子中央配置の最適化開始`),Object.values(t).sort((e,t)=>e.depth-t.depth)))if(e.children>0){let r=S(e.id,t);if(r.length>0){let t=Math.min(...r.map(e=>e.y)),l=Math.max(...r.map(e=>e.y+e.height)),n=(t+l)/2,i=e.y+e.height/2;if((0,g.c)(`親子配置確認: id=${e.id}, 子要素数=${r.length}, 範囲=${t}~${l}, 中心=${n}`),Math.abs(n-i)>p.e$.Y/2){let t=e.y;e.y=n-e.height/2,(0,g.c)(`親子中央配置調整: id=${e.id}, oldY=${t}, newY=${e.y}, 子要素中心=${n}, 親中心=${i}`)}}}return(0,g.c)(`adjustElementPositions終了`),t},j=(e,t,r,l)=>{let n=(0,f.A)(),i=l?.order??t.children,d=[r||"",...Array((0,m.X0)()-1).fill("")],a={...E({parentId:t.id,order:i,depth:t.depth+1}),id:n,texts:d,width:p.SK.WIDTH.MIN,height:p.SK.SECTION_HEIGHT*(0,m.X0)(),sectionHeights:Array((0,m.X0)()).fill(p.SK.SECTION_HEIGHT),selected:l?.newElementSelect??!1,editing:l?.newElementSelect??!1,tentative:l?.tentative??!1},o={...t,children:t.children+1,selected:!l?.newElementSelect&&t.selected};return{...e,[t.id]:o,[a.id]:a}},M=(e,t)=>{let r=t.parentId,l=Object.values(e).filter(e=>e.parentId===r),n=t.order+1,i={...e};l.forEach(e=>{e.order>=n&&(i[e.id]={...e,order:e.order+1})});let d=E({parentId:r,order:n,depth:t.depth});if(i[t.id]={...t,selected:!1},i[d.id]=d,null!==r){let e=i[r];i[r]={...e,children:e.children+1}}return i},A={ZOOM_IN:e=>({...e,zoomRatio:e.zoomRatio+.1}),ZOOM_OUT:e=>({...e,zoomRatio:Math.max(e.zoomRatio-.1,.1)}),ARROW_UP:R(e=>h(e,"up")),ARROW_DOWN:R(e=>h(e,"down")),ARROW_RIGHT:R(e=>h(e,"right")),ARROW_LEFT:R(e=>h(e,"left")),LOAD_ELEMENTS:(e,t)=>{if(0===Object.keys(t.payload).length)return I;let r=Object.values(t.payload).reduce((e,t)=>(e[t.id]=null===t.parentId?{...t,visible:!0}:t,e),{});return{...e,elements:C(r)}},SELECT_ELEMENT:(e,t)=>{let{id:r,ctrlKey:l,shiftKey:n}=t.payload,i=e.elements[r];if(!i)return e;let d=Object.values(e.elements).filter(e=>e.selected),a=d[0];if((n||l)&&d.length>0&&d.some(e=>e.parentId!==i.parentId))return e;let o=[];if(n&&d.length>0){let t=a.parentId,l=Object.values(e.elements).filter(e=>e.parentId===t).sort((e,t)=>e.order-t.order),n=l.findIndex(e=>e.id===a.id),i=l.findIndex(e=>e.id===r),[d,s]=[Math.min(n,i),Math.max(n,i)];o=l.slice(d,s+1).map(e=>e.id)}else o=l?d.some(e=>e.id===r)?d.filter(e=>e.id!==r).map(e=>e.id):[...d.map(e=>e.id),r]:[r];let s=i.parentId,c=o.filter(t=>e.elements[t].parentId===s),u=Object.values(e.elements).reduce((e,t)=>{let r=c.includes(t.id);return e[t.id]={...t,selected:r,editing:!!r&&t.editing},e},{});return{...e,elements:u}},DESELECT_ALL:e=>({...e,elements:Object.values(e.elements).reduce((e,t)=>(e[t.id]={...t,selected:!1,editing:!1},e),{})}),UPDATE_TEXT:(e,t)=>({...e,elements:{...e.elements,[t.payload.id]:{...e.elements[t.payload.id],texts:e.elements[t.payload.id].texts.map((e,r)=>r===t.payload.index?t.payload.value:e)}}}),ADD_ELEMENT:(e,t)=>H(e,(e,r)=>({elements:C(j(e,r,t.payload?.text,{newElementSelect:!0}))})),ADD_ELEMENTS_SILENT:(e,t)=>H(e,(r,l)=>{let n=t.payload?.texts||[],i=t.payload?.tentative||!1,d={...r},a={...l},o=a.children;return n.forEach((e,t)=>{d=j(d,a,e,{newElementSelect:!1,tentative:i,order:o+t})}),d[a.id]={...a,children:o+n.length},Object.values(d).forEach(t=>{if(t.parentId===a.id){let r=(0,y.PC)(t.texts,p.rF.HORIZONTAL),l=t.texts.map(t=>{let l=(0,y.C1)(t||"",r,e.zoomRatio).length;return Math.max(p.SK.SECTION_HEIGHT*e.zoomRatio,l*p.gI*p.RZ+p.rF.VERTICAL*e.zoomRatio)});d[t.id]={...t,width:r,height:l.reduce((e,t)=>e+t,0),sectionHeights:l}}}),{elements:C(d)}}),ADD_SIBLING_ELEMENT:e=>H(e,(e,t)=>({elements:C(M(e,t))})),DELETE_ELEMENT:e=>{let t=Object.values(e.elements).filter(e=>e.selected);if(0===t.length)return e;(0,g.c)(`DELETE_ELEMENT開始: 削除対象要素数=${t.length}`);let r=new Set;t.forEach(e=>{e.parentId&&r.add(e.parentId),(0,g.c)(`削除対象: id=${e.id}, parentId=${e.parentId}, order=${e.order}, y=${e.y}`)});let l={...e.elements},n={};r.forEach(e=>{n[e]=Object.values(l).filter(t=>t.parentId===e).sort((e,t)=>e.order-t.order),(0,g.c)(`削除前の親id=${e}の子要素:`,n[e].map(e=>({id:e.id,order:e.order,y:e.y})))}),t.forEach(e=>{l=T(l,e)}),Object.values(l).forEach(e=>{if(null===e.parentId){let t=e.y;e.y=p.OS.Y,(0,g.c)(`ルート要素のY座標リセット: id=${e.id}, oldY=${t}, newY=${e.y}`)}}),r.forEach(e=>{if(l[e]){let t=Object.values(l).filter(t=>t.parentId===e).sort((e,t)=>e.order-t.order);(0,g.c)(`削除後の親id=${e}の子要素:`,t.map(e=>({id:e.id,order:e.order,y:e.y})))}}),(0,g.c)(`レイアウト再計算開始`);let i=C(l);return(0,g.c)(`レイアウト再計算完了`),r.forEach(e=>{if(i[e]){let t=Object.values(i).filter(t=>t.parentId===e).sort((e,t)=>e.order-t.order);(0,g.c)(`再計算後の親id=${e}の子要素:`,t.map(e=>({id:e.id,order:e.order,y:e.y})))}}),{...e,elements:i}},EDIT_ELEMENT:e=>L(e,t=>({elements:{...e.elements,[t.id]:{...t,editing:!0}}})),END_EDITING:e=>({...e,elements:Object.values(e.elements).reduce((e,t)=>(e[t.id]={...t,editing:!1},e),{})}),CONFIRM_TENTATIVE_ELEMENTS:(e,t)=>({...e,elements:Object.values(e.elements).reduce((e,r)=>(r.parentId===t.payload&&r.tentative?e[r.id]={...r,tentative:!1}:e[r.id]=r,e),{})}),CANCEL_TENTATIVE_ELEMENTS:(e,t)=>{let r=Array.from(new Set(Object.values(e.elements).filter(e=>e.tentative&&e.parentId===t.payload).map(e=>e.parentId).filter(e=>null!==e))),l=Object.values(e.elements).reduce((e,r)=>(r.tentative&&r.parentId===t.payload||(e[r.id]=r),e),{}),n=r.reduce((e,t)=>{if(e[t]){let r=Object.values(e).filter(e=>e.parentId===t&&!e.tentative).length;e[t]={...e[t],children:r}}return e},l);return{...e,elements:C(n)}},UNDO:e=>({...e,elements:C(i(e.elements))}),REDO:e=>({...e,elements:C(d(e.elements))}),SNAPSHOT:e=>(a(e.elements),e),DROP_ELEMENT:(e,t)=>{let{payload:r}=t,{id:l,oldParentId:n,newParentId:i,newOrder:d,depth:a}=r;if(l===i||v(e.elements,l,i))return e;let o={...e.elements},s=o[l],c=o[n],u=o[i],h=n===i;!h&&c&&(o[n]={...c,children:Math.max(0,c.children-1)},Object.values(o).filter(e=>e.parentId===n&&e.id!==l).sort((e,t)=>e.order-t.order).forEach((e,t)=>{e.order!==t&&(o[e.id]={...e,order:t})})),o[l]={...s,parentId:i,order:d,depth:a};let m=Object.values(o).filter(e=>e.parentId===i&&e.id!==l).sort((e,t)=>e.order-t.order);return[...m.slice(0,d),o[l],...m.slice(d)].forEach((e,t)=>{e.order!==t&&(o[e.id]={...e,order:t})}),!h&&u&&(o[i]={...u,children:u.children+1}),h||(o=$(o,o[l])),{...e,elements:C(o)}},MOVE_ELEMENT:(e,t)=>{let{id:r,x:l,y:n}=t.payload,i=Object.values(e.elements).filter(e=>e.selected);if(i.length>1&&i.some(e=>e.id===r)){let t=l-e.elements[r].x,d=n-e.elements[r].y,a={...e.elements};return i.forEach(e=>{a[e.id]={...e,x:e.x+t,y:e.y+d}}),{...e,elements:a}}return{...e,elements:{...e.elements,[r]:{...e.elements[r],x:l,y:n}}}},CUT_ELEMENT:e=>{let t=Object.values(e.elements).filter(e=>e.selected);if(0===t.length)return e;let r={},l={...e.elements};return t.forEach(e=>{let t=b(l,e);Object.values(t).forEach(e=>{t[e.id]={...e,selected:!1}}),r={...r,...t},l=T(l,e)}),{...e,elements:C(l),cutElements:r}},COPY_ELEMENT:e=>L(e,t=>({cutElements:b(e.elements,t)})),PASTE_ELEMENT:e=>1===Object.values(e.elements).filter(e=>e.selected).length&&e.cutElements?H(e,(t,r)=>({elements:C(O(t,e.cutElements,r))})):e,EXPAND_ELEMENT:e=>H(e,(e,t)=>({elements:C(x(e,t,!0))})),COLLAPSE_ELEMENT:e=>H(e,(e,t)=>({elements:C(x(e,t,!1))})),UPDATE_ELEMENT_SIZE:(e,t)=>{let r={...e.elements[t.payload.id],width:t.payload.width,height:t.payload.height,sectionHeights:t.payload.sectionHeights};return{...e,elements:C({...e.elements,[t.payload.id]:r})}}};function R(e){return t=>{let r=Object.values(t.elements).filter(e=>e.selected);if(r.length>1){let e=r[0].id,l=Object.values(t.elements).reduce((t,r)=>(t[r.id]={...r,selected:r.id===e,editing:r.id===e&&r.editing},t),{});return{...t,elements:l}}let l=e(t.elements);return{...t,elements:Object.values(t.elements).reduce((e,t)=>(e[t.id]={...t,selected:t.id===l},e),{})}}}function H(e,t){let r=Object.values(e.elements).find(e=>e.selected);if(!r)return e;a(e.elements);let l=t(e.elements,r);return"elements"in l?{...e,elements:l.elements,...l.cutElements&&{cutElements:l.cutElements}}:{...e,elements:l}}function L(e,t){let r=Object.values(e.elements).find(e=>e.selected);return r?{...e,...t(r)}:e}function _(e,t){let r=A[t.type];return r?r(e,t):e}},6924:(e,t,r)=>{r.d(t,{FM:()=>g,JY:()=>y,N:()=>p,OS:()=>i,RZ:()=>f,SK:()=>d,_v:()=>I,e$:()=>a,gI:()=>u,iC:()=>o,lB:()=>s,mO:()=>c,mU:()=>l,rF:()=>m,uF:()=>E,zX:()=>n,zs:()=>h});let l=.8,n=3,i={X:50,Y:50},d={SECTION_HEIGHT:24,WIDTH:{MAX:300,MIN:50}},a={X:100,Y:10},o={NORMAL:{COLOR:"white",STROKE_COLOR:"dimgray"},SELECTED:{STROKE_COLOR:"blue"},DRAGGING:{COLOR:"rgba(100, 100, 255, 0.3)",STROKE_COLOR:"rgba(0, 0, 255, 0.3)"},SHADDOW:{COLOR:"rgba(0, 0, 0, 0.5)"},RX:2,STROKE:"2px"},s={COLOR:"black",DRAGGING_COLOR:"rgba(0, 0, 255, 0.3)",STROKE:.5},c=80,u=16,h='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',m={HORIZONTAL:3,VERTICAL:2},p=3,f=1.4,y=40,g=40,E=80,I={HEIGHT:6,WIDTH:6,OFFSET:0}},8265:(e,t,r)=>{r.d(t,{c:()=>l});let l=(e,t)=>{}}}]);